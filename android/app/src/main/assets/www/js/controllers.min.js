!function(e){e.baseCtrl=function(){},e.baseCtrl.prototype.getContext=function(){}}(gxb.controllers),function(e){e.registerNamespace("gxb.controllers.users"),e.registerNamespace("gxb.controllers.learning"),e.registerNamespace("gxb.controllers.courses"),e.registerNamespace("gxb.controllers.schools"),e.registerNamespace("gxb.controllers.layout"),e.registerNamespace("gxb.controllers.course"),e.registerNamespace("gxb.controllers.profiles"),e.registerNamespace("gxb.controllers.founds"),e.registerNamespace("gxb.controllers.campus"),e.registerNamespace("gxb.controllers.community"),e.registerNamespace("gxb.controllers.charging")}(gxb.components),function(e){e.users.agreementCtrl=function(e){var o=e.$stateParams.mobile;e.$scope.goTome=function(){e.$state.go("account_signup",{mobile:o})}},e.inheritFromCtrl(e.users.agreementCtrl),e.registerDependency("gxb.controllers.users.agreementCtrl",[]),e.registerView("gxb.controllers.users.agreementCtrl","user_agreement")}(gxb.controllers),function(e){e.users.bindingCtrl=function(e){e.$scope.goTome=function(){e.$rootScope.mAccessToken?e.$uiComponents.$toast.show("请您先绑定手机号后,在进行操作"):e.$uiComponents.$history.goBack()},e.$scope.$bindingModel=new e.$bindingModel,e.$scope.goGetCode=function(){if(e.$loginSrv.isNoEmptyValue(this.$bindingModel.mobile)){if(!e.$loginSrv.verifyMobile(this.$bindingModel.mobile))return e.$uiComponents.$toast.show("请输入正确的手机格式!"),!1;e.$pluginComponents.$objectCache.set("mobile",e.$scope.$bindingModel.mobile),e.$uiComponents.$loadding.show(),e.$bindingSrv.getBindCode(e.$scope.$bindingModel.mobile).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$uiComponents.$toast.show(o.message),e.$state.go("user_bind_mobile_verify",{mobile:e.$scope.$bindingModel.mobile},{reload:!0})):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})}}},e.inheritFromCtrl(e.users.bindingCtrl),e.registerDependency("gxb.controllers.users.bindingCtrl",["gxb.services.users.bindingSrv","gxb.services.users.loginSrv","gxb.models.users.bindingModel"]),e.registerView("gxb.controllers.users.bindingCtrl","user_binding")}(gxb.controllers),function(e){e.users.certifiedCtrl=function(e){e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$authModel=new e.$authModel,e.$stateParams?e.$scope.$authModel.schoolName=e.$stateParams.schoolName:e.$scope.$authModel.schoolName="",e.$scope.goToAuth=function(){e.$loginSrv.isNoEmpty(this.$authModel)&&(e.$uiComponents.$loadding.show(),e.$authSrv.goToAuth(this.$authModel,e.$pluginComponents.$accessToken.get()).then(function(o){if(e.$uiComponents.$loadding.hide(),"0"==o.status){e.$uiComponents.$toast.show("认证成功"),e.$pluginComponents.$tenantId.set(e.$scope.$authModel.tenantId);var t=e.$pluginComponents.$objectCache.getObject("userObject");t.bindingStatus="1",t.bindingCount="1",t.schoolName=e.$scope.$authModel.schoolName,t.name=e.$scope.$authModel.name,e.$pluginComponents.$objectCache.setObject("userObject",t),e.$state.go("home.course",{reload:!0})}else 400==o.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}))},e.$scope.goLearn=function(){e.$state.go("home.course",{reload:!0})},e.$scope.goSchool=function(){e.$pluginComponents.$chooseSchoolType.set(1),e.$state.go("school",{type:1},{reload:!0})},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})},e.$rootScope.$on("$choice",function(o,t,s){e.$scope.$authModel.schoolName=t,e.$scope.tenantId=s,e.$scope.$authModel.tenantId=e.$scope.tenantId})},e.inheritFromCtrl(e.users.certifiedCtrl),e.registerDependency("gxb.controllers.users.certifiedCtrl",["Comment","gxb.models.users.authModel","gxb.services.users.loginSrv","gxb.services.users.authSrv"]),e.registerView("gxb.controllers.users.certifiedCtrl","user_certified")}(gxb.controllers),function(e){e.users.escrowLoginCtrl=function(e){e.$scope.paracont="获取验证码",e.$scope.paraclass="escrow_yzm",e.$scope.paraevent=!0,e.$scope.second=60,e.$scope.timePromise=void 0;var o=e.$stateParams.keyType;e.$scope.escrowObj=e.$pluginComponents.$objectCache.getObject("escrowObject"),e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.goCode=function(t){return t?(e.$uiComponents.$loadding.show(),e.$scope.timePromise=e.$interval(function(){e.$scope.second<=0?(e.$interval.cancel(e.$scope.timePromise),e.$scope.timePromise=void 0,e.$scope.second=60,e.$scope.paracont="获取验证码",e.$scope.paraclass="escrow_yzm",e.$scope.paraevent=!0):(e.$scope.paracont=e.$sce.trustAsHtml(e.$scope.second+"秒后重发"),e.$scope.paraclass="no_yzm",e.$scope.second--)},1e3,100),void e.$loginSrv.getValidateCode(t,o).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?e.$uiComponents.$toast.show("发送验证码成功!"):(e.$interval.cancel(e.$scope.timePromise),e.$scope.timePromise=void 0,e.$scope.second=60,e.$scope.paracont="获取验证码",e.$scope.paraclass="escrow_yzm",e.$scope.paraevent=!0,e.$uiComponents.$toast.show(o.message))},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("您的设备没有连接网络，请连接网络...")})):void e.$uiComponents.$toast.show("请输入手机号！")},e.$scope.goPassword=function(o,t){e.$scope.escrowObj.unionId&&(e.$scope.unionId=e.$scope.escrowObj.unionId);var s={loginKey:e.$scope.escrowObj.userId,keyType:e.$scope.escrowObj.type,unionId:e.$scope.unionId,mobile:o,validateCode:t};e.$loginSrv.getVerification(s).then(function(t){"0"==t.status?(e.$pluginComponents.$objectCache.setObject("userObject",t.data),e.$pluginComponents.$accessToken.set(t.data.accessToken),void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},t.data.accessToken).then(function(e){}),e.$uiComponents.$toast.show("登录成功"),e.$state.go("home.course",{reload:!0})):"1"==t.status?e.$uiComponents.$toast.show(t.message):"2"==t.status&&e.$state.go("escrow_login_password",{mobile:o},{reload:!0})},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("您的设备没有连接网络，请连接网络...")})}},e.inheritFromCtrl(e.users.escrowLoginCtrl),e.registerDependency("gxb.controllers.users.escrowLoginCtrl",["gxb.services.users.loginSrv","$interval","$sce"]),e.registerView("gxb.controllers.users.escrowLoginCtrl","escrow_login")}(gxb.controllers),function(e){e.users.escrowLoginPasswordCtrl=function(e){var o=e.$stateParams.mobile;e.$scope.escrowObj=e.$pluginComponents.$objectCache.getObject("escrowObject"),e.$scope.goNext=function(t){e.$scope.escrowObj.unionId&&(e.$scope.unionId=e.$scope.escrowObj.unionId);var s={mobile:o,loginKey:e.$scope.escrowObj.userId,unionId:e.$scope.unionId,keyType:e.$scope.escrowObj.type,nickName:e.$scope.escrowObj.nickName,password:t,gender:""};return"0"==e.$scope.escrowObj.gender?s.gender="male":s.gender="female",e.$loginSrv.verifyPassword(t)?(e.$uiComponents.$loadding.show(),void e.$loginSrv.getEscrowSuccess(s).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status&&(e.$pluginComponents.$objectCache.setObject("userObject",o.data),e.$pluginComponents.$accessToken.set(o.data.accessToken),void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},o.data.accessToken).then(function(e){}),e.$uiComponents.$toast.show("登录成功"),e.$state.go("home.course",{reload:!0}))})):(e.$uiComponents.$toast.show("请输入6-16位数字、字母或符号的组合\r\n(至少两种类型字符组合)"),!1)},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.users.escrowLoginPasswordCtrl),e.registerDependency("gxb.controllers.users.escrowLoginPasswordCtrl",["gxb.services.users.loginSrv"]),e.registerView("gxb.controllers.users.escrowLoginPasswordCtrl","escrow_login_password")}(gxb.controllers),function(e){e.users.forgetCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.validateSchool=function(){e.$state.go("user_validate_school",{reload:!0})};var o=e.$stateParams.mobile;e.$scope.$forgetModel=new e.$forgetModel,e.$stateParams?e.$scope.safeApply(function(){e.$scope.$forgetModel.mobile=o}):e.$scope.safeApply(function(){e.$scope.$forgetModel.mobile=""}),e.$scope.getCode=function(){if(e.$loginSrv.isNoEmptyValue(this.$forgetModel.mobile)){if(!e.$loginSrv.verifyMobile(this.$forgetModel.mobile))return e.$uiComponents.$toast.show("请输入正确的手机格式!"),!1;e.$uiComponents.$loadding.show(),e.$pluginComponents.$objectCache.set("mobile",e.$scope.$forgetModel.mobile),e.$forgetSrv.sendCode(e.$scope.$forgetModel.mobile).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$uiComponents.$toast.show("发送验证码成功"),e.$state.go("account_forgot_password_verify",{},{reload:!0})):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})}}},e.inheritFromCtrl(e.users.forgetCtrl),e.registerDependency("gxb.controllers.users.forgetCtrl",["gxb.services.users.forgetSrv","gxb.services.users.loginSrv","gxb.models.users.forgetModel"]),e.registerView("gxb.controllers.users.forgetCtrl","user_forget")}(gxb.controllers),function(e){e.users.loginCtrl=function(e){function o(o){document.getElementById("ionicScroll").style.height=window.screen.availHeight-108-o.keyboardHeight+"px",e.$ionicScrollDelegate.$getByHandle("schoolScroll").resize()}function t(o){document.getElementById("ionicScroll").style.height=window.screen.availHeight-108+"px",e.$ionicScrollDelegate.$getByHandle("schoolScroll").resize()}e.$ionicModal.fromTemplateUrl("my-modal.html",{scope:e.$scope,animation:"slide-in-up",focusFirstInput:!0}).then(function(o){e.$scope.modal=o}),e.$scope.closeModal=function(){e.$scope.modal.hide()},e.$scope.$on("$destroy",function(){e.$scope.modal.remove()}),e.$scope.tabMe="aside","Android"==e.$rootScope.platformType?e.$scope.tabMe="aside":e.$scope.tabMe="asides",e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$loginModel=new e.$loginModel;var s=e.$pluginComponents.$objectCache.getObject("lastLoginByNo");s&&s.schoolId&&(e.$scope.$loginModel.schoolName=s.schoolName,e.$scope.$loginModel.schoolId=s.schoolId,e.$scope.$loginModel.tenantId=s.tenantId,e.$scope.$loginModel.userName=s.userName),e.$scope.goHome=function(){e.$uiComponents.$history.goBack(-2)},e.$scope.redrawScroll=function(){e.$ionicScrollDelegate.$getByHandle("schoolScroll").resize(),e.$ionicScrollDelegate.$getByHandle("schoolScroll").scrollTop()},window.addEventListener("native.keyboardshow",o),window.addEventListener("native.keyboardhide",t),e.$scope.goSchool=function(){e.$scope.modal.show(),setTimeout(function(){e.$scope.schoolStyle="school_wrap","Android"==e.$rootScope.platformType?e.$scope.schoolStyle="school_wrap":e.$scope.schoolStyle="school_wraps"},10)},e.$scope.selectThisSchool=function(o){e.$scope.$loginModel.schoolName=o.name,e.$scope.$loginModel.schoolId=o.schoolId,e.$scope.$loginModel.tenantId=o.tenantId,e.$scope.modal.hide()},e.$scope.order="name",e.$scope.schoolsList=["a"],e.$scope.searchName="",e.$schoolSrv.listSchools().then(function(o){if("0"==o.status){var t=o.data,s=[];for(var n in t)s[n]=new e.$schoolModel(t[n]);e.$scope.schoolsList=s}else e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}),e.$scope.account=function(){e.$state.go("user_login_no",{reload:!0})},e.$scope.clearInput=function(){e.$scope.$loginModel.userName=null},e.$scope.clearLoginInput=function(){e.$scope.$loginModel.password=null},e.$scope.doLogin=function(){var o=this.$loginModel;e.$loginSrv.isNoEmpty(this.$loginModel)&&(e.$uiComponents.$loadding.show(),e.$loginSrv.doLoginNo(this.$loginModel).then(function(t){if(e.$uiComponents.$loadding.hide(),"0"==t.status)if("请绑定手机号"==t.data.mobile&&""==t.data.email)e.$uiComponents.$toast.show("您当前未绑定手机,请绑定手机后在进行登陆"),e.$rootScope.mSchoolObj=o,e.$rootScope.mUserObject=t.data,e.$rootScope.mAccessToken=t.data.accessToken,e.$rootScope.mid=t.data.id,e.$rootScope.mTenantId=t.data.tenantId,window.mLogin=function(){window.USERID=e.$rootScope.mid,window.TENANTID=e.$rootScope.mTenantId,void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},t.data.accessToken).then(function(e){}),e.$pluginComponents.$tenantId.set(e.$rootScope.mTenantId),e.$scope.unReadMessage(),e.$rootScope.mSchoolObj=void 0,e.$rootScope.mUserObject=void 0,e.$rootScope.mAccessToken=void 0,e.$rootScope.mid=void 0,e.$rootScope.mTenantId=void 0},e.$state.go("user_bind_mobile",{reload:!0});else{e.$pluginComponents.$objectCache.setObject("schoolObject",o),t.data.password=e.$scope.$loginModel.password,e.$pluginComponents.$objectCache.setObject("userObject",t.data),e.Preferences.putString("uid",t.data.id);var s={uid:t.data.id,tid:t.data.tenantId};window.plugins&&window.plugins.OnlinePlugin&&window.plugins.OnlinePlugin.onlineStart(s);var n={userName:e.$scope.$loginModel.userName,schoolName:e.$scope.$loginModel.schoolName,schoolId:e.$scope.$loginModel.schoolId,tenantId:e.$scope.$loginModel.tenantId};e.$pluginComponents.$objectCache.setObject("lastLoginByNo",n),window.USERID=t.data.id,window.TENANTID=t.data.tenantId,void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},t.data.accessToken).then(function(e){}),e.$pluginComponents.$accessToken.set(t.data.accessToken),e.$pluginComponents.$tenantId.set(t.data.tenantId),e.$rootScope.accessToken=t.data.accessToken,e.$scope.unReadMessage(),e.$uiComponents.$toast.show("登录成功"),e.$state.go("home.course",{reload:!0})}else e.$uiComponents.$toast.show("学号或密码错误")},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}))},e.$scope.getForgetPassword=function(){e.$state.go("account_forgot_password",{reload:!0})},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})},window.loginWechatData=function(o){if(o){var t=o.userId,s=o.type,n=o.unionId;e.$pluginComponents.$objectCache.setObject("escrowObject",o),e.$loginSrv.getEscrow(t,s,n).then(function(o){if("0"==o.status){e.$pluginComponents.$objectCache.setObject("userObject",o.data),e.$pluginComponents.$accessToken.set(o.data.accessToken),e.$rootScope.accessToken=o.data.accessToken,e.Preferences.putString("uid",o.data.id);var t={uid:o.data.id,tid:o.data.tenantId};window.plugins&&window.plugins.OnlinePlugin&&window.plugins.OnlinePlugin.onlineStart(t),void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},o.data.accessToken).then(function(e){}),e.$scope.unReadMessage(),e.$uiComponents.$toast.show("登录成功"),"0"==o.data.tenantId&&""==o.data.tenantId||e.$pluginComponents.$tenantId.set(o.data.tenantId),e.$state.go("home.course",{reload:!0})}else e.$state.go("escrow_login",{keyType:s},{reload:!0})})}},e.$scope.goWechat=function(){var e={type:"wechat"};window.plugins.SharePlugin&&window.plugins.SharePlugin.login(e)},window.loginQqData=function(o){if(o){var t=o.userId,s=o.type;e.$pluginComponents.$objectCache.setObject("escrowObject",o),e.$loginSrv.getEscrow(t,s,"").then(function(o){if("0"==o.status){e.$pluginComponents.$objectCache.setObject("userObject",o.data),e.$pluginComponents.$accessToken.set(o.data.accessToken),e.$rootScope.accessToken=o.data.accessToken,e.Preferences.putString("uid",o.data.id),void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},o.data.accessToken).then(function(e){});var t={uid:o.data.id,tid:o.data.tenantId};window.plugins&&window.plugins.OnlinePlugin&&window.plugins.OnlinePlugin.onlineStart(t),e.$scope.unReadMessage(),e.$uiComponents.$toast.show("登录成功"),"0"==o.data.tenantId&&""==o.data.tenantId||e.$pluginComponents.$tenantId.set(o.data.tenantId),e.$state.go("home.course",{reload:!0})}else e.$state.go("escrow_login",{keyType:s},{reload:!0})})}},e.$scope.goqq=function(){var e={type:"qq"};window.plugins.SharePlugin&&window.plugins.SharePlugin.login(e)},e.$scope.unReadMessage=function(){e.$profilesSrv.unReadMessage(e.$pluginComponents.$accessToken.get()).then(function(o){0==o.status&&(e.$rootScope.unReadMsg=o.data)})}},e.inheritFromCtrl(e.users.loginCtrl),e.registerDependency("gxb.controllers.users.loginCtrl",["Comment","$ionicModal","$ionicPopup","gxb.services.users.loginSrv","gxb.services.schools.schoolSrv","gxb.models.users.loginModel","gxb.models.users.jpushinitModel","gxb.models.schools.schoolModel","gxb.services.profiles.profilesSrv","$ionicScrollDelegate","Preferences"]),e.registerView("gxb.controllers.users.loginCtrl","user_login")}(gxb.controllers),function(e){e.users.loginNoCtrl=function(e){1==window.localStorage.getItem("registerGuide")?e.$scope.safeApply(function(){e.$scope.guide=1}):e.$scope.safeApply(function(){e.$scope.guide=0}),e.$scope.tabMe="aside","Android"==e.$rootScope.platformType?e.$scope.tabMe="aside":e.$scope.tabMe="asides",e.$scope.$loginNoModel=new e.$loginNoModel,"IOS"==e.$rootScope.platformType&&cordova.plugins.Keyboard.disableScroll(!0),e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()};var o=e.$pluginComponents.$objectCache.getObject("lastLoginbyAccount");o&&o.userName&&(e.$scope.$loginNoModel.userName=o.userName),e.$scope.classNo=function(){e.$state.go("account_signin",{reload:!0})},e.$scope.forget=function(){e.$state.go("account_forgot_password",{reload:!0})},e.$scope.clearInput=function(){e.$scope.$loginNoModel.password=null},e.$scope.clearLoginInput=function(){e.$scope.$loginNoModel.userName=null},e.$scope.doLogin=function(){e.$uiComponents.$loadding.show(),e.$loginSrv.doLogin(e.$scope.$loginNoModel).then(function(o){if(e.$uiComponents.$loadding.hide(),"0"==o.status){void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},o.data.accessToken).then(function(e){}),o.data.password=e.$scope.$loginNoModel.password,e.$pluginComponents.$objectCache.setObject("userObject",o.data);var t={userName:e.$scope.$loginNoModel.userName};e.$pluginComponents.$objectCache.setObject("lastLoginbyAccount",t),e.Preferences.putString("uid",o.data.id);var s={uid:o.data.id,tid:o.data.tenantId};window.plugins&&window.plugins.OnlinePlugin&&window.plugins.OnlinePlugin.onlineStart(s),e.$pluginComponents.$accessToken.set(o.data.accessToken),e.$rootScope.accessToken=o.data.accessToken,e.$uiComponents.$toast.show("登录成功"),"0"==o.data.tenantId&&""==o.data.tenantId||e.$pluginComponents.$tenantId.set(o.data.tenantId),e.$scope.unReadMessage(),e.$state.go("home.course",{reload:!0})}else e.$uiComponents.$toast.show("帐号或密码错误")},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})},window.loginWechatData=function(o){if(o){var t=o.userId,s=o.type,n=o.unionId;e.$pluginComponents.$objectCache.setObject("escrowObject",o),e.$loginSrv.getEscrow(t,s,n).then(function(o){if("0"==o.status){e.$pluginComponents.$objectCache.setObject("userObject",o.data),e.$pluginComponents.$accessToken.set(o.data.accessToken),e.$rootScope.accessToken=o.data.accessToken,e.Preferences.putString("uid",o.data.id);var t={uid:o.data.id,tid:o.data.tenantId};window.plugins&&window.plugins.OnlinePlugin&&window.plugins.OnlinePlugin.onlineStart(t),void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},o.data.accessToken).then(function(e){}),e.$scope.unReadMessage(),e.$uiComponents.$toast.show("登录成功"),"0"==o.data.tenantId&&""==o.data.tenantId||e.$pluginComponents.$tenantId.set(o.data.tenantId),e.$state.go("home.course",{reload:!0})}else e.$state.go("escrow_login",{keyType:s},{reload:!0})})}},e.$scope.goWechat=function(){var e={type:"wechat"};window.plugins.SharePlugin&&window.plugins.SharePlugin.login(e)},window.loginQqData=function(o){if(o){var t=o.userId,s=o.type;e.$pluginComponents.$objectCache.setObject("escrowObject",o),e.$loginSrv.getEscrow(t,s,"").then(function(o){if("0"==o.status){e.$pluginComponents.$objectCache.setObject("userObject",o.data),e.$pluginComponents.$accessToken.set(o.data.accessToken),e.$rootScope.accessToken=o.data.accessToken,e.Preferences.putString("uid",o.data.id);var t={uid:o.data.id,tid:o.data.tenantId};window.plugins&&window.plugins.OnlinePlugin&&window.plugins.OnlinePlugin.onlineStart(t),void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},o.data.accessToken).then(function(e){}),e.$scope.unReadMessage(),e.$uiComponents.$toast.show("登录成功"),"0"==o.data.tenantId&&""==o.data.tenantId||e.$pluginComponents.$tenantId.set(o.data.tenantId),e.$state.go("home.course",{reload:!0})}else e.$state.go("escrow_login",{keyType:s},{reload:!0})})}},e.$scope.goqq=function(){var e={type:"qq"};window.plugins.SharePlugin&&window.plugins.SharePlugin.login(e)},e.$scope.unReadMessage=function(){e.$profilesSrv.unReadMessage(e.$pluginComponents.$accessToken.get()).then(function(o){0==o.status&&(e.$rootScope.unReadMsg=o.data)})},e.$scope.hideGuide=function(){e.$scope.guide=1,window.localStorage.setItem("registerGuide",1),e.$scope.safeApply()}},e.inheritFromCtrl(e.users.loginNoCtrl),e.registerDependency("gxb.controllers.users.loginNoCtrl",["Comment","gxb.services.users.loginSrv","gxb.models.users.loginNoModel","gxb.models.users.jpushinitModel","gxb.services.profiles.profilesSrv","Preferences"]),e.registerView("gxb.controllers.users.loginNoCtrl","user_login_no")}(gxb.controllers),function(e){e.users.meCtrl=function(e){e.$scope.auth=0,e.$scope.isShow="none",e.$scope.courseStatus="学习中",e.$scope.noLogin=0;var o=!0;e.$scope.downloadingNum=0,e.$scope.tokenStatus=!0,e.$scope.authenticationList={},e.$scope.certType=e.$pluginComponents.$tenantCertType.get(),e.$scope.accessToken=e.$pluginComponents.$accessToken.get();var t=e.$pluginComponents.$tenantId.get(),s=e.$pluginComponents.$accessToken.get();e.Preferences.putString("page","me"),e.$scope.isShowProject=!1,e.$scope.isCxcyAuth=!1,e.$scope.tenantId=t,e.$scope.platformType2=function(){return"IOS"==e.$rootScope.platformType?"90%":"94%"};var n=function(o){document.addEventListener("deviceready",function(){for(var t in o)window.plugins.ImageCachePlugin.cache(o[t].image,t,function(t){var s=gxb.utils.jsonUtils.toObject(t);o[s.index].cache=s.cache,e.$scope.safeApply()})})};e.$profilesSrv.unReadMessage(e.$pluginComponents.$accessToken.get()).then(function(o){0==o.status&&(e.$rootScope.unReadMsg=o.data,e.$scope.safeApply())}),e.$profilesSrv.getAuthentication(e.$scope.accessToken).then(function(t){0==t.status?e.$scope.safeApply(function(){e.$scope.authenticationList=t.data}):400==t.status&&(o=!1,e.$scope.tokenStatus=!1),e.$scope.accessToken&&o?(e.$scope.noLogin=0,e.$scope.meInfo=e.$pluginComponents.$objectCache.getObject("userObject"),e.$scope.safeApply()):(e.$scope.noLogin=1,e.$scope.meInfo=null,e.$scope.safeApply())}),e.$scope.going=0;var i=function(o){e.$learnSrv.getDoGoing(o,1).then(function(o){if(e.$uiComponents.$loadding.hide(),o.data&&o.data.dataList&&o.data.dataList.length>0){e.$scope.going=0;var t,s=[];for(t in o.data.dataList){if(s[t]=new e.$cardModel(o.data.dataList[t]),s[t].image)var i=s[t].image.substring(0,s[t].image.lastIndexOf("."))+"_small"+s[t].image.substring(s[t].image.lastIndexOf("."));s[t].image=i,s[t].cache="./images/course_cover_def.png"}e.$scope.safeApply(function(){e.$scope.authCourse=s,n(e.$scope.authCourse)})}else e.$scope.safeApply(function(){e.$scope.going=1})},function(){e.$scope.safeApply(function(){e.$scope.networkStates1="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),e.$uiComponents.$loadding.hide()})};e.$scope.accessToken&&o&&i(e.$scope.accessToken),e.$scope.will=0,e.$scope.accessToken&&o&&e.$learnSrv.getWillStart(e.$scope.accessToken,1).then(function(o){if(o.data.dataList&&o.data.dataList.length>0){e.$scope.will=0;var t,s=[];for(t in o.data.dataList){if(s[t]=new e.$cardModel(o.data.dataList[t]),s[t].image)var i=s[t].image.substring(0,s[t].image.lastIndexOf("."))+"_small"+s[t].image.substring(s[t].image.lastIndexOf("."));s[t].image=i,s[t].cache="./images/course_cover_def.png"}e.$scope.willStartCourse=s,n(e.$scope.willStartCourse)}else e.$scope.will=1},function(){e.$scope.safeApply(function(){e.$scope.networkStates2="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),e.$uiComponents.$loadding.hide()}),e.$scope.ends=0,e.$scope.accessToken&&o&&e.$learnSrv.getIsEnd(e.$scope.accessToken,1).then(function(o){if(o.data.dataList&&o.data.dataList.length>0){e.$scope.ends=0;var t,s=[];for(t in o.data.dataList){if(s[t]=new e.$cardModel(o.data.dataList[t]),s[t].image)var i=s[t].image.substring(0,s[t].image.lastIndexOf("."))+"_small"+s[t].image.substring(s[t].image.lastIndexOf("."));s[t].image=i,s[t].cache="./images/course_cover_def.png"}e.$scope.isEndCourse=s,n(e.$scope.isEndCourse)}else e.$scope.ends=1},function(){e.$scope.safeApply(function(){e.$scope.networkStates3="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),e.$uiComponents.$loadding.hide()}),e.$scope.selectView=function(){e.$scope.isShow="block"},e.$scope.tabMeHideBox=function(){e.$scope.isShow="none"},e.$scope.doGoing=function(){e.$scope.isShow="none",e.$scope.auth=0,e.$scope.courseStatus="学习中"},e.$scope.willStart=function(){e.$scope.isShow="none",e.$scope.auth=1,e.$scope.courseStatus="未开课"},e.$scope.isEnds=function(){e.$scope.isShow="none",e.$scope.auth=2,e.$scope.courseStatus="已结课"},e.$rootScope.messageDate>0?e.$scope.messageRead="display:block":e.$scope.messageRead="",e.Download.getAllTaskNum({success:function(o){var t=gxb.utils.jsonUtils.toObject(o);t.length>0&&(e.$scope.downloadingNum=t[0],e.$scope.safeApply())}}),e.$scope.meState=function(){return e.$scope.accessToken&&o?1==e.$scope.authenticationList.length?"<span>"+e.$scope.authenticationList[0].schoolName+"</span>":e.$scope.authenticationList.length>1?"<span>"+e.$scope.authenticationList[0].schoolName+"等 "+e.$scope.authenticationList.length+" 所学校</span>":0==e.$scope.authenticationList.length?"<span>尚未认证学生身份</span>":void 0:"<span class='not_logged'>未登录</span>"},e.$scope.isLogin=function(){return e.$scope.accessToken&&o?"<a class='fl_right ion-chevron-right go_next'></a>":"<a class='me_login fl_right'>登录/注册</a>"},e.$scope.mesCenter=function(){e.$scope.accessToken&&o?"block"==e.$scope.isShow?e.$scope.isShow="none":e.$state.go("settings_message",{reload:!0}):e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})},e.$scope.personal=function(){e.$scope.accessToken&&o?"block"==e.$scope.isShow?e.$scope.isShow="none":e.$state.go("settings_personal",{reload:!0}):e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})},e.$scope.download=function(){e.$scope.accessToken&&o?"block"==e.$scope.isShow?e.$scope.isShow="none":e.$state.go("settings_download",{reload:!0}):e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})},e.$scope.setting=function(){e.$scope.accessToken&&o?"block"==e.$scope.isShow?e.$scope.isShow="none":e.$state.go("settings_about",{},{reload:!0}):e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})},e.$scope.goToHelpCenter=function(){e.$state.go("help_center",{},{reload:!0})},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})},e.$scope.goIntro=function(o,t){"Self"==t?e.$state.go("invitation_detail",{id:o,type:t},{reload:!0}):e.$state.go("courses_detail",{id:o,types:t},{reload:!0})},e.$scope.reloadPage=function(){e.$scope.networkStates1=e.$scope.networkStates2=e.$scope.networkStates3="",gxb.controllers.users.meCtrl(e)},e.$profilesSrv.getCxcyAuth(e.$scope.accessToken).then(function(o){o&&(e.$scope.isCxcyAuth=!0,e.$scope.safeApply())}),e.$scope.myProject=function(){s&&!e.$scope.isCxcyAuth?e.$state.go("settings_personal_addValidate",{type:"1"},{reload:!0}):e.Project.goProject(s,gxb.utils.jsonUtils.toObject(window.localStorage.userObject).id)},e.$scope.myProjects=function(){e.$scope.accessToken&&o?e.$profilesSrv.getCxcy(e.$scope.accessToken).then(function(o){o&&(e.$scope.isShowProject=!0),e.$scope.safeApply()}):e.$scope.isShowProject=!1},e.$scope.myProjects(),window.updateNum=function(o){o&&(e.$scope.downloadingNum=o[0],e.$scope.safeApply())},e.$scope.$on("$stateChangeStart",function(){e.Preferences.putString("page","")})},e.inheritFromCtrl(e.users.meCtrl),e.registerDependency("gxb.controllers.users.meCtrl",["$timeout","Comment","gxb.services.profiles.profilesSrv","$sce","Play","Download","Project","gxb.services.learning.learnSrv","gxb.models.courses.cardModel","Preferences"]),e.registerView("gxb.controllers.users.meCtrl","tab_me")}(gxb.controllers),function(e){e.users.newPasswordCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$forgetModel=new e.$forgetModel,e.$scope.$forgetModel.mobile=e.$pluginComponents.$objectCache.get("mobile"),e.$scope.$forgetModel.validateCode=e.$pluginComponents.$objectCache.get("validateCode"),e.$scope.upPassword=function(){if(e.$loginSrv.isNoEmpty(this.$forgetModel)){if(!e.$loginSrv.verifyPassword(this.$forgetModel.encrypted_password))return e.$uiComponents.$toast.show("请输入6-16位数字、字母或符号的组合\r\n(至少两种类型字符组合)"),!1;e.$uiComponents.$loadding.show(),e.$forgetSrv.forgetPassword(e.$scope.$forgetModel).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$uiComponents.$toast.show("修改成功"),e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})}}},e.inheritFromCtrl(e.users.newPasswordCtrl),e.registerDependency("gxb.controllers.users.newPasswordCtrl",["gxb.services.users.forgetSrv","gxb.services.users.loginSrv","gxb.models.users.forgetModel"]),e.registerView("gxb.controllers.users.newPasswordCtrl","user_newPassword")}(gxb.controllers),function(e){e.users.receiveCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$forgetModel=new e.$forgetModel,e.$scope.$forgetModel.mobile=e.$pluginComponents.$objectCache.get("mobile"),e.$scope.mobile=e.$pluginComponents.$objectCache.get("mobile"),e.$scope.countdown=function(){e.$scope.paracont="获取验证码",e.$scope.paraclass="but_null",e.$scope.paraevent=!0,e.$scope.second=60,e.$scope.timePromise=void 0,e.$scope.timePromise=e.$interval(function(){e.$scope.second<=0?(e.$interval.cancel(e.$scope.timePromise),e.$scope.timePromise=void 0,e.$scope.second=60,e.$scope.paracont="没有收到验证码?",e.$scope.paraclass="but_null",e.$scope.paraevent=!0):(e.$scope.paracont=e.$sce.trustAsHtml(e.$scope.second+"秒后可重新获取验证码"),e.$scope.paraclass="not but_null",e.$scope.second--)},1e3,100)},e.$scope.countdown(),e.$scope.goAgainGetCode=function(){return e.$loginSrv.verifyMobile(e.$scope.mobile)?(e.$uiComponents.$loadding.show(),void e.$forgetSrv.sendCode(e.$pluginComponents.$objectCache.get("mobile")).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$scope.countdown(),e.$uiComponents.$toast.show("发送验证码成功!")):e.$uiComponents.$toast.show(o.message)},function(){
e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})):(e.$uiComponents.$toast.show("请输入正确的手机格式!"),!1)},e.$scope.newPassword=function(){e.$loginSrv.isNoEmptyValue(this.$forgetModel.validateCode)&&(e.$uiComponents.$loadding.show(),e.$forgetSrv.validateCode(e.$scope.$forgetModel).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$pluginComponents.$objectCache.set("mobile",e.$pluginComponents.$objectCache.get("mobile")),e.$pluginComponents.$objectCache.set("validateCode",e.$scope.$forgetModel.validateCode),e.$state.go("account_forgot_password_new",{},{reload:!0})):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}))}},e.inheritFromCtrl(e.users.receiveCtrl),e.registerDependency("gxb.controllers.users.receiveCtrl",["gxb.services.users.forgetSrv","gxb.services.users.loginSrv","gxb.models.users.forgetModel","$interval","$sce"]),e.registerView("gxb.controllers.users.receiveCtrl","user_receive")}(gxb.controllers),function(e){e.users.regCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()};var o=e.$stateParams.mobile;e.$scope.$regModel=new e.$regModel,e.$stateParams?e.$scope.$regModel.mobile=o:e.$scope.$regModel.mobile="",e.$scope.goGetCode=function(){if(e.$loginSrv.isNoEmptyValue(this.$regModel.mobile)){if(!e.$loginSrv.verifyMobile(this.$regModel.mobile))return e.$uiComponents.$toast.show("手机号码格式不对，请重新输入"),!1;e.$pluginComponents.$objectCache.set("mobile",e.$scope.$regModel.mobile),e.$uiComponents.$loadding.show(),e.$regSrv.getSendCode(e.$scope.$regModel.mobile).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$uiComponents.$toast.show("发送验证码成功!"),e.$state.go("account_signup_verify",{},{reload:!0})):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})}},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})},e.$scope.agreement=function(){e.$state.go("account_signup_agreement",{mobile:e.$scope.$regModel.mobile},{reload:!0})}},e.inheritFromCtrl(e.users.regCtrl),e.registerDependency("gxb.controllers.users.regCtrl",["Comment","gxb.services.users.regSrv","gxb.services.users.loginSrv","gxb.models.users.regModel"]),e.registerView("gxb.controllers.users.regCtrl","user_register")}(gxb.controllers),function(e){e.users.regEndCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$regModel=new e.$regModel,e.$scope.$regModel.mobile=e.$pluginComponents.$objectCache.get("mobile"),e.$scope.$regModel.tenantId=e.$pluginComponents.$tenantId.get(),e.$scope.$regModel.validateCode=e.$pluginComponents.$objectCache.get("validateCode"),e.$scope.goRegister=function(){if(e.$loginSrv.isNoEmptyValue(this.$regModel.password)){if(!e.$loginSrv.verifyPassword(this.$regModel.password))return e.$uiComponents.$toast.show("6~16位至少包含数字、字母或符号的两种"),!1;e.$uiComponents.$loadding.show(),e.$regSrv.doSignUp(e.$scope.$regModel).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$uiComponents.$toast.show("注册成功!"),e.$pluginComponents.$objectCache.setObject("userObject",o.data),e.$pluginComponents.$accessToken.set(o.data.accessToken),e.$state.go("user_bind_studentno",{reload:!0})):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})}},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})}},e.inheritFromCtrl(e.users.regEndCtrl),e.registerDependency("gxb.controllers.users.regEndCtrl",["Comment","gxb.services.users.regSrv","gxb.models.users.regModel","gxb.models.users.loginModel","gxb.services.users.loginSrv"]),e.registerView("gxb.controllers.users.regEndCtrl","user_registerEnd")}(gxb.controllers),function(e){e.users.regNextCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$regModel=new e.$regModel,e.$scope.$regModel.mobile=e.$pluginComponents.$objectCache.get("mobile"),e.$scope.mobile=e.$scope.$regModel.mobile,e.$scope.countdown=function(){e.$scope.paracont="获取验证码",e.$scope.paraclass="but_null",e.$scope.paraevent=!0,e.$scope.second=60,e.$scope.timePromise=void 0,e.$scope.timePromise=e.$interval(function(){e.$scope.second<=0?(e.$interval.cancel(e.$scope.timePromise),e.$scope.timePromise=void 0,e.$scope.second=60,e.$scope.paracont="没有收到验证码?",e.$scope.paraclass="but_null",e.$scope.paraevent=!0):(e.$scope.paracont=e.$sce.trustAsHtml(e.$scope.second+"秒后可重新获取验证码"),e.$scope.paraclass="not but_null",e.$scope.second--)},1e3,100)},e.$scope.countdown(),e.$scope.goAgainGetCode=function(){return e.$loginSrv.verifyMobile(e.$scope.mobile)?(e.$uiComponents.$loadding.show(),void e.$regSrv.getSendCode(e.$pluginComponents.$objectCache.get("mobile")).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$scope.countdown(),e.$uiComponents.$toast.show("发送验证码成功!")):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})):(e.$uiComponents.$toast.show("请输入正确的手机格式!"),!1)},e.$scope.setPassword=function(){e.$loginSrv.isNoEmptyValue(this.$regModel.validateCode)&&(e.$uiComponents.$loadding.show(),e.$pluginComponents.$objectCache.set("validateCode",e.$scope.$regModel.validateCode),e.$regSrv.verifySmsCode(e.$scope.$regModel).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?e.$state.go("account_signup_pwd",{},{reload:!0}):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}))},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})}},e.inheritFromCtrl(e.users.regNextCtrl),e.registerDependency("gxb.controllers.users.regNextCtrl",["Comment","gxb.services.users.regSrv","gxb.services.users.loginSrv","gxb.models.users.regModel","$interval","$sce"]),e.registerView("gxb.controllers.users.regNextCtrl","user_registerNext")}(gxb.controllers),function(e){e.users.userValidateCodeCtrl=function(e){var o=e.$stateParams.userId;e.$scope.paracont="获取验证码",e.$scope.paraclass="escrow_yzm",e.$scope.paraevent=!0,e.$scope.second=60,e.$scope.timePromise=void 0,e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$regModel=new e.$regModel,e.$scope.goCode=function(){return e.$loginSrv.verifyMobile(this.$regModel.mobile)?(e.$uiComponents.$loadding.show(),void e.$regSrv.getSendCode(e.$scope.$regModel.mobile).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$uiComponents.$toast.show("发送验证码成功!"),e.$scope.timePromise=e.$interval(function(){e.$scope.second<=0?(e.$interval.cancel(e.$scope.timePromise),e.$scope.timePromise=void 0,e.$scope.second=60,e.$scope.paracont="获取验证码",e.$scope.paraclass="escrow_yzm",e.$scope.paraevent=!0):(e.$scope.paracont=e.$sce.trustAsHtml(e.$scope.second+"秒后重发"),e.$scope.paraclass="no_yzm",e.$scope.second--)},1e3,100)):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})):(e.$uiComponents.$toast.show("请输入正确的手机格式!"),!1)},e.$scope.nextStep=function(){e.$regSrv.verifySmsCode(e.$scope.$regModel).then(function(t){0==t.status?e.$state.go("user_validate_newPassword",{userId:o,username:e.$scope.$regModel.mobile},{reload:!0}):e.$uiComponents.$toast.show(t.message)})}},e.inheritFromCtrl(e.users.userValidateCodeCtrl),e.registerDependency("gxb.controllers.users.userValidateCodeCtrl",["gxb.models.users.regModel","$interval","$sce","gxb.services.users.regSrv","gxb.services.users.loginSrv"]),e.registerView("gxb.controllers.users.userValidateCodeCtrl","user_validate_code")}(gxb.controllers),function(e){e.users.userValidateNewPasswordCtrl=function(e){var o=e.$stateParams.userId,t=e.$stateParams.username;e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$bindingNoModel=new e.$bindingNoModel,e.$scope.$bindingNoModel.userId=o,e.$scope.$bindingNoModel.username=t,e.$scope.getEnd=function(){if(e.$scope.$bindingNoModel.password==e.$scope.$bindingNoModel.confirmPassword){if(!e.$loginSrv.verifyPassword(e.$scope.$bindingNoModel.password))return e.$uiComponents.$toast.show("请输入6-16位数字、字母或符号的组合\r\n(至少两种类型字符组合)"),!1;e.$uiComponents.$loadding.show(),e.$loginSrv.getNewPassword(e.$scope.$bindingNoModel).then(function(o){if(e.$uiComponents.$loadding.hide(),0==o.status){var t=e.$pluginComponents.$objectCache.getObject("userObject");t.password=e.$scope.$bindingNoModel.password,e.$pluginComponents.$objectCache.setObject("userObject",t),e.$uiComponents.$toast.show("密码修改成功"),e.$state.go("user_login_no",{reload:!0})}})}else e.$uiComponents.$toast.show("两次输入的密码不一致")}},e.inheritFromCtrl(e.users.userValidateNewPasswordCtrl),e.registerDependency("gxb.controllers.users.userValidateNewPasswordCtrl",["gxb.models.users.bindingNoModel","gxb.services.users.loginSrv"]),e.registerView("gxb.controllers.users.userValidateNewPasswordCtrl","user_validate_newPassword")}(gxb.controllers),function(e){e.users.userValidateSchoolCtrl=function(e){e.$scope.schoolName="",e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.schoolList=function(){e.$pluginComponents.$chooseSchoolType.set(1),e.$state.go("school",{type:1},{reload:!0})},e.$scope.$addValidateModel=new e.$addValidateModel,e.$rootScope.$on("$choice",function(o,t,s){e.$scope.schoolName=t,e.$scope.tenantId=s,e.$scope.$addValidateModel.tenantId=e.$scope.tenantId}),e.$scope.nextStep=function(){e.$uiComponents.$loadding.show(),e.$loginSrv.getValidateSchool(e.$scope.$addValidateModel).then(function(o){if(e.$uiComponents.$loadding.hide(),0==o.status)if(o.data.mobile||o.data.email){if(o.data.mobile){e.$ionicPopup.show({template:"<p>该帐号已绑定手机号"+o.data.mobile+",请通过手机号找回密码</p>",title:"提示",scope:e.$scope,buttons:[{text:"我知道了"},{text:"<b>手机号找回</b>",type:"button-positive",onTap:function(t){e.$state.go("account_forgot_password",{mobile:o.data.mobile})}}]})}else if(o.data.email){e.$ionicPopup.alert({title:"提示",template:"<p>该帐号已绑定邮箱"+o.data.email+",请在PC高校邦网站找回</p>",buttons:[{text:"<b>我知道了</b>",type:"button-positive"}]});return!1}}else e.$state.go("user_validate_code",{userId:o.data.userId},{reload:!0});else 1==o.status&&e.$uiComponents.$toast.show(o.message)})}},e.inheritFromCtrl(e.users.userValidateSchoolCtrl),e.registerDependency("gxb.controllers.users.userValidateSchoolCtrl",["$ionicPopup","gxb.models.profiles.addValidateModel","gxb.services.users.loginSrv"]),e.registerView("gxb.controllers.users.userValidateSchoolCtrl","user_validate_school")}(gxb.controllers),function(e){e.users.validateCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$bindingModel=new e.$bindingModel,e.$scope.$bindingModel.mobile=e.$stateParams.mobile,e.$scope.mobile=e.$stateParams.mobile,e.$scope.countdown=function(){e.$scope.paracont="获取验证码",e.$scope.paraclass="but_null",e.$scope.paraevent=!0,e.$scope.second=60,e.$scope.timePromise=void 0,e.$scope.timePromise=e.$interval(function(){e.$scope.second<=0?(e.$interval.cancel(e.$scope.timePromise),e.$scope.timePromise=void 0,e.$scope.second=60,e.$scope.paracont="没有收到验证码?",e.$scope.paraclass="but_null",e.$scope.paraevent=!0):(e.$scope.paracont=e.$sce.trustAsHtml(e.$scope.second+"秒后可重新获取验证码"),e.$scope.paraclass="not but_null",e.$scope.second--)},1e3,100)},e.$scope.countdown(),e.$scope.goAgainGetCode=function(){return e.$loginSrv.verifyMobile(e.$scope.$bindingModel.mobile)?(e.$uiComponents.$loadding.show(),void e.$bindingSrv.getBindCode(e.$scope.$bindingModel.mobile).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$scope.countdown(),e.$uiComponents.$toast.show("发送验证码成功!")):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})):(e.$uiComponents.$toast.show("请输入正确的手机格式!"),!1)},e.$scope.goToBinding=function(){e.$loginSrv.isNoEmpty(this.$bindingModel)&&(e.$uiComponents.$loadding.show(),e.$bindingSrv.goToBind(this.$bindingModel,e.$rootScope.mAccessToken||e.$pluginComponents.$accessToken.get()).then(function(o){if(e.$uiComponents.$loadding.hide(),"0"==o.status){e.$uiComponents.$toast.show("绑定成功"),e.$rootScope.$emit("$login");var t=e.$rootScope.mUserObject||e.$pluginComponents.$objectCache.getObject("userObject");if(t.mobile=e.$scope.mobile,e.$pluginComponents.$objectCache.setObject("userObject",t),e.$rootScope.mAccessToken){var s=e.$rootScope.mAccessToken,n=e.$rootScope.mSchoolObj;e.$pluginComponents.$accessToken.set(s),e.$rootScope.accessToken=s,e.$pluginComponents.$objectCache.setObject("schoolObject",n),window.mLogin()}e.$state.go("home.course",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})}else 400==o.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}))}},e.inheritFromCtrl(e.users.validateCtrl),e.registerDependency("gxb.controllers.users.validateCtrl",["gxb.services.users.bindingSrv","gxb.services.users.loginSrv","gxb.models.users.bindingModel","$interval","$sce"]),e.registerView("gxb.controllers.users.validateCtrl","user_validate")}(gxb.controllers),function(e){e.users.verifyCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.$authModel=new e.$authModel;var o=e.$pluginComponents.$objectCache.getObject("tenantObject");e.$scope.$authModel.tenantId=o.tenantId,e.$scope.$authModel.schoolName=o.schoolName,e.$scope.tentenId=e.$pluginComponents.$tenantId.get(),e.$scope.goToAuth=function(){e.$loginSrv.isNoEmpty(this.$authModel)&&(e.$uiComponents.$loadding.show(),e.$authSrv.goToAuth(e.$scope.$authModel,e.$pluginComponents.$accessToken.get()).then(function(o){if(e.$uiComponents.$loadding.hide(),"0"==o.status){e.$uiComponents.$toast.show(o.message);var t=e.$pluginComponents.$objectCache.getObject("userObject");t.bindingStatus="1",t.bindingCount="1",t.schoolName=e.$scope.$authModel.schoolName,t.name=e.$scope.$authModel.name,e.$pluginComponents.$objectCache.setObject("userObject",t),e.$state.go("home.learn",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})}else 400==res.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}))},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})}},e.inheritFromCtrl(e.users.verifyCtrl),e.registerDependency("gxb.controllers.users.verifyCtrl",["Comment","gxb.models.users.authModel","gxb.services.users.authSrv","gxb.services.users.loginSrv"]),e.registerView("gxb.controllers.users.verifyCtrl","user_verify")}(gxb.controllers),function(e){e.profiles.aboutOurCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.profiles.aboutOurCtrl),e.registerDependency("gxb.controllers.profiles.aboutOurCtrl",[]),e.registerView("gxb.controllers.profiles.aboutOurCtrl","about_our")}(gxb.controllers),function(e){e.profiles.addValidateCtrl=function(e){function o(o){document.getElementById("ionicScroll").style.height=window.screen.availHeight-108-o.keyboardHeight+"px",e.$ionicScrollDelegate.$getByHandle("schoolScroll").resize()}function t(o){document.getElementById("ionicScroll").style.height=window.screen.availHeight-108+"px",e.$ionicScrollDelegate.$getByHandle("schoolScroll").resize()}var s=e.$stateParams.id,n=e.$stateParams.study,i=e.$stateParams.type,c=e.$pluginComponents.$accessToken.get();e.$stateParams?e.$scope.schoolName=e.$stateParams.schoolName:e.$scope.schoolName="",e.$ionicModal.fromTemplateUrl("my-modal.html",{scope:e.$scope,animation:"slide-in-up",focusFirstInput:!0}).then(function(o){e.$scope.modal=o}),e.$scope.closeModal=function(){e.$scope.modal.hide()},e.$scope.$on("$destroy",function(){e.$scope.modal.remove()}),e.$scope.$addValidateModel=new e.$addValidateModel,e.$scope.$addValidateModel.tenantId=e.$stateParams.tenantId,e.$scope.subValidate=function(){e.$uiComponents.$loadding.show(),e.$profilesSrv.getAddValidate(e.$scope.$addValidateModel,e.$pluginComponents.$accessToken.get()).then(function(o){if(e.$uiComponents.$loadding.hide(),"0"==o.status)if(e.$uiComponents.$toast.show("认证成功"),1==i){e.$pluginComponents.$tenantId.set(e.$scope.$addValidateModel.tenantId);var t=e.$pluginComponents.$objectCache.getObject("userObject");t.bindingCount="1",t.bindingStatus="1",t.schoolName=e.$scope.schoolName,t.name=e.$scope.$addValidateModel.name,e.$pluginComponents.$objectCache.setObject("userObject",t),1==n?(e.$courseSrv.beginLearn(s,c).then(function(e){}),e.$state.go("courses_detail",{id:s,canBack:1},{reload:!0})):e.$state.go("course_item",{id:s},{reload:!0})}else if(3==i){e.$pluginComponents.$tenantId.set(e.$scope.$addValidateModel.tenantId);var t=e.$pluginComponents.$objectCache.getObject("userObject");t.bindingCount="1",t.bindingStatus="1",t.schoolName=e.$scope.schoolName,t.name=e.$scope.$addValidateModel.name,e.$pluginComponents.$objectCache.setObject("userObject",t),e.$rootScope.$emit("$login"),e.$state.go("home.course",{reload:!0})}else{e.$pluginComponents.$tenantId.set(e.$scope.$addValidateModel.tenantId);var t=e.$pluginComponents.$objectCache.getObject("userObject");t.bindingCount="1",t.bindingStatus="1",t.schoolName=e.$scope.schoolName,t.name=e.$scope.$addValidateModel.name,e.$pluginComponents.$objectCache.setObject("userObject",t),e.$rootScope.$emit("$login"),e.$state.go("home.me",{reload:!0})}else{if(1==o.status){e.$ionicPopup.alert({title:"认证失败了",cssClass:"customAlert",template:'<p style="margin-bottom:20px;"><span>常见原因1:</span><br />学号或姓名输入有误，请核对后重试（特别是名字带“·”的同学）</p><p><span>常见原因2:</span><br />学校尚未提供学生名单，请与学校教务老师确认后重试。</p>',buttons:[{text:"<b>我知道了</b>"}]});return!1}400==o.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):e.$uiComponents.$toast.show(o.message)}})},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$rootScope.$on("$choice",function(o,t,s){e.$scope.schoolName=t,e.$scope.tenantId=s,e.$scope.$addValidateModel.tenantId=e.$scope.tenantId}),e.$scope.redrawScroll=function(){e.$ionicScrollDelegate.$getByHandle("schoolScroll").resize(),e.$ionicScrollDelegate.$getByHandle("schoolScroll").scrollTop()},e.$scope.goSchool=function(){e.$scope.modal.show(),setTimeout(function(){e.$scope.schoolStyle="school_wrap","Android"==e.$rootScope.platformType?e.$scope.schoolStyle="school_wrap":e.$scope.schoolStyle="school_wraps",document.getElementById("ionicScroll").style.height=window.screen.availHeight-108+"px",window.addEventListener("native.keyboardshow",o),window.addEventListener("native.keyboardhide",t)},10)},e.$scope.selectThisSchool=function(o){e.$scope.$addValidateModel.tenantId=o.tenantId,e.$scope.schoolName=o.name,e.$scope.modal.hide()},e.$scope.order="name",e.$scope.schoolsList=["a"],e.$scope.searchName="",e.$schoolSrv.listSchools().then(function(o){if("0"==o.status){var t=o.data,s=[];for(var n in t)s[n]=new e.$schoolModel(t[n]);e.$scope.schoolsList=s,e.$scope.safeApply()}else e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},e.inheritFromCtrl(e.profiles.addValidateCtrl),e.registerDependency("gxb.controllers.profiles.addValidateCtrl",["$ionicPopup","$ionicModal","gxb.models.profiles.addValidateModel","gxb.services.profiles.profilesSrv","gxb.services.schools.schoolSrv","gxb.services.courses.courseSrv","gxb.models.schools.schoolModel","$ionicScrollDelegate"]),e.registerView("gxb.controllers.profiles.addValidateCtrl","me_addValidate")}(gxb.controllers),function(e){e.profiles.authenticationCtrl=function(e){e.$scope.authenInfo={},e.$profilesSrv.getAuthentication(e.$pluginComponents.$accessToken.get()).then(function(o){"0"==o.status?(e.$scope.authenInfo=o.data,e.$scope.safeApply()):400==o.status&&e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})}),e.$scope.addAuthen=function(){e.$state.go("settings_personal_addValidate",{type:0})},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.profiles.authenticationCtrl),e.registerDependency("gxb.controllers.profiles.authenticationCtrl",["gxb.services.profiles.profilesSrv"]),e.registerView("gxb.controllers.profiles.authenticationCtrl","me_authentication")}(gxb.controllers),function(e){e.profiles.collectionCtrl=function(e){e.$scope.tab=0,e.$profilesSrv.getMyCollection(e.$pluginComponents.$accessToken.get()).then(function(o){if(null==o.data.dataList)e.$scope.tab=1,e.$scope.safeApply();else{e.$scope.tab=0;var t,s=[];for(t in o.data.dataList){if(s[t]=new e.$cardModel(o.data.dataList[t]),s[t].image)var n=s[t].image.substring(0,s[t].image.lastIndexOf("."))+"_small"+s[t].image.substring(s[t].image.lastIndexOf("."));s[t].image=n,s[t].cache="./images/course_cover_def.png"}e.$scope.collections=s,e.$scope.safeApply(),document.addEventListener("deviceready",function(){for(var o in e.$scope.collections)window.plugins.ImageCachePlugin.cache(e.$scope.collections[o].image,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.collections[t.index].cache=t.cache,e.$scope.safeApply()})})}}),e.$scope.goIntro=function(o){e.$state.go("course_item",{reload:!0,id:o})},e.$scope["delete"]=function(o){var t=[];for(var s in e.$scope.collections)e.$scope.collections[s].id!=o&&t.push(e.$scope.collections[s]);e.$scope.collections=t,e.$courseSrv.deleteFavorite(o,e.$pluginComponents.$accessToken.get()).then(function(o){400==o.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):"0"==o.status})},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.profiles.collectionCtrl),e.registerDependency("gxb.controllers.profiles.collectionCtrl",["gxb.services.profiles.profilesSrv","gxb.models.courses.cardModel","gxb.services.courses.courseSrv"]),e.registerView("gxb.controllers.profiles.collectionCtrl","me_collection")}(gxb.controllers),function(e){e.profiles.downloadChapterCtrl=function(e){function o(e){return function(o,t){var s=o[e],n=t[e];return s-n}}e.$scope.deleteBtn=!1,e.$scope.showMore=!1,e.$scope.editAndCancel="删除",e.$scope.allSelectOrNot="全选",e.$scope.num=0;var t=0,s=[],n=e.$stateParams.id,i=e.$pluginComponents.$objectCache.getObject("userObject").id,c=gxb.utils.jsonUtils.toObject(window.localStorage.getItem("downloadClasses")),a=e.$pluginComponents.$objectCache.getObject("userObject").tenantId||e.$pluginComponents.$tenantId.get(),r=[{classId:n,uid:i}];if(e.$scope.changeHeight=function(){return"IOS"==e.$rootScope.platformType?"90%":"94%"},e.Preferences.putString("page","downloadChapter"),c.length)for(var p=0;p<c.length;p++)c[p].classId==n&&e.$scope.safeApply(function(){e.$scope.className=c[p].className});e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()};var l=function(){e.Download.getTaskDetailByClassId({success:function(s){var n=gxb.utils.jsonUtils.toObject(s);if(n)for(var i=0;i<n.length;i++)n[i].videoModels&&(n[i].videoModels=n[i].videoModels.sort(o("chapterIndex")));e.$scope.safeApply(function(){e.$scope.chapterList=n});for(var c=0;c<e.$scope.chapterList.length;c++)e.$scope.chapterList[c].videoModels.length>0&&(t+=e.$scope.chapterList[c].videoModels.length)}},r)};l(),e.$scope.deleteCon=function(){"删除"==e.$scope.editAndCancel?e.$scope.safeApply(function(){e.$scope.editAndCancel="取消",e.$scope.deleteBtn=!0,e.$scope.showMore=!0}):e.$scope.safeApply(function(){e.$scope.deleteBtn=!1,e.$scope.showMore=!1,e.$scope.num=0,e.$scope.allSelectOrNot="全选",e.$scope.editAndCancel="删除"})},e.$scope.checkedIcon=function(o){if(o.checked=!o.checked,1==o.checked){if(o.videoModels.length>0){e.$scope.state=[];for(var n=0;n<o.videoModels.length;n++){var i={chapterId:o.videoModels[n].chapterId};0==o.videoModels[n].check?(e.$scope.state.push(1),s.push(i)):e.$scope.state.push(0),o.videoModels[n].check=!0}e.$scope.number=0;for(var c=0;c<e.$scope.state.length;c++)1==e.$scope.state[c]&&e.$scope.number++;e.$scope.num=e.$scope.num+e.$scope.number,t==e.$scope.num&&(e.$scope.allSelectOrNot="取消全选")}}else if(o.videoModels.length>0){for(var n=0;n<o.videoModels.length;n++)if(o.videoModels[n].check=!1,e.$scope.num--,s.length)for(var c=0;c<s.length;c++)s[c].chapterId==o.videoModels[n].chapterId&&s.splice(c,1);t>e.$scope.num&&e.$scope.safeApply(function(){e.$scope.allSelectOrNot="全选"})}},e.$scope.getChecked=function(o,c){var r={chapterId:o.chapterId};if(o.check=!o.check,1==e.$scope.deleteBtn)if("取消全选"==e.$scope.allSelectOrNot){if(0==o.check){c.checked=!1,e.$scope.num--,e.$scope.allSelectOrNot="全选";for(var p=0;p<s.length;p++)s[p].chapterId==o.chapterId&&s.splice(p,1)}}else if(1==o.check){e.$scope.num++,s.push(r);for(var l=0,p=0;p<c.videoModels.length;p++)1==c.videoModels[p].check&&(l++,l==c.videoModels.length&&(c.checked=!0));t==e.$scope.num&&e.$scope.safeApply(function(){e.$scope.allSelectOrNot="取消全选"})}else{e.$scope.safeApply(function(){e.$scope.num--,c.checked=!1});for(var p=0;p<s.length;p++)s[p].chapterId==o.chapterId&&s.splice(p,1)}else e.Play.play(1,n,o.chapterId,e.$pluginComponents.$objectCache.getObject("schoolObject").schoolId,a,e.$pluginComponents.$accessToken.get(),o.videoPath,o.chapterName,i,function(){})},e.$scope.selectAll=function(){if("全选"==e.$scope.allSelectOrNot){if(s=[],e.$scope.allSelectOrNot="取消全选",e.$scope.chapterList)for(var o=0;o<e.$scope.chapterList.length;o++){e.$scope.chapterList[o].checked=!0;for(var n=0;n<e.$scope.chapterList[o].videoModels.length;n++){e.$scope.chapterList[o].videoModels[n].check=!0;var i={chapterId:e.$scope.chapterList[o].videoModels[n].chapterId};s.push(i)}e.$scope.num=t}}else if(e.$scope.allSelectOrNot="全选",e.$scope.chapterList)for(var o=0;o<e.$scope.chapterList.length;o++){e.$scope.chapterList[o].checked=!1;for(var n=0;n<e.$scope.chapterList[o].videoModels.length;n++)e.$scope.chapterList[o].videoModels[n].check=!1;e.$scope.num=0,s=[]}},e.$scope.deleteAll=function(o){if(0==o)e.$uiComponents.$toast.show("请先选择您要删除的视频");else{e.$ionicPopup.show({template:"确定删除已选文件？",title:"提示",scope:e.$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(o){e.Download.deleteByChapterId({success:function(o){var t=gxb.utils.jsonUtils.toObject(o);if(1==t){for(var s=0;s<e.$scope.chapterList.length;s++)if(e.$scope.chapterList[s].checked===!0)e.$scope.safeApply(function(){e.$scope.chapterList.splice(s,1),s--});else for(var n=0;n<e.$scope.chapterList[s].videoModels.length;n++)1==e.$scope.chapterList[s].videoModels[n].check&&e.$scope.safeApply(function(){e.$scope.chapterList[s].videoModels.splice(n,1),n--});e.$scope.safeApply(function(){e.$scope.num=0,e.$scope.deleteBtn=!1,e.$scope.editAndCancel="删除"}),0==e.$scope.chapterList.length&&e.$scope.safeApply(function(){e.$scope.deleteBtn=!1,e.$scope.showMore=!1})}else e.$uiComponents.$toast.show("删除失败！")}},s)}}]})}},window.changeOfflineStatus=function(){l()},e.$scope.goCourse=function(){e.$state.go("courses_detail",{id:n,types:"Class"},{reload:!0})}},e.inheritFromCtrl(e.profiles.downloadChapterCtrl),e.registerDependency("gxb.controllers.profiles.downloadChapterCtrl",["$ionicPopup","Play","Download","Preferences"]),e.registerView("gxb.controllers.profiles.downloadChapterCtrl","me_download_chapter")}(gxb.controllers),function(e){e.profiles.downloadCtrl=function(e){e.$scope.flag={showDelete:!1},e.$scope.deleteBtn=!1,e.$scope.allSelectOrNot="全选",e.$scope.editAndCancel="删除",e.$scope.num=0,e.$scope.tab=0,e.$scope.privateNoteList=[];var o=[],t=gxb.utils.jsonUtils.toObject(window.localStorage.getItem("downloadClasses"));e.Preferences.putString("page","download"),e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.Download.getAllClassesAndFinishedTask({success:function(o){var s=gxb.utils.jsonUtils.toObject(o);if(s.length>0){e.$scope.safeApply(function(){e.$scope.tab=1});for(var n=0;n<s.length;n++)for(var i=0;i<t.length;i++)if(s[n].classId==t[i].classId){var c={};c.classCover=t[i].classCover,c.classId=t[i].classId,c.className=t[i].className,c.classType=t[i].classType,c.examNum=t[i].examNum,c.finishedTasksNum=s[n].finishedTasksNum,c.videoNumber=t[i].videoNumber,e.$scope.privateNoteList.push(c)}}else e.$scope.safeApply(function(){e.$scope.tab=0})}}),e.Download.getDownloadFileSize({success:function(o){var t=gxb.utils.jsonUtils.toObject(o);t&&e.$scope.safeApply(function(){e.$scope.availableSize=t.availableSize,e.$scope.allTaskNum=t.allTaskNum,e.$scope.netSpeed=t.netSpeed})}}),window.downloadFileSize=function(o){o&&e.$scope.safeApply(function(){e.$scope.availableSize=o.availableSize,e.$scope.allTaskNum=o.allTaskNum})},window.updateNetworkSpeed=function(o){o&&(e.$scope.netSpeed=o.netSpeed),e.$scope.safeApply()},window.downloadingSize=function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.safeApply(function(){e.$scope.currentFileSize=(t/1024/1024).toFixed(1)})},e.$scope.getWidth=function(){var o=(e.$scope.currentFileSize/e.$scope.totalFileSize*100).toFixed(1);return o>100&&(o=100),o},window.changeFinishedTasksNum=function(o){if(o)for(var t=0;t<e.$scope.privateNoteList.length;t++)o[0].classId==e.$scope.privateNoteList[t].classId&&(e.$scope.privateNoteList[t].finishedTasksNum=o[0].finishedTasksNum,e.$scope.safeApply())},e.$scope.deleteCon=function(){if(e.$scope.flag.showDelete=!e.$scope.flag.showDelete,"删除"==e.$scope.editAndCancel)e.$scope.safeApply(function(){e.$scope.editAndCancel="取消",e.$scope.allSelectOrNot="全选",e.$scope.deleteBtn=!0});else{e.$scope.safeApply(function(){e.$scope.editAndCancel="删除",e.$scope.deleteBtn=!1,e.$scope.allSelectOrNot="全选",e.$scope.num=0});for(var o=0;o<e.$scope.privateNoteList.length;o++)e.$scope.privateNoteList[o].checked=!1}},e.$scope.noteChecked=function(t){if(t.checked=!t.checked,0==t.checked){if(e.$scope.num>0){e.$scope.num--;for(var s=0;s<o.length;s++)o[s].classId==t.classId&&o.splice(s,1)}else e.$scope.num=0,o=[];e.$scope.allSelectOrNot="全选"}else{var n={classId:t.classId};o.push(n),e.$scope.num++,e.$scope.num==e.$scope.privateNoteList.length&&(e.$scope.allSelectOrNot="取消全选")}},e.$scope.selectAll=function(){if("全选"==e.$scope.allSelectOrNot){for(var t=0;t<e.$scope.privateNoteList.length;t++){var s={classId:e.$scope.privateNoteList[t].classId};e.$scope.privateNoteList[t].checked=!0,e.$scope.num++,o.push(s)}e.$scope.allSelectOrNot="取消全选"}else{for(var t=0;t<e.$scope.privateNoteList.length;t++)e.$scope.privateNoteList[t].checked=!1;e.$scope.allSelectOrNot="全选",e.$scope.num=0,o=[]}},e.$scope.deleteAll=function(t){if(0==t)e.$uiComponents.$toast.show("请先选择您要删除的视频");else{e.$ionicPopup.show({template:"操作不可恢复，确定删除这"+t+"门课程下的所有已下载视频？",title:"提示",scope:e.$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(t){e.Download.deleteByClassId({success:function(o){var t=gxb.utils.jsonUtils.toObject(o);if(1==t)for(var s=0;s<e.$scope.privateNoteList.length;s++)e.$scope.privateNoteList[s].checked===!0&&e.$scope.safeApply(function(){e.$scope.privateNoteList[s].finishedTasksNum=0,e.$scope.privateNoteList[s].checked=!1,e.$scope.editAndCancel="删除",e.$scope.flag={showDelete:!1},e.$scope.deleteBtn=!1,e.$scope.num=0});else e.$uiComponents.$toast.show("删除失败！");
}},o)}}]})}},e.$scope.goDownloading=function(){"删除"==e.$scope.editAndCancel&&e.$state.go("settings_downloading",{reload:!0})},e.$scope.downloadChapter=function(o){e.$state.go("settings_downloadChapter",{id:o},{reload:!0})},e.$scope.$on("$stateChangeStart",function(){e.Preferences.putString("page","")})},e.inheritFromCtrl(e.profiles.downloadCtrl),e.registerDependency("gxb.controllers.profiles.downloadCtrl",["$ionicPopup","Download","Preferences"]),e.registerView("gxb.controllers.profiles.downloadCtrl","me_download")}(gxb.controllers),function(e){e.profiles.downloadingCtrl=function(e){e.$scope.editAndCancel="删除",e.$scope.allSelectOrNot="全选",e.$scope.deleteBtn=!1,e.$scope.showDelete=!1,e.$scope.num=0,e.$scope.tab=0,e.$scope["default"]=0;var o=2*Math.PI*9,t=[],s=0,n=0,i=0,c=!0;e.Preferences.putString("page","downloading"),e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.Download.getAllTaskStatus({success:function(t){var s=gxb.utils.jsonUtils.toObject(t);if(s){e.$scope.safeApply(function(){e.$scope.downloadList=s});for(var i=0;i<e.$scope.downloadList.length;i++)e.$scope.downloadList[i].videoSize=(e.$scope.downloadList[i].videoSize/1024/1024).toFixed(1),e.$scope.downloadList[i].downloadProgress>=0&&(e.$scope.downloadList[i].processStart=o*e.$scope.downloadList[i].downloadProgress,e.$scope.downloadList[i].processEnd=o*(1-e.$scope.downloadList[i].downloadProgress)),2==e.$scope.downloadList[i].state&&n++;n==e.$scope.downloadList.length?e.$scope.safeApply(function(){e.$scope.startAndpause="全部开始"}):e.$scope.safeApply(function(){e.$scope.startAndpause="全部暂停"})}}}),e.$scope.goPause=function(){var o=[];if(1==c)if("全部暂停"==e.$scope.startAndpause){e.$scope.startAndpause="全部开始",c=!1,e.Download.pause({success:function(e){var o=gxb.utils.jsonUtils.toObject(e);1==o[0]&&(c=!0)}},o);for(var t=0;t<e.$scope.downloadList.length;t++)4!=e.$scope.downloadList[t].state&&(e.$scope.downloadList[t].state=2,e.$scope.safeApply())}else{e.$scope.startAndpause="全部暂停";for(var t=0;t<e.$scope.downloadList.length;t++)4!=e.$scope.downloadList[t].state&&(e.$scope.downloadList[t].state=0);e.Download.resume(o)}},e.$scope.pause=function(o){var t=[{chapterId:o.chapterId}];e.Download.pause({success:function(e){}},t);for(var n=0;n<e.$scope.downloadList.length;n++)e.$scope.downloadList[n].chapterId==o.chapterId&&(e.$scope.downloadList[n].state=2,e.$scope.safeApply()),2==e.$scope.downloadList[n].state&&s++;s==e.$scope.downloadList.length&&e.$scope.safeApply(function(){e.$scope.startAndpause="全部开始"})},e.$scope.resume=function(o){for(var t=[{chapterId:o.chapterId}],s=0;s<e.$scope.downloadList.length;s++)e.$scope.downloadList[s].chapterId==o.chapterId&&(e.$scope.downloadList[s].state=0,e.$scope.safeApply()),2!=e.$scope.downloadList[s].state&&e.$scope.safeApply(function(){e.$scope.startAndpause="全部暂停"});e.Download.resume(t)},window.changeProgress=function(t){if(t){for(var s=0;s<t.length;s++){for(var n=0;n<e.$scope.downloadList.length;n++)t[s].chapterId==e.$scope.downloadList[n].chapterId&&(e.$scope.downloadList[n].state=t[s].state,e.$scope.downloadList[n].processStart=o*t[s].downloadProgress,e.$scope.downloadList[n].processEnd=o*(1-t[s].downloadProgress),e.$scope.safeApply());2==t[s].state&&i++}i==e.$scope.downloadList.length&&e.$scope.safeApply(function(){e.$scope.startAndpause="全部开始"})}},window.downloadFinishDefault=function(o){0==o.length&&e.$scope.safeApply(function(){e.$scope["default"]=1})},e.$scope.deleteCon=function(){if(e.$scope.showDelete=!e.$scope.showDelete,"删除"==e.$scope.editAndCancel)e.$scope.safeApply(function(){e.$scope.deleteBtn=!0,e.$scope.tab=1,e.$scope.editAndCancel="取消"});else{e.$scope.safeApply(function(){e.$scope.editAndCancel="删除",e.$scope.deleteBtn=!1,e.$scope.tab=0,e.$scope.allSelectOrNot="全选",e.$scope.num=0});for(var o=0;o<e.$scope.downloadList.length;o++)e.$scope.downloadList[o].checked=!1}},e.$scope.noteChecked=function(o){var s={chapterId:o.chapterId};if(o.checked=!o.checked,0==e.$scope.num)e.$scope.num=1,e.$scope.allSelectOrNot="全选",t.push(s);else if(e.$scope.num>0&&e.$scope.num<e.$scope.downloadList.length)if(e.$scope.allSelectOrNot="全选",1==o.checked)e.$scope.num++,t.push(s);else{e.$scope.num--;for(var n=0;n<t.length;n++)t[n].chapterId==o.chapterId&&e.$scope.safeApply(function(){t.splice(n,1)})}else if(e.$scope.num==e.$scope.downloadList.length)if(1==o.checked)e.$scope.num++,t.push(s),e.$scope.allSelectOrNot="取消全选";else{e.$scope.num--,e.$scope.allSelectOrNot="全选";for(var n=0;n<t.length;n++)t[n].chapterId==o.chapterId&&e.$scope.safeApply(function(){t.splice(n,1)})}},e.$scope.selectAll=function(){if("全选"==e.$scope.allSelectOrNot){for(var o=0;o<e.$scope.downloadList.length;o++){e.$scope.downloadList[o].checked=!0;var s={chapterId:e.$scope.downloadList[o].chapterId};t.push(s)}e.$scope.num=e.$scope.downloadList.length,e.$scope.allSelectOrNot="取消全选"}else{for(var o=0;o<e.$scope.downloadList.length;o++)e.$scope.downloadList[o].checked=!1;e.$scope.allSelectOrNot="全选",e.$scope.num=0,t=[]}},e.$scope.deleteAll=function(o){if(0==o)e.$uiComponents.$toast.show("请先选择您要删除的视频");else{e.$ionicPopup.show({template:"确定删除这些任务及文件？",title:"提示",scope:e.$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(o){e.Download.deleteByChapterId({success:function(o){var s=gxb.utils.jsonUtils.toObject(o);if(1==s){for(var n=0;n<t.length;n++)for(var i=0;i<e.$scope.downloadList.length;i++)if(t[n].chapterId==e.$scope.downloadList[i].chapterId){e.$scope.downloadList.splice(i,1);break}e.$scope.$apply(),e.$scope.safeApply(function(){e.$scope.num=0,e.$scope.showDelete=!1,e.$scope.tab=0,e.$scope.editAndCancel="删除",e.$scope.deleteBtn=!1,t=[]}),0==e.$scope.downloadList.length&&e.$scope.safeApply(function(){e.$scope.deleteBtn=!1,e.$scope.showDelete=!1,t=[],e.$scope.editAndCancel="删除"})}else e.$uiComponents.$toast.show("删除失败！")}},t)}}]})}},e.$scope.$on("$stateChangeStart",function(){e.Preferences.putString("page","")})},e.inheritFromCtrl(e.profiles.downloadingCtrl),e.registerDependency("gxb.controllers.profiles.downloadingCtrl",["$ionicPopup","Download","Preferences","networkState"]),e.registerView("gxb.controllers.profiles.downloadingCtrl","me_downloading")}(gxb.controllers),function(e){e.profiles.helpAddCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.searchHelp=function(){e.$state.go("help_search",{reload:!0})}},e.inheritFromCtrl(e.profiles.helpAddCtrl),e.registerDependency("gxb.controllers.profiles.helpAddCtrl",[]),e.registerView("gxb.controllers.profiles.helpAddCtrl","help_add")}(gxb.controllers),function(e){e.profiles.helpAnswerCtrl=function(e){var o=e.$stateParams.bodyId;e.$scope.tenantId=e.$pluginComponents.$tenantId.get(),e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.searchHelp=function(){e.$state.go("help_search",{},{reload:!0})},e.$profilesSrv.getAnswer(o).then(function(o){0==o.status&&(e.$scope.answer=o.data,e.$scope.safeApply())})},e.inheritFromCtrl(e.profiles.helpAnswerCtrl),e.registerDependency("gxb.controllers.profiles.helpAnswerCtrl",["gxb.services.profiles.profilesSrv"]),e.registerView("gxb.controllers.profiles.helpAnswerCtrl","help_answer")}(gxb.controllers),function(e){e.profiles.helpCenterCtrl=function(e){var o=e.$pluginComponents.$tenantId.get(),t=e.$pluginComponents.$accessToken.get();e.$scope.scrollHeight=function(){return"Android"==e.$rootScope.platformType?"93%":"90%"},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.customerService=function(){e.$state.go("help_add",{reload:!0})},e.$scope.searchHelp=function(){e.$state.go("help_search",{reload:!0})},e.$scope.goQuestion=function(o,t){e.$state.go("help_question",{title:o,helpCenterId:t},{reload:!0})},e.$scope.showItem=0,e.$scope.hideItem=function(o){0==e.$scope.showItem?(e.$scope.showItem=o,setTimeout(function(){var o=document.getElementsByClassName("help_item")[0],t=o.offsetHeight;e.$ionicScrollDelegate.$getByHandle("helpScroll").scrollBottom(t)},10)):0!=o&&o!=e.$scope.showItem?(e.$scope.showItem=o,setTimeout(function(){var o=document.getElementsByClassName("help_item")[0],t=o.offsetHeight;e.$ionicScrollDelegate.$getByHandle("helpScroll").scrollBottom(t)},10)):(e.$scope.showItem=0,e.$ionicScrollDelegate.$getByHandle("helpScroll").resize())},t&&o?e.$profilesSrv.helpCenterList(o).then(function(o){if(0==o.status&&o.data.length>0){e.$scope.navlists=o.data;for(var t=0;t<o.data.length;t++)e.$scope.navlists[t].num=t+1;e.$scope.safeApply()}else e.$profilesSrv.helpCenterList(304).then(function(o){if(0==o.status){e.$scope.navlists=o.data;for(var t=0;t<o.data.length;t++)e.$scope.navlists[t].num=t+1;e.$scope.safeApply()}})}):e.$profilesSrv.helpCenterList(304).then(function(o){if(0==o.status){e.$scope.navlists=o.data;for(var t=0;t<o.data.length;t++)e.$scope.navlists[t].num=t+1;e.$scope.safeApply()}})},e.inheritFromCtrl(e.profiles.helpCenterCtrl),e.registerDependency("gxb.controllers.profiles.helpCenterCtrl",["Comment","gxb.services.profiles.profilesSrv","$ionicScrollDelegate"]),e.registerView("gxb.controllers.profiles.helpCenterCtrl","helpCenter")}(gxb.controllers),function(e){e.profiles.helpQuestionCtrl=function(e){e.$scope.navTitle=e.$stateParams.title;var o=!0,t=e.$stateParams.helpCenterId,s=e.$pluginComponents.$tenantId.get()||304;e.$scope.showMoreBtn=0,e.$scope.questionList=[];var n=e.$ionicScrollDelegate.$getByHandle("mainScroll");e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.searchHelp=function(){e.$state.go("help_search",{reload:!0})},e.$scope.goAnswer=function(o){e.$state.go("help_answer",{bodyId:o},{reload:!0})},e.$profilesSrv.getQuestions(1,s,t).then(function(o){if(0==o.status){e.$scope.totalPage=o.data.paging.totalPage;for(var t in o.data.dataList)e.$scope.curPage=1,e.$scope.totalPage>1?e.$scope.showMoreBtn=1:1==e.$scope.totalPage&&(e.$scope.showMoreBtn=0),e.$scope.questionList[t]=o.data.dataList[t];e.$scope.safeApply()}},function(){e.$scope.networkStates="none",e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}),e.$scope.loadMore=function(){0!=o&&(e.$scope.curPage++,e.$profilesSrv.getQuestions(e.$scope.curPage,s,t).then(function(t){if(0==t.status){e.$scope.totalPage=t.data.paging.totalPage;for(var s in t.data.dataList)e.$scope.questionList.push(t.data.dataList[s]),e.$scope.totalPage==e.$scope.curPage&&(e.$scope.showMoreBtn=0);n.resize(),e.$scope.safeApply(function(){o=!1})}}))},e.$scope.scrollHandle=function(){var t=n.getScrollView(),s=t.__maxScrollTop,i=n.getScrollPosition().top;i+45>=s&&e.$scope.curPage<e.$scope.totalPage&&(e.$scope.loadMore(),o=!0)},e.$scope.reloadPage=function(){e.$uiComponents.$toast.show("正在请求"),e.$scope.networkStates="",gxb.controllers.profiles.helpQuestionCtrl(e)}},e.inheritFromCtrl(e.profiles.helpQuestionCtrl),e.registerDependency("gxb.controllers.profiles.helpQuestionCtrl",["gxb.services.profiles.profilesSrv","$ionicScrollDelegate"]),e.registerView("gxb.controllers.profiles.helpQuestionCtrl","help_question")}(gxb.controllers),function(e){e.profiles.helpSearchCtrl=function(e){var o=e.$pluginComponents.$tenantId.get();e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.hideNoCourse=function(){e.$scope.tab=0},e.$scope.search={searchName:""},document.onkeydown=function(o){var t=o||window.event;13==t.keyCode&&e.$scope.goSearch(e.$scope.search.searchName)};var t=e.$pluginComponents.$questionHistory.get();t?e.$scope.searchList=t.split(","):e.$scope.searchList=[];var s=e.$scope.searchList;e.$scope.tab=0,e.$scope.goSearch=function(t){e.$scope.search.searchName=t,e.$uiComponents.$loadding.show();var n=t;if(!t)return e.$scope.tab=0,e.$uiComponents.$loadding.hide(),void e.$uiComponents.$toast.show("请输入关键字");for(var i=0;i<s.length;i++)t==s[i]&&s.splice(i,1);s.splice(0,0,t),e.$pluginComponents.$questionHistory.set(s),e.$profilesSrv.loadList(o,n,1,2).then(function(o){e.$uiComponents.$loadding.hide(),null==o.data.dataList?e.$scope.tab=1:o.data.dataList.length>0&&(e.$scope.tab=2,e.$scope.questionList=o.data.dataList),e.$scope.safeApply()},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},e.$scope.emptyMessage=function(){e.$scope.searchList=[],s=[],e.$pluginComponents.$questionHistory.set(s),e.$scope.tab=3},e.$scope.goAnswer=function(o,t){e.$state.go("help_answer",{title:o,bodyId:t},{reload:!0})}},e.inheritFromCtrl(e.profiles.helpSearchCtrl),e.registerDependency("gxb.controllers.profiles.helpSearchCtrl",["gxb.services.profiles.profilesSrv","gxb.models.courses.cardModel"]),e.registerView("gxb.controllers.profiles.helpSearchCtrl","help_search")}(gxb.controllers),function(e){e.profiles.messageCtrl=function(e){var o=!0,t=e.$ionicScrollDelegate.$getByHandle("mainScroll"),s=function(){t.resize()},n=e.$pluginComponents.$accessToken.get();e.$scope.message={},e.$scope.curPage=1,e.$scope.tab=0,e.$scope.isRead=!1,e.$profilesSrv.getMessage(1,e.$pluginComponents.$accessToken.get()).then(function(o){if(0==o.status)if(null==o.data.dataList)e.$scope.tab=1,e.$scope.safeApply();else{e.$scope.totalPage=parseInt(o.data.paging.totalPage),e.$scope.totalPage>1&&(e.$scope.showMoreBtn=1);for(var t=0;t<o.data.dataList.length;t++)o.data.dataList[t].createdAt=gxb.utils.dateUtils.time(o.data.dataList[t].createdAt);e.$scope.message=o.data.dataList,e.$scope.tab=0,e.$scope.safeApply()}else 400==o.status}),e.$scope.loadMoreMessage=function(){0!=o&&(e.$scope.curPage++,e.$scope.curPage<=e.$scope.totalPage&&(e.$scope.curPage==e.$scope.totalPage?e.$scope.showMoreBtn=0:e.$scope.showMoreBtn=1,e.$profilesSrv.getMessage(e.$scope.curPage,e.$pluginComponents.$accessToken.get()).then(function(t){if("0"==t.status){for(var n in t.data.dataList)t.data.dataList[n].createdAt=gxb.utils.dateUtils.time(t.data.dataList[n].createdAt),e.$scope.message.push(t.data.dataList[n]);e.$scope.safeApply(),s(),o=!1}})))},e.$scope.scrollHandle=function(){var s=t.getScrollView(),n=s.__maxScrollTop,i=t.getScrollPosition().top;i+45>=n&&e.$scope.curPage<e.$scope.totalPage&&(e.$scope.loadMoreMessage(),o=!0)},e.$scope.link=function(o){e.$profilesSrv.readMessage(o.userMessageId,n).then(function(e){}),e.$scope.isRead=!0,e.$state.go("announcement_detail",{classId:o.classId,messageId:o.messageId,messageType:o.messageType,jump:0},{reload:!0})},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.profiles.messageCtrl),e.registerDependency("gxb.controllers.profiles.messageCtrl",["gxb.services.profiles.profilesSrv","$ionicScrollDelegate"]),e.registerView("gxb.controllers.profiles.messageCtrl","me_message")}(gxb.controllers),function(e){e.profiles.modifyNextCtrl=function(e){e.$scope.$modifyModel=new e.$modifyPhoneModel,e.$scope.$modifyModel.mobile=e.$stateParams.mobile,e.$scope.$modifyModel.encrypted_password=e.$pluginComponents.$objectCache.getObject("userObject").password,e.$scope.countdown=function(){e.$scope.paracont="获取验证码",e.$scope.paraclass="but_null",e.$scope.paraevent=!0,e.$scope.second=60,e.$scope.timePromise=void 0,e.$scope.timePromise=e.$interval(function(){e.$scope.second<=0?(e.$interval.cancel(e.$scope.timePromise),e.$scope.timePromise=void 0,e.$scope.second=60,e.$scope.paracont="没有收到验证码?",e.$scope.paraclass="but_null",e.$scope.paraevent=!0):(e.$scope.paracont=e.$sce.trustAsHtml(e.$scope.second+"秒后可重新获取验证码"),e.$scope.paraclass="not but_null",e.$scope.second--)},1e3,100)},e.$scope.countdown(),e.$scope.goAgainGetCode=function(){return e.$loginSrv.verifyMobile(e.$scope.$modifyModel.mobile)?(e.$scope.countdown(),e.$uiComponents.$loadding.show(),void e.$profilesSrv.getModifyPhone(e.$scope.$modifyModel.mobile).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?e.$uiComponents.$toast.show("发送验证码成功!"):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})):(e.$uiComponents.$toast.show("请输入正确的手机格式!"),!1)},e.$scope.goToPersonal=function(){e.$loginSrv.isNoEmpty(this.$modifyModel)&&(e.$uiComponents.$loadding.show(),e.$profilesSrv.getPersonal(this.$modifyModel,e.$pluginComponents.$accessToken.get()).then(function(o){if(e.$uiComponents.$loadding.hide(),"0"==o.status){e.$uiComponents.$toast.show("手机号更换成功");var t=e.$pluginComponents.$objectCache.getObject("userObject");t.mobile=e.$scope.$modifyModel.mobile,e.$pluginComponents.$objectCache.setObject("userObject",t),e.$state.go("settings_personal",{},{reload:!0})}else 400==o.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}))},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.profiles.modifyNextCtrl),e.registerDependency("gxb.controllers.profiles.modifyNextCtrl",["gxb.services.profiles.profilesSrv","gxb.services.users.loginSrv","gxb.models.profiles.modifyPhoneModel","$interval","$sce"]),e.registerView("gxb.controllers.profiles.modifyNextCtrl","modify_next")}(gxb.controllers),function(e){e.profiles.modifyPasswordCtrl=function(e){var o=e.$rootScope.oldPassword;e.$scope.$modifyPasswordModel=new e.$modifyPasswordModel,e.$scope.$modifyPasswordModel.password=o,e.$pluginComponents.$objectCache.getObject("userObject"),e.$scope.confirm=function(){if(e.$scope.$modifyPasswordModel.newPassword==e.$scope.$modifyPasswordModel.confirmPassword){if(!e.$loginSrv.verifyPassword(e.$scope.$modifyPasswordModel.newPassword))return e.$uiComponents.$toast.show("请输入6-16位数字、字母或符号的组合\r\n(至少两种类型字符组合)"),!1;e.$profilesSrv.modifyPassword(e.$scope.$modifyPasswordModel,e.$pluginComponents.$accessToken.get()).then(function(o){if("0"==o.status){e.$rootScope.oldPassword=null,e.$uiComponents.$toast.show("密码修改成功!");var t=e.$pluginComponents.$objectCache.getObject("userObject");t.password=e.$scope.$modifyPasswordModel.newPassword,e.$pluginComponents.$objectCache.setObject("userObject",t),e.$state.go("settings_personal",{},{reload:!0})}else e.$uiComponents.$toast.show(o.message)})}else e.$uiComponents.$toast.show("两次密码不一样")},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.profiles.modifyPasswordCtrl),e.registerDependency("gxb.controllers.profiles.modifyPasswordCtrl",["gxb.services.profiles.profilesSrv","gxb.services.users.loginSrv","gxb.models.profiles.modifyPasswordModel"]),e.registerView("gxb.controllers.profiles.modifyPasswordCtrl","me_modifyPassword")}(gxb.controllers),function(e){e.profiles.modifyPhoneCtrl=function(e){e.$scope.$modifyModel=new e.$modifyPhoneModel,e.$scope.getobtain=function(){e.$loginSrv.isNoEmptyValue(this.$modifyModel.mobile)&&(e.$uiComponents.$loadding.show(),e.$profilesSrv.getModifyPhone(e.$scope.$modifyModel.mobile).then(function(o){e.$uiComponents.$loadding.hide(),"0"==o.status?(e.$pluginComponents.$objectCache.set("mobile",e.$scope.$modifyModel.mobile),e.$state.go("settings_personal_modifyNext",{mobile:e.$scope.$modifyModel.mobile},{reload:!0})):e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}))},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.profiles.modifyPhoneCtrl),e.registerDependency("gxb.controllers.profiles.modifyPhoneCtrl",["gxb.services.profiles.profilesSrv","gxb.services.users.loginSrv","gxb.models.profiles.modifyPhoneModel"]),e.registerView("gxb.controllers.profiles.modifyPhoneCtrl","modify_phone")}(gxb.controllers),function(e){e.profiles.modifyUserNameCtrl=function(e){e.$scope.userInfo={userName:""};var o=e.$pluginComponents.$accessToken.get(),t=e.$pluginComponents.$objectCache.getObject("userObject");e.$pluginComponents.$objectCache.getObject("userObject")&&(e.$scope.userInfo.userName=t.name),e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()};var s=function(s){e.$profilesSrv.modifyUserInfo(s,o).then(function(o){"0"==o.status&&(e.$pluginComponents.$objectCache.setObject("userObject",t),"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack())})};e.$scope.saveName=function(){t.name=e.$scope.userInfo.userName;var o={name:e.$scope.userInfo.userName,gender:t.gender};e.$scope.userInfo.userName&&s(o)}},e.inheritFromCtrl(e.profiles.modifyUserNameCtrl),e.registerDependency("gxb.controllers.profiles.modifyUserNameCtrl",["$ionicPopup","gxb.services.profiles.profilesSrv"]),e.registerView("gxb.controllers.profiles.modifyUserNameCtrl","modify_userName")}(gxb.controllers),function(e){e.profiles.personalCtrl=function(e){e.$scope.authens={};var o=e.$pluginComponents.$accessToken.get();e.$scope.personalInfo=e.$pluginComponents.$objectCache.getObject("userObject"),e.$profilesSrv.getAuthentication(e.$pluginComponents.$accessToken.get()).then(function(o){"0"==o.status&&(e.$scope.authens=o.data,e.$scope.safeApply())}),e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.modifyName=function(){if(0!=e.$scope.authens.length){e.$ionicPopup.alert({title:"提示",template:'<p style="text-align:center">已认证学生不能修改用户名</p>',buttons:[{text:"<b>我知道了</b>",type:"button-positive"}]});return!1}e.$state.go("modify_name",{},{reload:!0})};var t=function(t){e.$profilesSrv.modifyUserInfo(t,o).then(function(e){"0"==e.status})};window.getPhotoUrl=function(o){e.$scope.personalInfo.avatar=o.avatar,e.$pluginComponents.$objectCache.setObject("userObject",e.$scope.personalInfo),e.$scope.safeApply()};var s=[{text:"男",value:"male"},{text:"女",value:"female"}];e.$scope.modifySex=function(){e.$ionicActionSheet.show({buttons:s,destructiveText:"",titleText:"",cancelText:"",buttonClicked:function(o){e.$scope.personalInfo.gender=s[o].value;var n={name:e.$scope.personalInfo.name,gender:s[o].value};return t(n),e.$pluginComponents.$objectCache.setObject("userObject",e.$scope.personalInfo),!0}})},e.$scope.isSchool=function(){return 1==e.$scope.authens.length?(e.$scope.prompt=!1,"<p>"+e.$scope.authens[0].schoolName+"</p>"):e.$scope.authens.length>1?(e.$scope.prompt=!1,"<p>"+e.$scope.authens[0].schoolName+"等<i>"+e.$scope.authens.length+"</i>所学校</p>"):0==e.$scope.authens.length?(e.$scope.prompt=!0,"<span class='add'>添加认证</span>"):void 0},e.$scope.addValidate=function(){0==e.$scope.authens.length?e.$state.go("settings_personal_addValidate",{type:0},{reload:!0}):(1==e.$scope.authens.length||e.$scope.authens.length>1)&&e.$state.go("settings_authentication",{},{reload:!0})},e.$scope.modifyPhone=function(){if(e.$scope.personalInfo.mobile){e.$scope.data={};e.$ionicPopup.show({template:'<input type="password" ng-model="data.phone"><span ng-show="data.phone" class="ion-close-circled clear_btn" ng-click="clearInput();"></span>',title:"请先输入您的账户密码",scope:e.$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(t){var s={encrypted_password:e.$scope.data.phone};e.$profilesSrv.getValidatePassword(s,o).then(function(o){if(0==o.status)e.$state.go("settings_personal_modifyPhone",{},{reload:!0});else{e.$ionicPopup.alert({title:"密码错误，请重新输入",buttons:[{text:"<b>知道了</b>",type:"button-positive",onTap:function(o){e.$scope.modifyPassword()}}]})}})}}]});e.$scope.clearInput=function(){e.$scope.data.phone=""}}else e.$state.go("user_bind_mobile",{},{reload:!0})},e.$scope.uploadAvatar=function(){e.TakePhoto.set(o)},e.$scope.modifyPassword=function(){e.$scope.data={};e.$ionicPopup.show({template:'<input type="password" ng-model="data.modify"><span ng-show="data.modify" class="ion-close-circled clear_btn" ng-click="clearInput();"></span>',title:"请先输入您的账户密码",scope:e.$scope,buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(t){var s={encrypted_password:e.$scope.data.modify};e.$profilesSrv.getValidatePassword(s,o).then(function(o){if(0==o.status)e.$rootScope.oldPassword=e.$scope.data.modify,e.$state.go("settings_personal_modifyPassword",{},{reload:!0});else{e.$ionicPopup.alert({title:"密码错误，请重新输入",buttons:[{text:"<b>知道了</b>",type:"button-positive",onTap:function(o){e.$scope.modifyPassword()}}]})}})}}]});e.$scope.clearInput=function(){e.$scope.data.modify=""}}},e.inheritFromCtrl(e.profiles.personalCtrl),e.registerDependency("gxb.controllers.profiles.personalCtrl",["$ionicPopup","$timeout","gxb.services.profiles.profilesSrv","$ionicActionSheet","TakePhoto"]),e.registerView("gxb.controllers.profiles.personalCtrl","me_personal")}(gxb.controllers),function(e){e.profiles.settingAboutCtrl=function(e){e.$scope.editionStyle="edition","Android"==e.$rootScope.platformType?e.$scope.editionStyle="edition":e.$scope.editionStyle="editions",e.$scope.tenantCertType=e.$pluginComponents.$tenantCertType.get(),e.$scope.signOut=function(){var o=e.$ionicPopup.confirm({title:"退出登录将不能查看本学校课程或进行学习。确认退出？",cancelText:"取消",cancelType:"button-default",okText:"确定",okType:"button-positive"});o.then(function(o){if(o){var t=e.$pluginComponents.$objectCache.getObject("userObject");if(t.id){var s={uid:t.id,tid:t.tenantId};window.plugins&&window.plugins.OnlinePlugin&&window.plugins.OnlinePlugin.onlineStop(s)}e.$pluginComponents.$objectCache.setObject("userObject",{}),e.$pluginComponents.$accessToken.set(""),e.Preferences.putString("uid",""),e.$rootScope.unReadMsg=0,e.$rootScope.$emit("$login"),e.$state.go("home.course",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})}})},e.$scope.ahoutOur=function(){e.$state.go("settings_about_aboutOur")},e.$scope.onComment=function(){e.Comment.comment()},document.addEventListener("deviceready",function(){e.Preferences.getString("isAllow",{sucess:function(o){"true"==o?e.$scope.isAllowed=!0:e.$scope.isAllowed=!1}}),e.$scope.allowed=function(){1==e.$scope.isAllowed?(e.$scope.isAllowed=!1,e.Preferences.putString("isAllow","false")):(e.$scope.isAllowed=!0,e.Preferences.putString("isAllow","true"))}}),e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}},e.inheritFromCtrl(e.profiles.settingAboutCtrl),e.registerDependency("gxb.controllers.profiles.settingAboutCtrl",["$ionicPopup","Preferences","Comment"]),e.registerView("gxb.controllers.profiles.settingAboutCtrl","setting_about")}(gxb.controllers),function(e){e.learning.announcementCtrl=function(e){var o=e.$stateParams.messageId,t=e.$stateParams.messageType,s=e.$stateParams.classId,n=e.$stateParams.jump,i=e.$pluginComponents.$accessToken.get();e.$scope.type=e.$stateParams.type,e.$scope.messageType=t,e.$scope.announceItem=[],e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},1==n&&e.$profilesSrv.pushReadMessage(t,o,i).then(function(){}),"ClassAnnouncement"==t?e.$profilesSrv.getAnnMess(s,o,i).then(function(o){"0"==o.status?(e.$scope.announceItem=o.data,e.$scope.announceItem.createdAt=gxb.utils.dateUtils.time(o.data.createdAt),e.$scope.safeApply()):"1"==o.status&&(e.$uiComponents.$toast.show(o.message),e.$uiComponents.$history.goBack())}):"Supervision"==t?e.$profilesSrv.getTeachingMessage(o,i).then(function(o){"0"==o.status?(e.$scope.announceItem=o.data,e.$scope.announceItem.createdAt=gxb.utils.dateUtils.time(o.data.createdAt),e.$scope.safeApply()):"1"==o.status&&(e.$uiComponents.$toast.show(o.message),e.$uiComponents.$history.goBack())}):"TenantAnnouncement"==t?e.$profilesSrv.getTenantMessage(o,i).then(function(o){"0"==o.status?(e.$scope.announceItem=o.data,e.$scope.announceItem.createdAt=gxb.utils.dateUtils.time(o.data.createdAt),e.$scope.safeApply()):"1"==o.status&&(e.$uiComponents.$toast.show(o.message),e.$uiComponents.$history.goBack())}):e.$profilesSrv.getOtherMess(o,i).then(function(o){"0"==o.status?(e.$scope.announceItem=o.data,e.$scope.announceItem.createdAt=gxb.utils.dateUtils.time(o.data.createdAt),e.$scope.safeApply()):"1"==o.status&&(e.$uiComponents.$toast.show(o.message),e.$uiComponents.$history.goBack())}),e.$scope.goCourse=function(){e.$state.go("courses_detail",{id:s},{reload:!0})}},e.inheritFromCtrl(e.learning.announcementCtrl),e.registerDependency("gxb.controllers.learning.announcementCtrl",["gxb.services.profiles.profilesSrv"]),e.registerView("gxb.controllers.learning.announcementCtrl","announcement_detail")}(gxb.controllers),function(e){e.learning.answerCardCtrl=function(e){e.$scope.navBarStyle="back_left","Android"==e.$rootScope.platformType?e.$scope.navBarStyle="back_left":e.$scope.navBarStyle="back_leftes",e.$scope.goTome=function(){e.$state.go("course_quiz_topic_analysis",{id:e.$stateParams.id,quizId:e.$stateParams.quizId,submissionId:e.$stateParams.submissionId},{reload:!0})},e.$scope.score=e.$stateParams.score,"true"==e.$pluginComponents.$analysis.get()?e.$scope.checkstate=!0:e.$scope.checkstate=!1,e.$scope.submission=e.$pluginComponents.$objectCache.getObject("submission");var o=0;for(var t in e.$scope.submission)e.$scope.submission[t].correct||o++;e.$scope.wrongCount=o,e.$scope.goAnalysis=function(o){e.$pluginComponents.$currentIndex.set(o),e.$pluginComponents.$analysis.set(e.$scope.checkstate),e.$rootScope.$emit("$changeIndex"),e.$state.go("course_quiz_topic_analysis",{id:e.$stateParams.id,quizId:e.$stateParams.quizId,submissionId:e.$stateParams.submissionId},{reload:!0})},e.$scope.doCheck=function(){e.$scope.checkstate=!e.$scope.checkstate}},e.inheritFromCtrl(e.learning.answerCardCtrl),e.registerDependency("gxb.controllers.learning.answerCardCtrl",[]),e.registerView("gxb.controllers.learning.answerCardCtrl","answer_card")}(gxb.controllers),function(e){e.learning.assignmentCtrl=function(e){var o=e.$stateParams.id,t=e.$stateParams.assignmentId,s=e.$pluginComponents.$accessToken.get(),n=e.$stateParams.chapterId;e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?(e.$uiComponents.$history.goBack(),e.$rootScope.$emit("$changeState")):(e.$rootScope.$ionicGoBack(),e.$rootScope.$emit("$changeState"))},e.$learnSrv.getChapter(o,n,s).then(function(o){e.$scope.assignment=o.chapter.assignment;var t=e.$scope.assignment;e.$scope.isBegin=t.unlockDays>0?1:0,e.$scope.willBegin=0==t.unlockDays?1:0,e.$scope.isSubmit=t.unlockDays<0&&t.dueDays>0?1:0,e.$scope.willSubmit=t.unlockDays<0&&0==t.dueDays?1:0,e.$scope.isCorrect=t.dueDays<0&&t.publishedEndDays>0?1:0,e.$scope.isPublish=t.publishedEndDays<0?1:0,e.$scope.willCorrect=0==t.publishedEndDays?1:0,e.$scope.safeApply()}),e.$learnSrv.getAssignmentDetail(o,t,s).then(function(o){e.$scope.submission=o.submission,e.$scope.safeApply()}),e.$scope.goAssignmentDetail=function(s){4==s?e.$uiComponents.$toast.show("未提交作业"):e.$state.go("assignment_detail",{id:o,assignmentId:t,type:s},{reload:!0})}},e.inheritFromCtrl(e.learning.assignmentCtrl),e.registerDependency("gxb.controllers.learning.assignmentCtrl",["gxb.services.learning.learnSrv","$sce","gxb.models.learning.pageModel"]),e.registerView("gxb.controllers.learning.assignmentCtrl","assignment")}(gxb.controllers),function(e){e.learning.assignmentDetailCtrl=function(e){function o(e){return e.replace(/<[^>]+>/g,"")}var t=e.$stateParams.id,s=e.$stateParams.assignmentId,n=e.$pluginComponents.$accessToken.get();e.$scope.type=e.$stateParams.type,e.$scope.body="",e.$scope.assetList=[],e.$scope.isChecked=0,e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?(e.$uiComponents.$history.goBack(),e.$rootScope.$emit("$changeState")):(e.$rootScope.$ionicGoBack(),e.$rootScope.$emit("$changeState"))};var i=function(){e.$ionicScrollDelegate.$getByHandle("mainScroll").resize()};e.$scope.formatSize=function(e){var o="";o=e<102.4?e.toFixed(2)+"B":e<104857.6?(e/1024).toFixed(2)+"KB":e<107374182.4?(e/1048576).toFixed(2)+"MB":(e/1073741824).toFixed(2)+"GB";
var t=o+"",s=t.indexOf("."),n=t.substr(s+1,2);return"00"==n?t.substring(0,s)+t.substr(s+3,2):t},e.$scope.changeState1=function(){0==e.$scope.isChecked?e.$scope.isChecked=1:e.$scope.isChecked=0},e.$learnSrv.getAssignmentDetail(t,s,n).then(function(t){e.$scope.assignment=t.assignment,e.$scope.submission=t.submission;for(var s=[],n=0;n<t.submission.assetList.length;n++)s.push(t.submission.assetList[n]);e.$scope.assetList=s,e.$scope.submission&&e.$scope.submission.submissionId&&(e.$scope.body=o(e.$scope.submission.body)),e.$scope.safeApply()}),e.$scope.uploadData={fileElementID:"slide_file_element",isImage:!0,autoupload:!0,cutImage:!0,size:["70*70","48*48","36*36"],cdnPrefix:gxb.settings.cdn.wangsu.getPaths().assignment_attachment_bucket+"/test",cdnBucket:gxb.settings.cdn.wangsu.getBuckets().defaultBucket,onQueued:function(e){$(".uploadImg").show()},onSuccess:function(o){var t={size:o.file.size,type:o.file.type,title:o.file.name,url:gxb.settings.cdn.wangsu.getDomains().defaultBucketDomain+o.relativeUrl};$(".uploadImg").hide(),e.$scope.assetList.push(t),e.$scope.imageUrl=o.absoluteUrl,e.$scope.realImageUrl=o.relativeUrl,e.$scope.loading=!1,i(),e.$scope.safeApply()}},e.$scope.delImg=function(o){var t=e.$ionicPopup.confirm({title:"确定要删除文件吗？",cancelText:"取消",okText:"确定"});t.then(function(t){t&&(e.$scope.assetList.splice(o,1),i(),e.$scope.safeApply())})},e.$scope.openImage=function(o){var t=o,s=t;if("Android"==e.$rootScope.platformType&&(t.indexOf(".pdf")>0||t.indexOf(".ppt")>0||t.indexOf(".pptx")>0))s=t.indexOf("doc.gaoxiaobang.com")>0?t:"https://doc.gaoxiaobang.com/view/url?url="+t,e.PassValue.setter(s),e.$state.go("preview_doc");else{var n=/\.pdf|\.txt|\.xls|\.xlsx|\.ppt|\.pptx|\.doc|\.docx/i;if(n.test(t))s=t.indexOf("doc.gaoxiaobang.com")>0?t:"https://doc.gaoxiaobang.com/view/url?url="+t,window.open(s,"_blank");else{var i=/\.jpg|\.png|\.gif|\.bmp|\.jpeg/i;i.test(t)?window.open(t,"_blank"):e.$uiComponents.$toast.show("该文件类型暂不支持预览")}}},e.$scope.showConfirm=function(){for(var o=e.$ionicPopup.confirm({title:"提示",template:'<div style="margin:0 auto;text-align:center">二次提交将覆盖以前的作业，<br />是否提交?</div>',cancelText:"取消",okText:"确定"}),i=e.$scope.submission,c=JSON.stringify(i),a=[],r=0;r<e.$scope.assetList.length;r++)a.push(new e.$assetModel(e.$scope.assetList[r]));var p=JSON.stringify(a),l=document.querySelector(".answer textarea").value,$={assetList:p,body:l,submission:c};o.then(function(o){o?e.$learnSrv.preSubmitAssignment(t,s,$,n).then(function(o){e.$ionicHistory.removeBackView(),e.$scope.goTome()}):console.log("You are not sure")})},e.$scope.showConfirm1=function(){for(var o=e.$ionicPopup.confirm({title:"提示",template:'<div style="margin:0 auto;text-align:center">是否提交?</div>',cancelText:"取消",okText:"确定"}),i=[],c=0;c<e.$scope.assetList.length;c++)i.push(new e.$assetModel(e.$scope.assetList[c]));var a=JSON.stringify(i),r=document.querySelector(".answer textarea").value,p={assetList:a,body:r};o.then(function(o){o?e.$learnSrv.submitAssignment(t,s,p,n).then(function(o){e.$ionicHistory.removeBackView(),e.$scope.goTome()}):console.log("You are not sure")})}},e.inheritFromCtrl(e.learning.assignmentDetailCtrl),e.registerDependency("gxb.controllers.learning.assignmentDetailCtrl",["gxb.services.learning.learnSrv","$ionicHistory","$sce","gxb.models.learning.pageModel","gxb.models.learning.assetModel","PassValue","$ionicPopup","$ionicScrollDelegate"]),e.registerView("gxb.controllers.learning.assignmentDetailCtrl","assignment_detail")}(gxb.controllers),function(e){e.learning.coursePageCtrl=function(e){var o=e.$stateParams.id,t=e.$stateParams.chapterId,s=e.$pluginComponents.$accessToken.get();e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?(e.$uiComponents.$history.goBack(),e.$rootScope.$emit("$changeState")):(e.$rootScope.$ionicGoBack(),e.$rootScope.$emit("$changeState"))},e.$scope.page={},e.$learnSrv.courseWare(o,t,s).then(function(o){0==o.status&&(e.$scope.safeApply(function(){e.$scope.page=new e.$pageModel(o.data.page),e.$scope.page.body=e.$sce.trustAsHtml(e.$scope.page.body)}),$("a[hrefs]").on("click",function(){var o=$(this).attr("hrefs"),t=o;"Android"==e.$rootScope.platformType&&(o.indexOf(".pdf")>0||o.indexOf(".ppt")>0||o.indexOf(".pptx")>0)?(t=o.indexOf("doc.gaoxiaobang.com")>0?o:"https://doc.gaoxiaobang.com/view/url?url="+o,e.PassValue.setter(t),e.$state.go("preview_doc")):o.indexOf(".pdf")>0||o.indexOf(".txt")>0||o.indexOf(".xls")>0||o.indexOf(".xlsx")>0||o.indexOf(".ppt")>0||o.indexOf(".pptx")>0||o.indexOf(".doc")>0||o.indexOf(".docx")>0?(t=o.indexOf("doc.gaoxiaobang.com")>0?o:"https://doc.gaoxiaobang.com/view/url?url="+o,window.open(t,"_blank")):o.indexOf(".jpg")>0||o.indexOf(".png")>0||o.indexOf(".gif")>0||o.indexOf(".bmp")>0||o.indexOf(".jpeg")>0?window.open(o,"_blank"):e.$uiComponents.$toast.show("该文件类型暂不支持预览")}))},function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),e.$uiComponents.$loadding.hide()})},e.inheritFromCtrl(e.learning.coursePageCtrl),e.registerDependency("gxb.controllers.learning.coursePageCtrl",["gxb.services.learning.learnSrv","$sce","gxb.models.learning.pageModel","PassValue"]),e.registerView("gxb.controllers.learning.coursePageCtrl","course_page")}(gxb.controllers),function(e){e.learning.courseWareCtrl=function(e){var o=e.$stateParams.id,t=e.$stateParams.chapterId,s=e.$pluginComponents.$accessToken.get();e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?(e.$uiComponents.$history.goBack(),e.$rootScope.$emit("$changeState")):(e.$rootScope.$ionicGoBack(),e.$rootScope.$emit("$changeState"))},e.$scope.openText=!1;var n="展开全部",i="收起全部";e.$scope.isOpen=0,e.$scope.isOpen1=0,e.$scope.text=n,e.$scope.text1=n,e.$scope.timer=setTimeout(function(){var o=document.getElementsByClassName("con")[0],t=o.offsetHeight;t>=78&&e.$scope.safeApply(function(){o.style.height="78px",e.$scope.openText=!0})},500),e.$scope.open=function(){0==e.$scope.isOpen?(e.$scope.isOpen=1,e.$scope.text=i):(e.$scope.isOpen=0,e.$scope.text=n),e.$scope.safeApply(function(){e.$ionicScrollDelegate.$getByHandle("scrollLayer").scrollTop()})},e.$scope.open1=function(){if(0==e.$scope.isOpen1){e.$scope.isOpen1=1;var o=document.getElementsByClassName("con")[0];o.style.height="auto",e.$scope.text1=i}else{e.$scope.isOpen1=0;var t=document.getElementsByClassName("con")[0];t.style.height="78px",e.$scope.text1=n}e.$scope.safeApply(function(){e.$ionicScrollDelegate.$getByHandle("scrollLayer").scrollTop()})},e.$learnSrv.courseWare(o,t,s).then(function(o){if(0==o.status){var t=[];if(e.$scope.ware=o.data,o.data.asset.documentList)for(var s=0;s<o.data.asset.documentList.length;s++)t[s]=new e.$resourceModel(o.data.asset.documentList[s]);e.$scope.safeApply(function(){e.$scope.wareList=t})}},function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),e.$uiComponents.$loadding.hide()}),e.$scope.showEnclosure=function(t){var n,i=t.filePath;if("Android"==e.$rootScope.platformType&&(i.indexOf(".pdf")>0||i.indexOf(".ppt")>0||i.indexOf(".pptx")>0))n=i.indexOf("doc.gaoxiaobang.com")>0?i:"https://doc.gaoxiaobang.com/view/url?url="+i,e.PassValue.setter(n),e.$state.go("preview_doc");else if(i.indexOf(".mp4")!=-1){var c={classId:o,className:t.title,promotionalVideo:t.filePath,promotionalVideoSrt:"",access_token:s};e.Play.playWeClass(c)}else i.indexOf(".pdf")>0||i.indexOf(".txt")>0||i.indexOf(".xls")>0||i.indexOf(".xlsx")>0||i.indexOf(".ppt")>0||i.indexOf(".pptx")>0||i.indexOf(".doc")>0||i.indexOf(".docx")>0?(n=i.indexOf("doc.gaoxiaobang.com")>0?i:"https://doc.gaoxiaobang.com/view/url?url="+i,window.open(n,"_blank")):i.indexOf(".jpg")>0||i.indexOf(".png")>0||i.indexOf(".gif")>0||i.indexOf(".bmp")>0||i.indexOf(".jpeg")>0?window.open(i,"_blank"):e.$uiComponents.$toast.show("该文件类型暂不支持预览")}},e.inheritFromCtrl(e.learning.courseWareCtrl),e.registerDependency("gxb.controllers.learning.courseWareCtrl",["Play","$ionicScrollDelegate","gxb.models.courses.resourceModel","gxb.services.learning.learnSrv","PassValue"]),e.registerView("gxb.controllers.learning.courseWareCtrl","course_ware")}(gxb.controllers),function(e){e.learning.detailCtrl=function(e){e.$uiComponents.$loadding.show();var o=e.$stateParams.firstTime,t=!0,s=!0,n=e.$stateParams.id;e.$scope.types=e.$stateParams.types,e.$pluginComponents.$classId.set(n);var i=e.$pluginComponents.$objectCache.getObject("userObject").id,c=2*Math.PI*9,a=e.$pluginComponents.$accessToken.get(),r=(e.$pluginComponents.$objectCache.getObject("userObject").userName,e.$pluginComponents.$objectCache.getObject("userObject").name),p=e.$pluginComponents.$objectCache.getObject("schoolObject").schoolId,l=e.$pluginComponents.$objectCache.getObject("userObject").tenantId||e.$pluginComponents.$tenantId.get();e.$scope.exam=0,e.$scope.tab=1,e.$scope.showActionSheet=!1,e.$scope.numOfDownloading=0,e.$scope.curOpen=0;var u,d=0,g=!0,m=e.$ionicScrollDelegate.$getByHandle("myChapters"),f=e.$ionicScrollDelegate.$getByHandle("myTopicScroll"),h=e.$ionicScrollDelegate.$getByHandle("announceLayer"),b=e.$ionicScrollDelegate.$getByHandle("scoreScroll"),v=function(){f.resize()},C=e.$scope.canBack;1==C&&e.$ionicHistory.removeBackView(),e.$scope.cursorStyle="cursorStyle","IOS"==e.$rootScope.platformType&&(e.$scope.cursorStyle="cursorStyle"),e.Preferences.putString("page","course_detail"),window.localStorage.getItem("batchDownload")?e.$scope.safeApply(function(){e.$scope.batchDownload=0}):(window.localStorage.setItem("batchDownload",1),e.$scope.safeApply(function(){e.$scope.batchDownload=1})),e.$scope.showAnnouncement=function(o){e.$scope.tab=0},e.$scope.showChapters=function(){e.$scope.tab=1},e.$scope.showDiscuss=function(){e.$scope.tab=2},e.$scope.showScoreAnalysis=function(){e.$scope.tab=3};var w=function(o){e.Download.getStatusByClassIdAndUnitId({success:function(e){var t=gxb.utils.jsonUtils.toObject(e);q(o,t)}},[{unitId:o,classId:n}])},y=function(){var o=new Promise(function(o,t){e.$courseSrv.exam(n,a).then(function(t){if("0"==t.status){e.$scope.exam=1;for(var s=[],n=0;n<t.data.length;n++)s[n]=t.data[n],s[n].startAt=gxb.utils.dateUtils.days(t.data[n].start_at),s[n].endAt=gxb.utils.dateUtils.days(t.data[n].end_at),s[n].pubAt=gxb.utils.dateUtils.days(t.data[n].publishAt);e.$scope.safeApply(function(){e.$scope.examList=s}),o()}})});return o},S=function(o){for(var t=[],s=0;s<o.data.length;s++)if(t[s]=new e.$chapterListModel(o.data[s]),t[s].itemList)for(var n=0;n<t[s].itemList.length;n++)if(t[s].itemList[n].chapterList){var i=[];for(z in t[s].itemList[n].chapterList)"Video"==t[s].itemList[n].chapterList[z].contentType&&i.push(t[s].itemList[n].chapterList[z]);t[s].itemList[n].chapterList=i}return t},x=function(){var o=new Promise(function(o,t){var s=window.sessionStorage.getItem("gxbCoursePosition");if(s){var i=gxb.utils.jsonUtils.toObject(s);if(i&&i.classId==n){var c=i.top;1==i.tab?(e.$scope.tab=1,e.$scope.safeApply(),m.scrollTo(0,c)):0==i.tab?(e.$scope.tab=0,e.$scope.safeApply(),h.scrollTo(0,c)):2==i.tab?(e.$scope.tab=2,e.$scope.safeApply(),_(i.curPage,i.forumId,i.forumName).then(function(){f.scrollTo(0,c)})):3==i.tab&&(e.$scope.tab=3,e.$scope.curOpen=i.curOpen,e.$scope.safeApply(),b.scrollTo(0,c))}}o()});return o},I=function(){var o=new Promise(function(o,t){e.$courseSrv.courseIntro(n,a).then(function(t){if(t){var s=t.data,n=[];if(t.data.teachers&&t.data.teachers.length>2){for(var i=0;i<2;i++)n[i]=t.data.teachers[i];s.teachers=n}e.$scope.intro=new e.$introModel(s),e.$scope.hasLive=parseInt(e.$scope.intro.webcastNum)>0?1:0,document.addEventListener("deviceready",function(){window.plugins.ImageCachePlugin.cache(e.$scope.intro.classCover,0,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.intro.cache=t.cache})}),e.$scope.safeApply(),1==e.$scope.hasLive&&A(),console.log(0),o()}})});return o},L=function(o){var t=new Promise(function(t,s){e.$courseSrv.chapters(n,a).then(function(s){if("0"==s.status){for(var i,c=[],a=0;a<s.data.length;a++)i=s.data[a],i.unitIndex=a+1,c[a]=new e.$chapterListModel(i),d+=c[a].numberOfVideo;if(e.$scope.safeApply(function(){e.$scope.units=c}),e.$uiComponents.$loadding.hide(),u=S(s),1==o){for(var r,p,l=[],$=0;$<s.data.length;$++)p=s.data[$],p.classId=n,p.className=e.$scope.intro.name,p.teachMode=e.$scope.intro.teachMode,p.unitIndex=$+1,r=new e.$batchDownloadModel(p),r.unitData.length>0&&l.push(r);e.$scope.unitDownloadList=l,e.$scope.numOfDownloading=0,e.$scope.safeApply();var g={classId:n,className:e.$scope.intro.name,classCover:e.$scope.intro.classSmallCover,classType:e.$scope.intro.type,videoNumber:d,examNum:e.$scope.examList?e.$scope.examList.length:0};if(window.localStorage.getItem("downloadClasses")){for(var m=!1,f=gxb.utils.jsonUtils.toObject(window.localStorage.getItem("downloadClasses")),a=0;a<f.length;a++)f[a].classId==n&&(m=!0);0==m&&(f.push(g),window.localStorage.setItem("downloadClasses",gxb.utils.jsonUtils.toString(f)))}else window.localStorage.setItem("downloadClasses",gxb.utils.jsonUtils.toString([g]))}console.log(1),t()}},function(){e.$uiComponents.$loadding.hide()})});return t},P=function(){var o=new Promise(function(o,t){e.$learnSrv.learnChapter(n,a).then(function(t){if(t.data){e.$scope.learnChapter=t.data;var s=t.data.unitId;e.$scope.safeApply(),o(),document.addEventListener("deviceready",function(){w(s)})}else{var n={unitId:e.$scope.units[0].unitId};e.$scope.safeApply(function(){e.$scope.learnChapter=n}),o(),document.addEventListener("deviceready",function(){w(n.unitId)})}})});return o},A=function(){e.$learnSrv.getLiveVideoList(n,a).then(function(o){e.$scope.liveVideoList=[];var t=[],s=[],n=[],i=[];if(o.dataList){for(var c=0;c<o.dataList.length;c++)t[c]=new e.$liveVideoModel(o.dataList[c]),"living"==t[c].status?s.push(t[c]):"unstart"==t[c].status?n.push(t[c]):i.push(t[c]);e.$scope.liveVideoList=s.concat(n).concat(i),document.addEventListener("deviceready",function(){for(var o in e.$scope.liveVideoList)window.plugins.ImageCachePlugin.cache(e.$scope.liveVideoList[o].cover,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.liveVideoList[t.index].cache=t.cache,e.$scope.safeApply()})})}})},T=function(){var o=new Promise(function(o,t){e.$learnSrv.getAnnouncement(n).then(function(t){var s,n=[];for(s in t.data)n[s]=new e.$announcementModel(t.data[s]);e.$scope.announcement=n,o()})});return o};e.$scope.getChapter=function(e,o){L(0).then(function(){return P()})},e.$scope.isLearn=function(o,t){if($("#"+t).find("i").hasClass("ion-ios-arrow-up")){var s={unitId:""};e.$scope.safeApply(function(){e.$scope.learnChapter=s})}else{var s={unitId:t};e.$scope.safeApply(function(){e.$scope.learnChapter=s}),w(t)}e.$ionicScrollDelegate.$getByHandle("myChapters").scrollTo(0,60*o)},e.$scope.goEXam=function(){e.$uiComponents.$toast.show("移动端暂不支持，请电脑端登录gaoxiaobang.com完成")},e.$scope.hasMore=1;var k=function(o,t){e.$learnSrv.getTopicList(n,a,o,t).then(function(o){var t=[];if(e.$scope.topicList=[],e.$scope.topicCurPage=1,e.$scope.topicTotalPage=o.paging.totalPage,e.$scope.topicTotalPage>1?e.$scope.hasMore=1:e.$scope.hasMore=0,o.dataList){for(var s=0;s<o.dataList.length;s++)t[s]=new e.$topicModel(o.dataList[s]);e.$scope.topicList=t}e.$scope.safeApply()},function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},O=[],j=[],_=function(o,t,s){var i=new Promise(function(i,c){e.$learnSrv.getForums(n,a).then(function(c){for(var r=0;r<c.length;r++)O.push({text:c[r].name,forumId:c[r].forumid}),c[r].name.indexOf("得分讨论")!==-1&&(e.$scope.scoreTopic=c[r].forumid,e.$scope.currentForum={name:"得分讨论",forumId:e.$scope.scoreTopic,curPage:1}),c[r].name.indexOf("得分讨论")==-1&&j.push({text:c[r].name,forumId:c[r].forumid});e.$scope.openForums=function(){e.$ionicActionSheet.show({buttons:O,destructiveText:"",titleText:"",cancelText:"",buttonClicked:function(o){var t=O[o].forumId,s=O[o].text;return k(1,t),e.$scope.currentForum.name=s,e.$scope.currentForum.forumId=t,e.$scope.currentForum.curPage=1,e.$scope.safeApply(),!0}})},e.$scope.changeForums=function(){e.$ionicActionSheet.show({buttons:j,destructiveText:"",titleText:"",cancelText:"",cssClass:"dddd",buttonClicked:function(o){var t=j[o].forumId,s=j[o].text;return e.$scope.newTopicCurrentForum.name=s,e.$scope.newTopicCurrentForum.forumId=t,e.$scope.safeApply(),!0}})},e.$scope.newTopic=function(){if(e.$scope.modal.show(),e.$scope.currentForum.name.indexOf("得分讨论")!=-1){for(var o={name:"",forumId:""},t=0;t<j.length;t++){j[t];j[t].text.indexOf("综合讨论")!=-1&&(o={name:j[t].text,forumId:j[t].forumId})}""!==o.name?e.$scope.newTopicCurrentForum=o:e.$scope.newTopicCurrentForum={name:"请选择",forumId:null}}else e.$scope.newTopicCurrentForum=e.$scope.currentForum;e.$scope.topic.title=null,e.$scope.topic.message=null,setTimeout(function(){document.getElementById("newTopic-send").focus()},20)},e.$scope.currentForum.forumId=t?t:e.$scope.currentForum.forumId,e.$scope.currentForum.name=s?s:e.$scope.currentForum.name,e.$scope.safeApply(),e.$learnSrv.getTopicList(n,a,1,e.$scope.currentForum.forumId).then(function(t){var s=[];if(e.$scope.topicList=[],e.$scope.topicCurPage=1,e.$scope.topicTotalPage=t.paging.totalPage,e.$scope.topicTotalPage>1?e.$scope.hasMore=1:e.$scope.hasMore=0,t.dataList){for(var c=0;c<t.dataList.length;c++)s[c]=new e.$topicModel(t.dataList[c]);e.$scope.topicList=s,e.$scope.safeApply()}if(o&&o>1){for(var r=1,p=2;p<=o;p++)e.$learnSrv.getTopicList(n,a,p,e.$scope.currentForum.forumId).then(function(o){var t=[];if(o.dataList){for(var s=0;s<o.dataList.length;s++)t[s]=new e.$topicModel(o.dataList[s]),e.$scope.topicList.push(t[s]);e.$scope.safeApply(),v()}r++});r==o&&i()}else i()},function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})})});return i};e.$scope.loadMoreTopic=function(){0!=t&&(e.$scope.topicCurPage++,e.$scope.topicCurPage==e.$scope.topicTotalPage?(e.$scope.hasMore=0,e.$scope.safeApply()):(e.$scope.hasMore=1,e.$scope.safeApply()),M(e.$scope.topicCurPage,e.$scope.currentForum.forumId))};var M=function(o,s){e.$learnSrv.getTopicList(n,a,o,s).then(function(o){var s=[];if(o.dataList)for(var n=0;n<o.dataList.length;n++)s[n]=new e.$topicModel(o.dataList[n]),e.$scope.topicList.push(s[n]),e.$scope.safeApply(),v(),t=!1})};e.$scope.scrollHandle=function(){var o=e.$ionicScrollDelegate.$getByHandle("myTopicScroll"),s=o.getScrollView(),n=s.__maxScrollTop,i=o.getScrollPosition().top;i+45>=n&&e.$scope.topicCurPage<e.$scope.topicTotalPage&&(e.$scope.loadMoreTopic(),t=!0)},e.$scope.topic={title:null,message:null},e.$rootScope.$on("$published",function(){k(1,e.$scope.currentForum.forumId)}),e.$rootScope.$on("$commit",function(){k(1,e.$scope.currentForum.forumId)}),e.$ionicModal.fromTemplateUrl("modal.html",{scope:e.$scope,animation:"slide-in-up"}).then(function(o){e.$scope.modal=o}),e.$scope.closeModal=function(){if(null!=e.$scope.topic.message||null!=e.$scope.topic.title){e.$ionicPopup.alert({title:"退出发起讨论？",buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(o){e.$scope.modal.hide()}}]})}else e.$scope.modal.hide()},e.$scope.$on("$destroy",function(){e.$scope.modal.remove()}),e.$scope.$on("$stateChangeStart",function(){e.Preferences.putString("page","")}),e.$scope.submitNewTopic=function(o){var t={title:e.$scope.topic.title,message:e.$scope.topic.message};e.$learnSrv.newTopic(t,n,o,a).then(function(o){"success"==o.state?(e.$scope.$emit("$published"),e.$uiComponents.$toast.show("发帖成功！"),e.$scope.modal.hide()):(e.$uiComponents.$toast.show("发帖失败！"),e.$scope.modal.hide())})},e.$scope.unsubmit=function(){"请选择"==e.$scope.newTopicCurrentForum.name?e.$uiComponents.$toast.show("请选择版块"):null==e.$scope.topic.title?e.$uiComponents.$toast.show("请输入标题"):null==e.$scope.topic.message&&e.$uiComponents.$toast.show("请输入内容")};var B=function(o){var t=o.webcastId,s=o.title,i=o.teacherName,c=o.duration,p=o.introduce;if("living"==o.status){if(null!=o.webcastUrl){var l=o.webcastUrl.split("&"),$=l[0].slice(l[0].indexOf("roomid")+7),u=l[1].slice(l[1].indexOf("userid")+7),d=e.$pluginComponents.$objectCache.getObject("userObject").id,g={roomId:$,userId:u,uID:d,classId:n,viewerName:r,viewerToken:a,webcastId:t,title:s,teacherName:i,duration:c,introduce:p};e.Lives.live(gxb.utils.jsonUtils.toString(g))}}else if("over"==o.status)if(null!=o.playBackUrl){var m=o.playBackUrl.split("&"),f=m[0].slice(m[0].indexOf("roomid")+7),h=m[1].slice(m[1].indexOf("userid")+7),b=m[2].slice(m[2].indexOf("liveid")+7),v={roomId:f,userId:h,classId:n,liveId:b,viewerName:r,viewerToken:a,webcastId:t,title:s,teacherName:i,duration:c,introduce:p};e.Lives.live(gxb.utils.jsonUtils.toString(v))}else{var C=e.$ionicPopup.alert({title:"提示",template:"回放正在准备中，请耐心等待",okText:"知道了"});C.then(function(e){})}};e.$scope.onLive=function(o){"unstart"==o.status?e.$state.go("course_item_liveVideoDetail",{id:n,webcastId:o.webcastId},{reload:!0}):"CELL_2G"==e.networkState.state()||"CELL_3G"==e.networkState.state()||"CELL_4G"==e.networkState.state()?e.Preferences.getString("isAllow",{sucess:function(t){if("true"==t)B(o);else{var s=e.$ionicPopup.confirm({title:"您正在使用2G/3G/4G网络",template:"当前非wifi环境，是否允许使用2G/3G/4G网络播放?",cancelText:"取消",okText:"允许"});s.then(function(t){t&&(e.Preferences.putString("isAllow","true"),B(o))})}}}):"WiFi"==e.networkState.state()?B(o):"NONE"!=e.networkState.state()&&"Unknown"!=e.networkState.state()||e.$uiComponents.$toast.show("已断网，请检查您的网络")},e.$scope.goIntro=function(){e.$state.go("course_item",{id:n})},e.$scope.announceDetail=function(o){var t=h.getScrollPosition().top,s={classId:n,tab:0,top:t};window.sessionStorage.setItem("gxbCoursePosition",gxb.utils.jsonUtils.toString(s)),e.$state.go("announcement_detail",{classId:n,messageId:o,messageType:"ClassAnnouncement",jump:0})},e.$scope.goTopic=function(o,t){var s=f.getScrollPosition().top,i={classId:n,tab:2,top:s,forumId:e.$scope.currentForum.forumId,forumName:e.$scope.currentForum.name,curPage:e.$scope.currentForum.curPage};window.sessionStorage.setItem("gxbCoursePosition",gxb.utils.jsonUtils.toString(i)),e.$state.go("course_item_topic",{id:n,topicId:o,type:t},{reload:!0})};var D=function(o){if("Quiz"==o.contentType)e.$state.go("course_quiz",{id:n,quizId:o.contentId},{reload:!0});else if("Video"==o.contentType){var t=(new Date).getTime();e.Play.play(0,n,o.chapterId,p,l,a,gxb.utils.jsonUtils.toString(u),"",i,o.learnStatus,function(){(new Date).getTime()-t>3e3&&e.$scope.getChapter(n,a)})}else if("Topic"==o.contentType)e.$state.go("course_item_topic",{id:n,topicId:o.contentId,type:1});else if("Courseware"==o.contentType)e.$state.go("course_ware",{id:n,chapterId:o.chapterId},{reload:!0});else if("Page"==o.contentType)e.$learnSrv.courseWare(n,o.chapterId,a).then(function(t){if("Text"==t.data.page.contextType)e.$state.go("course_page",{id:n,chapterId:o.chapterId},{reload:!0});else if("Link"==t.data.page.contextType){var s;s=t.data.page.url.indexOf("https://")!=-1||t.data.page.url.indexOf("http://")!=-1?t.data.page.url:"http://"+t.data.page.url;var i=window.open(s,"_blank","location=yes");i.addEventListener("exit",function(){e.$rootScope.$emit("$changeState")})}});else if("Programming"==o.contentType){if(s){s=!1;var c=encodeURIComponent(o.title);e.$learnSrv.getProgrammingLearnStatus(n,o.chapterId,a).then(function(e){console.log(e)}),e.$learnSrv.getProgrammingType(o.contentId).then(function(t){if(t)if(0==t.programmingSource)if("Android"==e.$rootScope.platformType)window.plugins.MBrowserPlugin.browser("https://programming.gaoxiaobang.com/player.html?codeReplayId="+o.contentId+"&languageid="+t.languageid+"&role=0&userId="+i+"&chapterId="+o.chapterId+"&title="+c+"&type=programming",function(){},function(){});else{var s="https://programming.gaoxiaobang.com/player.html?codeReplayId="+o.contentId+"&languageid="+t.languageid+"&role=0&userId="+i+"&chapterId="+o.chapterId+"&title="+c+"&type=programming";window.open(s,"_blank")}else{var n="https://programming.gaoxiaobang.com/v1.1/player.html?codeReplayId="+o.contentId+"&role=0&chapterId="+o.chapterId+"&userId="+i+"&languageid="+t.languageid+"&title="+c+"&type=programming";window.open(n,"_blank")}})}}else"Assignment"==o.contentType&&"false"==o.assignment.isPeerReview&&"programming"!=o.assignment.subType&&"programmingAutomaticGrading"!=o.assignment.subType?e.$state.go("assignment",{id:n,chapterId:o.chapterId,assignmentId:o.assignment.assignmentId},{reload:!0}):"WebCast"==o.contentType?(e.ClassName.setter(e.$scope.intro.name),e.$state.go("webcast_detail",{id:n,chapterId:o.chapterId,webcastId:o.contentId},{reload:!0})):e.$uiComponents.$toast.show("移动端暂不支持，请电脑端登录gaoxiaobang.com完成")};e.$scope.toast=function(o){e.$uiComponents.$toast.show("本章节于"+o+"解锁,敬请期待")},e.$scope.goChapter=function(o){var t=e.$ionicScrollDelegate.$getByHandle("myChapters").getScrollPosition().top,s={classId:n,tab:1,top:t};window.sessionStorage.setItem("gxbCoursePosition",gxb.utils.jsonUtils.toString(s)),"Browser"==e.$rootScope.platformType?D(o):"CELL_2G"==e.networkState.state()||"CELL_3G"==e.networkState.state()||"CELL_4G"==e.networkState.state()?e.Preferences.getString("isAllow",{sucess:function(t){"true"==t?D(o):o.videoPath?D(o):e.$uiComponents.$toast.show("已设置仅WiFi下载/播放，如有需要请先在“我的-设置”里更改")}}):"NONE"==e.networkState.state()?e.$uiComponents.$toast.show("当前网络环境较差，请稍后重试"):D(o)},e.$rootScope.$on("$changeState",function(){s=!0,e.$scope.getChapter(n,a)}),1==o&&e.$ionicHistory.removeBackView(),e.$scope.goTome=function(){window.sessionStorage.removeItem("gxbCoursePosition"),"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()};var N=function(e){var o=["waiting","downloading","pause","wrong","finished"];return o[e]},q=function(o,t){if(0!=t.length)for(var s=0;s<e.$scope.units.length;s++)if(o==e.$scope.units[s].unitId){for(var n=0;n<e.$scope.units[s].itemList.length;n++)for(var i=0;i<t.length;i++)for(var a=0;a<e.$scope.units[s].itemList[n].chapterList.length;a++)t[i].chapterId==e.$scope.units[s].itemList[n].chapterList[a].chapterId&&(4==t[i].state&&(e.$scope.units[s].itemList[n].chapterList[a].videoPath=t[i].videoPath,e.$scope.safeApply()),e.$scope.units[s].itemList[n].chapterList[a].progress=t[i].downloadProgress,e.$scope.units[s].itemList[n].chapterList[a].state=N(t[i].state),e.$scope.units[s].itemList[n].chapterList[a].processStart=c*t[i].downloadProgress,e.$scope.units[s].itemList[n].chapterList[a].processEnd=c*(1-t[i].downloadProgress),e.$scope.safeApply());break}},V=function(o){if(o.length>0)for(var t=0;t<o.length;t++)for(var s=0;s<e.$scope.units.length;s++)if(o[t].unitId==e.$scope.units[s].unitId)for(var n=0;n<e.$scope.units[s].itemList.length;n++)if(o[t].itemId==e.$scope.units[s].itemList[n].itemId)for(var i=0;i<e.$scope.units[s].itemList[n].chapterList.length;i++)o[t].chapterId==e.$scope.units[s].itemList[n].chapterList[i].chapterId&&(e.$scope.units[s].itemList[n].chapterList[i].state=N(o[t].state),o[t].downloadProgress&&(e.$scope.units[s].itemList[n].chapterList[i].processStart=c*o[t].downloadProgress,e.$scope.units[s].itemList[n].chapterList[i].processEnd=c*(1-o[t].downloadProgress)),e.$scope.safeApply())};window.changeStatus=function(){e.$rootScope.$emit("$changeState")};var U=function(o,t,s){var i={classId:n,className:e.$scope.intro.name,type:"video",token:a,uid:e.$pluginComponents.$objectCache.getObject("userObject").id,chapterId:o.chapterId,chapterName:o.title,chapterIndex:o.chapterIndex,itemId:t.itemId,itemName:t.title,unitId:s.unitId,unitName:s.title,unitIndex:s.unitIndex};e.Download.start({success:function(e){var t=gxb.utils.jsonUtils.toObject(e);0==t.length?o.state="default":o.state=N(t[0].state)}},[i])};e.$scope.download=function(o,t,s){"CELL_2G"==e.networkState.state()||"CELL_3G"==e.networkState.state()||"CELL_4G"==e.networkState.state()?e.Preferences.getString("isAllow",{sucess:function(n){"true"==n?(o.state="searching",U(o,t,s)):e.$uiComponents.$toast.show("已设置仅WiFi下载，如有需要请先在“我的-设置”里更改")}}):(o.state="searching",U(o,t,s))},e.$scope.pause=function(o){e.$uiComponents.$toast.show("已暂停下载"),e.Download.pause({success:function(e){}},[{chapterId:o.chapterId}]),o.state="pause"},e.$scope.resume=function(o){o.state="waiting",e.Download.resume([{chapterId:o.chapterId}])},e.$scope.bacthDownload=function(){e.Download.getTaskNumByClassId({success:function(o){if(o){for(var t=gxb.utils.jsonUtils.toObject(o),s=0,n=0;n<t.unitModel.length;n++)for(var i=0;i<e.$scope.unitDownloadList.length;i++)t.unitModel[n].unitId==e.$scope.unitDownloadList[i].unitId&&(e.$scope.unitDownloadList[i].allTasksNum=t.unitModel[n].allTasksNum,e.$scope.unitDownloadList[i].finishTasksNum=t.unitModel[n].finishTasksNum,e.$scope.unitDownloadList[i].allNum=e.$scope.unitDownloadList[i].chapters.length,e.$scope.unitDownloadList[i].allNum==e.$scope.unitDownloadList[i].allTasksNum&&(e.$scope.unitDownloadList[i].allTasksNum>e.$scope.unitDownloadList[i].finishTasksNum?(e.$scope.unitDownloadList[i].status="downloading",s++,e.$scope.safeApply()):e.$scope.unitDownloadList[i].allTasksNum==e.$scope.unitDownloadList[i].finishTasksNum&&(e.$scope.unitDownloadList[i].status="finished",e.$scope.safeApply())));e.$scope.numOfDownloading=s,e.$scope.safeApply()}}},[{classId:n}]),e.$scope.showActionSheet=!0,e.$scope.safeApply()},window.stateUpdate=function(o){if(o.length>0)for(var t=0;t<o.length;t++)if(o[t].classId==n&&o[t].unitId==e.$scope.learnChapter.unitId)for(var s=0;s<e.$scope.units.length;s++)if(e.$scope.units[s].unitId==o[t].unitId)for(var i=0;i<e.$scope.units[s].itemList.length;i++)if(o[t].itemId==e.$scope.units[s].itemList[i].itemId)for(var a=0;a<e.$scope.units[s].itemList[i].chapterList.length;a++)o[t].chapterId==e.$scope.units[s].itemList[i].chapterList[a].chapterId&&(4==o[t].state&&(e.$scope.units[s].itemList[i].chapterList[a].videoPath=o[t].videoPath),e.$scope.units[s].itemList[i].chapterList[a].state=N(o[t].state),e.$scope.units[s].itemList[i].chapterList[a].processStart=c*o[t].downloadProgress,e.$scope.units[s].itemList[i].chapterList[a].processEnd=c*(1-o[t].downloadProgress),e.$scope.safeApply())},e.$scope.hideDownloadTip=function(){e.$scope.safeApply(function(){e.$scope.batchDownload=0})};var E=function(o){for(var t=0;t<o.length;t++)for(var s=0;s<e.$scope.units.length;s++)if(o[t].unitId==e.$scope.units[s].unitId)for(var n=0;n<e.$scope.units[s].itemList.length;n++)if(o[t].itemId==e.$scope.units[s].itemList[n].itemId)for(var i=0;i<e.$scope.units[s].itemList[n].chapterList.length;i++)o[t].chapterId==e.$scope.units[s].itemList[n].chapterList[i].chapterId&&"finished"!=e.$scope.units[s].itemList[n].chapterList[i].state&&(e.$scope.units[s].itemList[n].chapterList[i].state="searching");for(var c=[],r=0;r<o.length;r++)for(var p=0;p<o[r].unitData.length;p++)o[r].unitData[p].token=a,c.push(o[r].unitData[p]);e.Download.start({success:function(e){V(gxb.utils.jsonUtils.toObject(e))}},c)};e.$scope.downloadUnit=function(o,t){if("finished"==o.status||"downloading"==o.status)return!1;if("false"==o.canOpen&&20==e.$scope.intro.teachMode)e.$uiComponents.$toast.show("本章节尚未解锁，无法下载");else if(1==g){g=!1;var s=t.target.parentNode.getElementsByClassName("ball")[0];s.style.visibility="visible";var n=document.getElementsByClassName("icon_download")[0],i=funParabola(s,n,{speed:88,complete:function(){s.style.display="none",o.status="downloading",e.$scope.numOfDownloading++,e.$scope.safeApply()}}).mark();s.style.marginLeft="0px",s.style.marginTop="0px",i.init();var c=[];c.push(o),g=!0,E(c)}},e.$scope.downloadAll=function(){for(var o=[],t=[],s=0;s<e.$scope.unitDownloadList.length;s++)"default"==e.$scope.unitDownloadList[s].status&&(e.$scope.unitDownloadList[s].status="downloading",e.$scope.numOfDownloading++,o=o.concat(e.$scope.unitDownloadList[s].chapters),t.push(e.$scope.unitDownloadList[s]));o.length>0&&E(t)},e.$scope.closeBatchDownload=function(){e.$scope.safeApply(function(){e.$scope.showActionSheet=!1})},e.$scope.icon=1;var F=function(){e.$learnSrv.scoreAnalysisVideo(n,a).then(function(o){if(o.data.itemList){e.$scope.icon=0,e.$scope.scoreVideo=o.data.itemList;for(var t=0;t<e.$scope.scoreVideo.length;t++)e.$scope.scoreVideo[t].schedule=100*e.$scope.scoreVideo[t].schedule+"%",
"100%"==e.$scope.scoreVideo[t].schedule?e.$scope.scoreVideo[t].state="已完成":e.$scope.scoreVideo[t].state="未完成";e.$scope.safeApply()}})},H=function(){e.$learnSrv.scoreAnalysisQuiz(n,a).then(function(o){var t=[];if(o){for(var s=0;s<o.length;s++){var n=[],i={title:"",quizList:[]},c=o[s].title;if(i.title=c,o[s].itemList&&o[s].itemList.length>0)for(var a=0;a<o[s].itemList.length;a++){var r=o[s].itemList[a];if(r.chapterList&&r.chapterList.length>0)for(var p=0;p<r.chapterList.length;p++){var l=r.chapterList[p];n.push(l)}i.quizList=n}t.push(i)}e.$scope.scoreQuiz=t,e.$scope.safeApply()}})},R=function(){e.$learnSrv.scoreAnalysisAssignment(n,a).then(function(o){var t=[];if(o){for(var s=0;s<o.length;s++){var n=[],i={title:"",list:[]},c=o[s].title;if(i.title=c,o[s].itemList&&o[s].itemList.length>0)for(var a=0;a<o[s].itemList.length;a++){var r=o[s].itemList[a];if(r&&r.chapterList.length>0)for(var p=0;p<r.chapterList.length;p++){var l=r.chapterList[p];n.push(l)}i.list=n}t.push(i)}e.$scope.assignmentList=t,e.$scope.safeApply()}})},G=function(){e.$learnSrv.scoreAnalysisTopic(n,a).then(function(o){var t=[];if(o){for(var s=0;s<o.length;s++){var n=[],i={title:"",list:[]},c=o[s].title;if(i.title=c,o[s].itemList&&o[s].itemList.length>0)for(var a=0;a<o[s].itemList.length;a++){var r=o[s].itemList[a];if(r&&r.chapterList.length>0)for(var p=0;p<r.chapterList.length;p++){var l=r.chapterList[p];n.push(l)}i.list=n}t.push(i)}e.$scope.talkList=t,e.$scope.safeApply()}})},W=function(){e.$learnSrv.scoreAnalysisExam(n,a).then(function(o){o&&(e.$scope.scoreExam=o,e.$scope.safeApply())})},Q=function(){e.$learnSrv.scoreAnalysisTranscript(n,a).then(function(o){o&&e.$scope.safeApply(function(){e.$scope.scoreItem=o;var t=o.newFinalPercentileScore,s=t.split(".");e.$scope.scoreItem.integer=s[0],e.$scope.scoreItem.decimal=s[1]})})},K=function(){e.$courseSrv.assessmentSrv(n,a).then(function(o){o.data&&e.$scope.safeApply(function(){e.$scope.proportion=o.data})})},Y=function(){var e=new Promise(function(e,o){F(),H(),R(),G(),W(),Q(),K(),e()});return e},J=window.sessionStorage.getItem("gxbCoursePosition");if(J){var X=gxb.utils.jsonUtils.toObject(J);X&&X.classId==n&&2==X.tab||_(1)}else _(1);T(),y(),Y(),I().then(function(){return L(1)}).then(function(){return P()}).then(function(){return x()}),e.$scope.showRule=function(){var o=e.$ionicScrollDelegate.$getByHandle("scoreScroll").getScrollPosition().top,t={classId:n,tab:3,top:o,curOpen:e.$scope.curOpen};window.sessionStorage.setItem("gxbCoursePosition",gxb.utils.jsonUtils.toString(t)),e.$state.go("learn_rule",{id:n},{reload:!0})},e.$scope.isOpen=function(o){e.$scope.curOpen==o?e.$scope.curOpen=0:e.$scope.curOpen=o,e.$scope.safeApply(),e.$ionicScrollDelegate.$getByHandle("scoreScroll").resize()}},e.inheritFromCtrl(e.learning.detailCtrl),e.registerDependency("gxb.controllers.learning.detailCtrl",["gxb.services.courses.courseSrv","gxb.services.learning.learnSrv","gxb.models.learning.announcementModel","gxb.models.courses.introModel","gxb.models.courses.chapterListModel","gxb.models.courses.batchDownloadModel","$ionicModal","Download","Play","Lives","networkState","$ionicPopup","Preferences","gxb.services.users.loginSrv","gxb.models.learning.topicModel","gxb.models.learning.liveVideoModel","$ionicScrollDelegate","$ionicSlideBoxDelegate","$ionicPopup","$ionicHistory","$anchorScroll","ClassName"]),e.registerView("gxb.controllers.learning.detailCtrl","courses_detail")}(gxb.controllers),function(e){e.learning.evaluationCtrl=function(e){var o=(e.$stateParams.id,e.$stateParams.courseId);e.$scope.evaluation={message:""};var t=e.$pluginComponents.$accessToken.get();e.$scope.closeEvaluation=function(){if(null!=e.$scope.evaluation.message&&""!=e.$scope.evaluation.message){e.$ionicPopup.show({template:"你确定要退出评价？",buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(o){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack(),e.$scope.evaluation.message=""}}]})}else"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack(),e.$scope.evaluation.message=""},e.$scope.sendEvaluation=function(){var s={content:e.$scope.evaluation.message,rating:10,status:"active"};e.$learnSrv.submitEvaluation(s,o,t).then(function(o){null!=o&&1==o.status?(e.$uiComponents.$toast.show("评价成功"),e.$scope.evaluation.message="","Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()):e.$uiComponents.$toast.show("评价失败")})}},e.inheritFromCtrl(e.learning.announcementCtrl),e.registerDependency("gxb.controllers.learning.evaluationCtrl",["gxb.services.learning.learnSrv","$ionicPopup"]),e.registerView("gxb.controllers.learning.evaluationCtrl","evaluation")}(gxb.controllers),function(e){e.learning.keysCtrl=function(e){e.$scope.time=e.$stateParams.time,e.$scope.$submissionModel=new e.$submissionModel,e.$scope.navBarStyle="back_left",document.addEventListener("deviceready",function(){"Android"==device.platform?e.$scope.navBarStyle="back_left":e.$scope.navBarStyle="back_leftes"}),e.$scope.goTome=function(){e.$state.go("course_quiz_topic",{id:e.$scope.classId,quizId:e.$stateParams.quizId,time:e.$scope.time},{reload:!0})},e.$pluginComponents.$currentIndex.set(-1),e.$scope.currentIndex=e.$stateParams.currentIndex,e.$scope.classId=e.$stateParams.id,e.$scope.quizId=e.$stateParams.quizId,e.$scope.submission=e.$pluginComponents.$objectCache.getObject("submission"),e.$scope.onSubmit=function(){e.$scope.$submissionModel.quizSubmission=e.$scope.submission;var o=e.$ionicPopup.confirm({title:"所提交答案不可更改。确认提交？",cancelText:"取消",cancelType:"button-default",okText:"确定",okType:"button-positive"});o.then(function(o){o&&e.$quizSrv.onSubmit(e.$scope.$submissionModel.quizSubmission,e.$scope.classId,e.$scope.quizId,e.$pluginComponents.$accessToken.get()).then(function(o){0==o.status?e.$state.go("course_quiz",{id:e.$stateParams.id,quizId:e.$stateParams.quizId},{reload:!0}):400==o.status&&e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})})})},e.$scope.goTopic=function(o){e.$pluginComponents.$currentIndex.set(o),e.$rootScope.$emit("$changeIndex"),e.$state.go("course_quiz_topic",{id:e.$stateParams.id,quizId:e.$stateParams.quizId,time:e.$stateParams.time},{reload:!0})}},e.inheritFromCtrl(e.learning.keysCtrl),e.registerDependency("gxb.controllers.learning.keysCtrl",["gxb.services.learning.quizSrv","gxb.models.learning.submissionModel"]),e.registerView("gxb.controllers.learning.keysCtrl","keys")}(gxb.controllers),function(target){target.learning.learnAnalysisCtrl=function(parameter){function submissionObj(){}parameter.$scope.time=parameter.$stateParams.time,parameter.$scope.navBarStyle="back_left",document.addEventListener("deviceready",function(){"Android"==device.platform?parameter.$scope.navBarStyle="back_left":parameter.$scope.navBarStyle="back_leftes"}),parameter.$scope.goBack=function(){parameter.$state.go("course_quiz",{id:parameter.$scope.classId,quizId:parameter.$scope.quizId},{reload:!0})};var $this=$this;parameter.$scope.currentIndex=1,parameter.$scope.classId=parameter.$stateParams.id,parameter.$scope.quizId=parameter.$stateParams.quizId,parameter.$scope.score=0;var letter=["A","B","C","D","E","F","G"],text=[],corrects=[];parameter.$scope.quiz=[];var quizlist=[],submissionLists=[];parameter.$scope.submissionId=parameter.$stateParams.submissionId,parameter.$scope.ischeck=parameter.$pluginComponents.$analysis.set(!1),parameter.$scope.goTome=function(){parameter.$state.go("course_quiz",{id:parameter.$scope.classId,quizId:parameter.$scope.quizId},{reload:!0})},parameter.$quizSrv.getAnalysisList(parameter.$scope.classId,parameter.$scope.quizId,parameter.$pluginComponents.$accessToken.get()).then(function(res){if(0==res.status){quizlist=res.data.quiz,parameter.$scope.quiz=quizlist,parameter.$scope.isAnalysis=new Date(gxb.utils.dateUtils.date(res.data.quiz.dueAtStr))<new Date;var submissionList=[];if(parameter.$scope.submissionId==-1){for(var sindex=0 in parameter.$scope.quiz.quizQuestionList){var subObj=new submissionObj;subObj.question_id=parameter.$scope.quiz.quizQuestionList[sindex].questionId;for(var aIndex=0 in parameter.$scope.quiz.quizQuestionList[sindex].answerList)"1"==parameter.$scope.quiz.quizQuestionList[sindex].answerList[aIndex]&&subObj.answer_ids.push(parameter.$scope.quiz.quizQuestionList[sindex].answerList[aIndex].answerId);submissionList.push(subObj)}submissionLists=submissionList,parameter.$scope.submissionData=submissionLists,parameter.$scope.score=0,parameter.$scope.safeApply()}else{submissionList=res.data.submission.quizSubmissionList;for(var index=0;index<submissionList.length;index++)if(submissionList[index].quizSubmissionId==parameter.$scope.submissionId){submissionLists=eval(submissionList[index].submissionData),parameter.$scope.submissionData=submissionLists,parameter.$scope.score=submissionList[index].score;for(var subindex=0;subindex<parameter.$scope.submissionData.length;subindex++)text[parameter.$scope.submissionData[subindex].question_id]=parameter.$scope.submissionData[subindex].text;parameter.$scope.safeApply()}}setTimeout(function(){(void 0==parameter.$pluginComponents.$flush.get()||(new Date).getTime()-parameter.$pluginComponents.$flush.get()>1e4)&&(parameter.$pluginComponents.$flush.set((new Date).getTime()),parameter.$state.go("course_quiz_topic_analysis",{id:parameter.$scope.classId,quizId:parameter.$scope.quizId,submissionId:parameter.$scope.submissionId,time:parameter.$scope.time},{reload:!0})),parameter.$ionicSlideBoxDelegate.update()},10)}else 400==res.status&&parameter.$state.go("user_login_no",{tenantId:parameter.$pluginComponents.$tenantId.get()},{reload:!0})}),parameter.$scope.slideChange=function(e){parameter.$scope.currentIndex=e+1},parameter.$scope.renderHtml=function(e){var o=/<p[^>]*>(\n)*<br[\/]*>(\n)*<\/p>/gi,t=e.replace(o,"");return parameter.$sce.trustAsHtml(t)},parameter.$scope.getLetter=function(e){return letter[e]},parameter.$scope.isRight=function(e,o){if(void 0!=text[e]&&text[e].indexOf(o)!=-1)return!0},parameter.$scope.setCorrect=function(e,o){corrects[e]=o},parameter.$scope.getCorrect=function(e){return corrects[e]},parameter.$scope.getAnwser=function(e){var o="",t=new Date(gxb.utils.dateUtils.date(quizlist.dueAtStr)),s=new Date;if(s<t)return"";for(var n in quizlist.quizQuestionList[e].answerList)"1"==quizlist.quizQuestionList[e].answerList[n].correct&&(o+=0!=o.length?"、"+letter[n]:letter[n]+"");return o},parameter.$scope.goKeys=function(){parameter.$pluginComponents.$objectCache.setObject("submission",submissionLists),parameter.$state.go("course_quiz_topic_answerCard",{id:parameter.$stateParams.id,quizId:parameter.$stateParams.quizId,submissionId:parameter.$stateParams.submissionId,score:parameter.$scope.score},{reload:!0})},parameter.$rootScope.$on("$changeIndex",function(){parameter.$timeout(function(){if("true"==parameter.$pluginComponents.$analysis.get()){var e=0,o=[],t=[];for(s in submissionLists)if(!submissionLists[s].correct){for(quiz in quizlist.quizQuestionList)quizlist.quizQuestionList[quiz].questionId==submissionLists[s].question_id&&(parameter.$pluginComponents.$currentIndex.get()==s&&(e=o.length),o.push(quizlist.quizQuestionList[quiz]));t.push(submissionLists[s])}var n=[];n.quizQuestionList=o,parameter.$scope.quiz=n,parameter.$scope.submissionData=t,parameter.$ionicSlideBoxDelegate.slide(e)}else parameter.$scope.quiz.length==quizlist.length?(parameter.$scope.quiz=quizlist,parameter.$scope.submissionData=submissionLists,parameter.$ionicSlideBoxDelegate.slide(parameter.$pluginComponents.$currentIndex.get())):(parameter.$scope.quiz=[],parameter.$scope.safeApply(),parameter.$scope.quiz=quizlist,parameter.$scope.submissionData=submissionLists,parameter.$scope.safeApply(),parameter.$ionicSlideBoxDelegate.slide(parameter.$pluginComponents.$currentIndex.get()),parameter.$ionicSlideBoxDelegate.update())},100)}),parameter.$scope.handleImgUrl=function(e){var o=/<img [^>]*src=['"]([^'"]+)[^>]*>/gi;return o.test(e)?e.replace(o,function(e,o){var t=/^\/\/.*/;if(t.test(o)){var s=o.replace(t,"https:"+o);return"<img src='"+s+"' />"}}):e}},target.inheritFromCtrl(target.learning.learnAnalysisCtrl),target.registerDependency("gxb.controllers.learning.learnAnalysisCtrl",["gxb.services.learning.quizSrv"]),target.registerView("gxb.controllers.learning.learnAnalysisCtrl","learn_analysis")}(gxb.controllers),function(e){e.learning.learnQuizCtrl=function(e){e.$scope.quizObject={},e.$scope.submissionObj={},e.$scope.quizSubmissionList=[],e.$scope.classId=e.$stateParams.id,e.$scope.quizId=e.$stateParams.quizId,e.$scope.isPrompt=!0,e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?(e.$uiComponents.$history.goBack(),e.$rootScope.$emit("$changeState")):(e.$rootScope.$ionicGoBack(),e.$rootScope.$emit("$changeState"))};var o=function(e){for(var o,t,s=[],n=0;n<e.length;n++)s.push(e[n].score);o=Math.max.apply(null,s);for(var i=0;i<e.length;i++)e[i].score==o&&(t=e[i]);return t};1==e.$stateParams.jump&&e.$loginSrv.UpdateMessageId(e.$pluginComponents.$accessToken.get(),e.$rootScope.messageId).then(function(e){}),e.$quizSrv.getQuizList(e.$scope.classId,e.$scope.quizId,e.$pluginComponents.$accessToken.get()).then(function(t){if("0"==t.status){e.$scope.quizObject=t.data.quiz,t.data.submission?(e.$scope.showSubmisson=!0,e.$scope.submissionObj=t.data.submission,t.data.submission.quizSubmissionList&&(e.$scope.quizSubmissionList=t.data.submission.quizSubmissionList,e.$scope.quizSubmissionList1=e.$scope.listSortBy(e.$scope.quizSubmissionList,"score","desc"),e.$scope.quizSubmissionList2=e.$scope.listSortBy(e.$scope.quizSubmissionList1,"createdAt","asc"),e.$scope.effectiveQuizSubmissionId=o(t.data.submission.quizSubmissionList).quizSubmissionId,e.$scope.score=e.$scope.quizObject.allowedAttempts-e.$scope.submissionObj.quizSubmissionLength,e.$scope.safeApply())):e.$scope.showSubmisson=!1,e.$scope.submitStatus={};var s=new Date,n=new Date(gxb.utils.dateUtils.date(t.data.quiz.unlockAtStr)),i=new Date(gxb.utils.dateUtils.date(t.data.quiz.dueAtStr));s-n>0&&s-i<0?(e.$scope.submitStatus.state="提交阶段",e.$scope.submitStatus.btnClass="start",e.$scope.submitStatus.className="in_submission",t.data.submission?"-1"==e.$scope.quizObject.allowedAttempts?e.$scope.submitStatus.title="共无限次提交机会，已提交"+t.data.submission.quizSubmissionLength+"次取最高分作为有效成绩":e.$scope.submitStatus.title="共"+e.$scope.quizObject.allowedAttempts+"次有效提交机会，还剩"+e.$scope.score+"次取最高分作为有效成绩":"-1"==e.$scope.quizObject.allowedAttempts?e.$scope.submitStatus.title="共无限次提交机会，已提交0次取最高分作为有效成绩":e.$scope.submitStatus.title="共"+e.$scope.quizObject.allowedAttempts+"次有效提交机会，还剩"+e.$scope.quizObject.allowedAttempts+"次取最高分作为有效成绩",0==e.$scope.score?e.$scope.canSubmit=!1:e.$scope.canSubmit=!0,e.$scope.safeApply()):s-i>0&&(e.$scope.submitStatus.state="提交截止",e.$scope.submitStatus.btnClass="noPoint",e.$scope.submitStatus.className="end",e.$scope.submitStatus.title="提交已截止",e.$scope.canSubmit=!1,e.$scope.safeApply()),e.$scope.safeApply()}else 400==t.status&&e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})}),e.$scope.startTopic=function(){"start"==e.$scope.submitStatus.btnClass?e.$state.go("course_quiz_topic",{id:e.$scope.classId,quizId:e.$scope.quizId,time:(new Date).getTime()},{reload:!0}):$(".btn").attr("disabled","disabled")},e.$scope.isOpen=0,e.$scope.record=function(){var o=document.getElementsByClassName("record")[0];if(0==e.$scope.isOpen){e.$scope.isOpen=1;var t=document.getElementsByClassName("record_inner")[0],s=t.offsetHeight;s<200?o.style.height=s+"px":o.style.height="200px"}else e.$scope.isOpen=0,o.style.height="42px"},e.$scope.listSortBy=function(e,o,t){for(var s,n=[],i=[],t="asc"==t?"asc":"desc",c=0;c<e.length;c++)n[c]=e[c][o]+":"+c;for(n.sort(),"desc"==t&&n.reverse(),c=0;c<n.length;c++)s=n[c].split(":")[1],i[c]=e[s];return i},e.$scope.viewAnalysis=function(){e.$state.go("course_quiz_topic_analysis",{id:e.$scope.classId,quizId:e.$scope.quizId,submissionId:"-1"},{reload:!0})},e.$scope.goSee=function(o){e.$state.go("course_quiz_topic_analysis",{id:e.$scope.classId,quizId:e.$scope.quizId,submissionId:o,time:(new Date).getTime()},{reload:!0})}},e.inheritFromCtrl(e.learning.learnQuizCtrl),e.registerDependency("gxb.controllers.learning.learnQuizCtrl",["gxb.services.learning.quizSrv","gxb.services.users.loginSrv","gxb.services.profiles.profilesSrv"]),e.registerView("gxb.controllers.learning.learnQuizCtrl","learn_quiz")}(gxb.controllers),function(e){e.learning.learnRuleCtrl=function(e){var o=e.$stateParams.id,t=e.$pluginComponents.$accessToken.get();e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$courseSrv.assessmentSrv(o,t).then(function(o){o.data&&e.$scope.safeApply(function(){e.$scope.proportion=o.data,console.log(e.$scope.proportion)})})},e.inheritFromCtrl(e.learning.learnRuleCtrl),e.registerDependency("gxb.controllers.learning.learnRuleCtrl",["gxb.services.courses.courseSrv"]),e.registerView("gxb.controllers.learning.learnRuleCtrl","learn_rule")}(gxb.controllers),function(e){e.learning.learnTopicCtrl=function(e){e.$scope.classId=e.$stateParams.id,e.$scope.quizId=e.$stateParams.quizId,e.$scope.time=e.$stateParams.time,e.$scope.navBarStyle="back_left",document.addEventListener("deviceready",function(){"Android"==device.platform?e.$scope.navBarStyle="back_left":e.$scope.navBarStyle="back_leftes"}),e.$scope.goTome=function(){e.$ionicPopup.show({template:"测验还未提交，返回将丢失本次测验记录。确认返回？",buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(o){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()}}]})};var o=["A","B","C","D","E","F","G","H"];e.$scope.currentIndex=1,e.$scope.slidesCount=e.$ionicSlideBoxDelegate.slidesCount(),e.$scope.$submissionModel=new e.$submissionModel,e.$scope.quizSubmission=[],e.$scope.quiz=[],void 0==e.$pluginComponents.$max.get()?e.$scope.max=!0:e.$scope.max=!1,e.$quizSrv.getTopicList(e.$scope.classId,e.$scope.quizId,e.$pluginComponents.$accessToken.get()).then(function(o){if(0==o.status){e.$scope.quiz=o.data.quiz;for(var t=0;t<o.data.quiz.quizQuestionList.length;t++){var s=new Object;s.question_id=o.data.quiz.quizQuestionList[t].questionId,s.text=[],e.$scope.quizSubmission[o.data.quiz.quizQuestionList[t].questionId]=s,e.$scope.safeApply()}setTimeout(function(){(void 0==e.$pluginComponents.$flush.get()||(new Date).getTime()-e.$pluginComponents.$flush.get()>1e4)&&(e.$pluginComponents.$flush.set((new Date).getTime()),e.$state.go("course_quiz_topic",{id:e.$scope.classId,quizId:e.$scope.quizId,time:e.$scope.time},{})),e.$ionicSlideBoxDelegate.update()},10)}else 400==o.status&&e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})}),e.$rootScope.$on("$changeIndex",function(){e.$timeout(function(){e.$ionicSlideBoxDelegate.slide(e.$pluginComponents.$currentIndex.get())},100)}),e.$scope.slideChange=function(o){e.$scope.currentIndex=o+1},e.$scope.setMax=function(){e.$scope.max=!1,e.$pluginComponents.$max.set("false")},e.$scope.renderHtml=function(o){return e.$sce.trustAsHtml(o)},e.$scope.getLetter=function(e){return o[e]},e.$scope.doChoise=function(o,s){var n=e.$scope.quizSubmission[o].text;for(t in n)if(n[t]==s)return"active"},e.$scope.doAnwser=function(o,s,n){var i=e.$scope.quizSubmission[o].text;if(void 0==i)i.push(s);else if("multiple_choice"==n)i[0]=s;else{var c=-1;for(t in i)i[t]==s&&(c=t);c==-1?i.push(s):i.splice(c,1)}},e.$scope.doSubmit=function(){for(var o=[],t=0,s=0;s<e.$scope.quiz.quizQuestionList.length;s++)o[s]=e.$scope.quizSubmission[e.$scope.quiz.quizQuestionList[s].questionId],o[s].text.length>0&&t++;if(e.$scope.$submissionModel.quizSubmission=o,t!=e.$scope.quiz.quizQuestionList.length)if(0==t){e.$ionicPopup.show({template:"所提交答案不可更改。确认提交？",buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(o){e.$uiComponents.$loadding.show(),e.$quizSrv.onSubmit(e.$scope.$submissionModel.quizSubmission,e.$scope.classId,e.$scope.quizId,e.$pluginComponents.$accessToken.get()).then(function(o){e.$uiComponents.$loadding.hide(),0==o.status?(e.$uiComponents.$toast.show("提交成功"),e.$state.go("course_quiz",{id:e.$stateParams.id,quizId:e.$stateParams.quizId},{reload:!0})):400==o.status?e.$state.go("account_signin",{reload:!0}):e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})}}]})}else{e.$ionicPopup.show({template:"还有未做的题目。确认提交？",buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(o){e.$uiComponents.$loadding.show(),e.$quizSrv.onSubmit(e.$scope.$submissionModel.quizSubmission,e.$scope.classId,e.$scope.quizId,e.$pluginComponents.$accessToken.get()).then(function(o){e.$uiComponents.$loadding.hide(),0==o.status?(e.$uiComponents.$toast.show("提交成功"),e.$state.go("course_quiz",{id:e.$stateParams.id,quizId:e.$stateParams.quizId},{reload:!0})):400==o.status?e.$state.go("account_signin",{reload:!0}):e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})}}]})}else e.$uiComponents.$loadding.show(),e.$quizSrv.onSubmit(e.$scope.$submissionModel.quizSubmission,e.$scope.classId,e.$scope.quizId,e.$pluginComponents.$accessToken.get()).then(function(o){e.$uiComponents.$loadding.hide(),0==o.status?(e.$uiComponents.$toast.show("提交成功"),e.$state.go("course_quiz",{id:e.$stateParams.id,quizId:e.$stateParams.quizId},{reload:!0})):400==o.status?e.$state.go("account_signin",{reload:!0}):e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},e.$scope.goKeys=function(){for(var o=[],t=0;t<e.$scope.quiz.quizQuestionList.length;t++)o[t]=e.$scope.quizSubmission[e.$scope.quiz.quizQuestionList[t].questionId];e.$pluginComponents.$objectCache.setObject("submission",o),e.$state.go("course_quiz_topic_keys",{id:e.$stateParams.id,quizId:e.$stateParams.quizId,currentIndex:e.$scope.currentIndex,time:e.$scope.time},{reload:!0})},e.$scope.handleImgUrl=function(e){var o=/<img [^>]*src=['"]([^'"]+)[^>]*>/gi;return o.test(e)?e.replace(o,function(e,o){var t=/^\/\/.*/;if(t.test(o)){var s=o.replace(t,"https:"+o);return"<img src='"+s+"' />"}}):e}},e.inheritFromCtrl(e.learning.learnTopicCtrl),e.registerDependency("gxb.controllers.learning.learnTopicCtrl",["$ionicPopup","gxb.services.learning.quizSrv","gxb.models.learning.submissionModel"]),e.registerView("gxb.controllers.learning.learnTopicCtrl","learn_topic")}(gxb.controllers),function(e){e.learning.liveVideoDetailCtrl=function(e){var o=e.$stateParams.webcastId,t=e.$stateParams.id,s=e.$pluginComponents.$accessToken.get();e.$scope.tab=0,e.$scope.showVideoMessage=function(){e.$scope.tab=0},e.$scope.showChat=function(){e.$scope.tab=1},e.$scope.showWhiteboard=function(){e.$scope.tab=2},e.$scope.liveVideoObj={},e.$scope.liveVideoPapers={},e.$learnSrv.getLiveVideoUrl(o,t,s).then(function(o){o&&(e.$scope.liveVideoObj=o,e.$scope.liveVideoObj.cache="./images/course_cover_def.png",e.$scope.safeApply(),document.addEventListener("deviceready",function(){window.plugins.ImageCachePlugin.cache(e.$scope.liveVideoObj.cover,0,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.liveVideoObj.cache=t.cache,e.$scope.safeApply()})}))}),e.$learnSrv.getLiveVideoPapers(o,s).then(function(o){o&&(e.$scope.liveVideoPapers=o,e.$scope.safeApply())}),e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.style="","Android"==e.$rootScope.platformType?e.$scope.detailStyle="android":e.$scope.detailStyle=""},e.inheritFromCtrl(e.learning.liveVideoDetailCtrl),e.registerDependency("gxb.controllers.learning.liveVideoDetailCtrl",["gxb.services.learning.learnSrv"]),e.registerView("gxb.controllers.learning.liveVideoDetailCtrl","liveVideo_detail")}(gxb.controllers),function(e){e.learning.preReadingCtrl=function(e){var o=e.$stateParams.id;document.getElementById("scrollLayer").style.height=window.screen.availHeight-document.getElementById("preBack").offsetHeight-25+"px",e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?(e.$uiComponents.$history.goBack(),e.$rootScope.$emit("$changeState")):(e.$rootScope.$ionicGoBack(),e.$rootScope.$emit("$changeState"))},e.$scope.toLearn=function(){e.$state.go("courses_detail",{id:o,firstTime:1})}},e.inheritFromCtrl(e.learning.preReadingCtrl),e.registerDependency("gxb.controllers.learning.preReadingCtrl",["$ionicHistory"]),e.registerView("gxb.controllers.learning.preReadingCtrl","pre_reading")}(gxb.controllers),function(e){e.learning.replyDetailCtrl=function(e){var o=e.$stateParams.topicId,t=e.$stateParams.postId,s=e.$stateParams.id,n=e.$pluginComponents.$accessToken.get(),i=e.$stateParams.type;e.$scope.type=i,e.$scope.replyUser=e.$pluginComponents.$objectCache.getObject("userObject"),e.$scope.replyDetail=e.$pluginComponents.$objectCache.getObject("replyObj"),e.$scope.MaxMe=function(){var e=document.getElementById("replyText");e.style.height=e.scrollTop+e.scrollHeight+"px"},e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$learnSrv.getMyTopicDetail(s,t,1,n).then(function(o){if(o)if(null==o.dataList)e.$scope.safeApply(function(){e.$scope.tab=0,e.$scope.replyList=[]});else{for(var t=[],s=0;s<o.dataList.length;s++)t[s]=o.dataList[s];e.$scope.safeApply(function(){e.$scope.replyList=t,e.$scope.tab=1})}else 400==o.status&&e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})}),e.$scope.reply={message:""},e.$scope.onSubmit=function(){var s={message:e.$scope.reply.message};e.$learnSrv.getsubReplyContent(s,o,t,n).then(function(o){"success"==o.state?(null!=o.data&&(o.data.userName=e.$scope.replyUser.name,o.data.userAvatar_url=e.$scope.replyUser.userAvatar_url),e.$scope.replyList.length>0?e.$scope.replyList.unshift(o.data):e.$scope.replyList.push(o.data),e.$scope.tab=1,e.$scope.$apply(),e.$uiComponents.$toast.show("评论成功"),e.$scope.reply.message="",document.getElementById("replyText").style.height="35px",e.$scope.replyDetail.postsCount=parseInt(e.$scope.replyDetail.postsCount)+1,e.$rootScope.$emit("$commit")):400==o.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):e.$uiComponents.$toast.show("评论失败")})},e.$scope["delete"]=function(t){e.$ionicPopup.alert({title:"确认删除此条评论？",buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(s){var i=[];for(var c in e.$scope.replyList)e.$scope.replyList[c].postId!=t&&i.push(e.$scope.replyList[c]);e.$scope.replyList=i,e.$learnSrv.getTopicDelete(o,t,n).then(function(o){400==o.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):"success"==o.state&&(e.$scope.replyDetail.postsCount=parseInt(e.$scope.replyDetail.postsCount)-1)})}}]})}},e.inheritFromCtrl(e.learning.replyDetailCtrl),e.registerDependency("gxb.controllers.learning.replyDetailCtrl",["gxb.services.learning.learnSrv","$ionicPopup"]),e.registerView("gxb.controllers.learning.replyDetailCtrl","reply_detail")}(gxb.controllers),function(e){e.learning.topicCtrl=function(e){var o,t="0",s=e.$stateParams.id,n=e.$stateParams.topicId,i=e.$stateParams.type,c=e.$pluginComponents.$accessToken.get(),a=!0,r=1,p=e.$ionicScrollDelegate.$getByHandle("topicScroll");e.$scope.remark="暂无评语！",e.$scope.scoreTopic=!1,e.$scope.myScoreTopic=!1,e.$scope.type=i,e.$scope.myReply=1,e.$scope.showScore=0,e.$scope.topicInfo=e.$pluginComponents.$objectCache.getObject("userObject"),e.$scope.scrollStyle="topicScroll",e.$scope.topicDetailScroll="topicDetailScroll","Android"==e.$rootScope.platformType?(e.$scope.scrollStyle="topicScroll",e.$scope.topicDetailScroll="topicDetailScroll"):(e.$scope.scrollStyle="topicScrolls",e.$scope.topicDetailScroll="topicDetailScrolls"),e.$scope.reply={message:null},window.showKeyboard=function(e){var o=document.getElementsByClassName("bar-assertive")[0];o.style.bottom=parseInt(e)+"px"},window.hidekeyboard=function(){var e=document.getElementsByClassName("bar-assertive")[0];e.style.bottom=parseInt(document.body.clientHeight)+"px"},e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()};var l=function(){e.$ionicScrollDelegate.$getByHandle("topicScroll").resize()};e.$scope.topicDetail={},e.$scope.replyList=[],e.$scope.hasMoreReply=0,e.$learnSrv.getTopicDetail(n,1,c).then(function(t){if(e.$scope.sondsStuta=1,t){e.$scope.replyTotal=t.replyList.paging.total,e.$scope.replyCurPage=1,e.$scope.replyTotalPage=t.replyList.paging.totalPage,e.$scope.replyTotalPage>e.$scope.replyCurPage?e.$scope.hasMoreReply=1:e.$scope.hasMoreReply=0,e.$scope.safeApply(function(){e.$scope.topicDetail=t.topic,e.$scope.replyList=t.replyList.dataList}),"1"==t.topic.score&&(e.$scope.myScoreTopic=!0),e.$scope.tab=1,e.$scope.safeApply(),null==e.$scope.replyList?(e.$scope.tab=0,e.$scope.safeApply()):(e.$scope.tab=1,e.$scope.safeApply()),o=function(o,t,s){e.$learnSrv.myTopicReply(o,t,s).then(function(o){if(o.data.message||o.data.postAttachmentVoList.length>0?e.$scope.safeApply(function(){e.$scope.scoreTopic=!0,e.$scope.myReply=1,e.$scope.topicReply=o.data}):e.$scope.safeApply(function(){e.$scope.myReply=0,e.$scope.scroe="0.0"}),e.$scope.replyList)for(var t=0;t<e.$scope.replyList.length;t++)e.$scope.replyList[t].postId==o.data.postId&&e.$scope.replyList[t].submissionMap&&("1"==e.$scope.replyList[t].submissionMap.isPublish?(e.$scope.showScore=1,e.$scope.scroe=e.$scope.replyList[t].submissionMap.score,e.$scope.replyList[t].submissionMap.comment&&(e.$scope.remark=e.$scope.replyList[t].submissionMap.comment.replace(/<\/?[^>]*>/g,"")),e.$scope.safeApply()):e.$scope.safeApply(function(){e.$scope.showScore=0}),e.$scope.replyList[t].createdAt>=e.$scope.topicDetail.dueAt&&e.$scope.safeApply(function(){e.$scope.showScore=2}))})},o(s,n,c);var a=null,r=(new Date).getTime(),p=new Date(gxb.utils.dateUtils.date(e.$scope.topicDetail.dueAt)).getTime();null!=e.$scope.topicDetail.unlockAt&&(a=new Date(gxb.utils.dateUtils.date(e.$scope.topicDetail.unlockAt)).getTime()),"1"==e.$scope.topicDetail.score&&(r-p>=0?e.$scope.show=1:r-a<0&&null!=a?e.$scope.show=2:e.$scope.show=0),e.$scope.rule=function(){window.plugins.nativepagetransitions.cancelPendingTransition(function(){},function(){});e.$ionicPopup.alert({title:"得分规则",template:"1、发表20字以上的回复，尽可能精彩；<br/>2、截止时间前回复才能得分，抓紧哦；<br/>3、回复只能发一次，讨论截止前可以多次进行编辑；<br/>4、请勿抄袭或复制其他学生的观点，否则老师会酌情予以扣分。",buttons:[{text:"<b>我知道了</b>",type:"button-positive",onTap:function(e){}}]})},e.$scope.goreplyDetail=function(o,t,c,a,r,p,l,$){var u={message:t,createdAt:c,userName:a,userAvatar:r,postsCount:p,voteUpCount:l,voteLog:$};e.$pluginComponents.$objectCache.setObject("replyObj",u),e.$state.go("course_item_topic_replyDetail",{id:s,topicId:n,postId:o,type:i},{reload:!0})}}else 400==t.status&&e.$state.go("account_signin",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})},function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}),e.$scope.showes=!1;var u="展开",d="收起";e.$scope.isOpen=0,e.$scope.isOpen1=0,e.$scope.text=u,e.$scope.text1=u,e.$scope.timer=setTimeout(function(){var o=document.getElementsByClassName("intro-detail")[0];if(o){var t=o.offsetHeight;t>65&&(console.log(t),o.style.height="60px",e.$scope.showes=!0,e.$scope.safeApply())}},500),e.$scope.open=function(){0==e.$scope.isOpen?(e.$scope.isOpen=1,e.$scope.text=d):(e.$scope.isOpen=0,e.$scope.text=u),e.$scope.safeApply(function(){e.$ionicScrollDelegate.$getByHandle("scrollLayer").resize()})},e.$scope.open1=function(){if(0==e.$scope.isOpen1){e.$scope.isOpen1=1;var o=document.getElementsByClassName("intro-detail")[0];o.style.height="auto",e.$scope.text1=d}else{e.$scope.isOpen1=0;var t=document.getElementsByClassName("intro-detail")[0];t.style.height="60px",e.$scope.text1=u}e.$scope.safeApply(function(){e.$ionicScrollDelegate.$getByHandle("scrollLayer").resize()})};var g=function(o){e.$learnSrv.getTopicDetail(n,o,c).then(function(o){if(o){for(var t in o.replyList.dataList)e.$scope.replyList.push(o.replyList.dataList[t]);e.$scope.safeApply(),
l(),a=!1}e.$scope.replyCurPage==e.$scope.replyTotalPage&&(e.$scope.hasMoreReply=0,e.$scope.safeApply())})};e.$scope.loadMoreReply=function(){0!=a&&(e.$scope.replyCurPage++,g(e.$scope.replyCurPage))},e.$scope.scrollHandle=function(){var o=p.getScrollView(),t=o.__maxScrollTop,s=p.getScrollPosition().top;s+55>=t&&e.$scope.replyCurPage<e.$scope.replyTotalPage&&(e.$scope.loadMoreReply(),a=!0)},e.$scope.del=function(o){e.$ionicPopup.alert({title:"确认删除此条回复？",buttons:[{text:"取消"},{text:"<b>确认</b>",type:"button-positive",onTap:function(t){var s=[];for(var i in e.$scope.replyList)e.$scope.replyList[i].postId!=o&&s.push(e.$scope.replyList[i]);e.$scope.replyList=s,e.$learnSrv.getTopicDelete(n,o,c).then(function(o){400==o.status?e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):"success"==o.state&&(e.$scope.safeApply(function(){e.$scope.topicDetail.postsCount--}),e.$scope.tab=1)}),0==s.length&&(e.$scope.tab=0)}}]})},void 0==e.$pluginComponents.$newReply.get()?e.$scope.newReply=!0:e.$scope.newReply=!1,e.$scope.replyTopic=function(){2==e.$scope.show?(e.$uiComponents.$toast.show("本讨论的时间为"+e.$scope.topicDetail.unlockAt+"，请耐心等待"),e.$scope.replyStatu=!1):e.$scope.replyStatu=!0},e.$scope.submitReply=function(o,t){if(e.$scope.replyStatu){var s={message:e.$scope.reply.message};null==s.message?e.$uiComponents.$toast.show("不能少于20个字"):0==r?e.$learnSrv.updateEdit(s,o,t,c).then(function(o){"0"==o.status&&(e.$scope.safeApply(function(){e.$scope.reply.message=null}),gxb.controllers.learning.topicCtrl(e))}):e.$learnSrv.replyTopic(o,s,c).then(function(o){"success"==o.state?(e.$uiComponents.$toast.show("发布回复成功"),e.$scope.reply.message=null,gxb.controllers.learning.topicCtrl(e)):0==o.status?e.$uiComponents.$toast.show(o.message):e.$uiComponents.$toast.show("发布回复失败，请重试")},function(){e.$uiComponents.$toast.show("发布回复失败,请重试")})}},e.$scope.editAlert=function(){e.$scope.safeApply(function(){e.$scope.scoreTopic=!1,r=0,e.$scope.reply={message:e.$scope.topicReply.message},setTimeout(function(){$(".reply_btn textarea").focus()},200)})},e.$scope.showRemark=function(){e.$uiComponents.$toast.show(e.$scope.remark)},e.$scope.sondsStuta=1;var m=!0;e.$scope.showMyPlay=function(o,s,n){if(o!=t&&(m=!0,$("#myAudioPlayer")[0].pause()),t=o,m){m=!1;var n=1e3*n;e.$scope.auto_src=s,clearInterval(e.$scope.timer),clearTimeout(e.$scope.timers);var i=["../www/images/voice_1.png","../www/images/voice_2.png","../www/images/voice_3.png"];e.$scope.thatPlay=o,e.$scope.timer=null,e.$scope.num=-1,e.$scope.timer=setInterval(function(){e.$scope.num++,3==e.$scope.num&&(e.$scope.num=0),e.$scope.arrImgSrc=i[e.$scope.num],e.$scope.safeApply()},500),e.$scope.timers=setTimeout(function(){m=!0,clearInterval(e.$scope.timer),e.$scope.thatPlay="-1",e.$scope.auto_src="1",e.$scope.safeApply()},n)}else m=!0,clearInterval(e.$scope.timer),e.$scope.thatPlay="-1",$("#myAudioPlayer")[0].pause(),e.$scope.safeApply()},e.$scope.showPlay=function(o,s,n){if(o!=t&&(m=!0,$(".audio-wrap-margin").find("audio").each(function(){$(this)[0].pause()})),t=o,m){m=!1;var n=1e3*n;e.$scope.auto_src=s,clearInterval(e.$scope.timer),clearTimeout(e.$scope.timers);var i=["../www/images/voice_1.png","../www/images/voice_2.png","../www/images/voice_3.png"];e.$scope.thisPlay=o,e.$scope.timer=null,e.$scope.num=-1,e.$scope.timer=setInterval(function(){e.$scope.num++,3==e.$scope.num&&(e.$scope.num=0),e.$scope.arrImgSrc=i[e.$scope.num],e.$scope.safeApply()},500),e.$scope.timers=setTimeout(function(){m=!0,clearInterval(e.$scope.timer),e.$scope.thisPlay="-1",e.$scope.auto_src="1",e.$scope.safeApply()},n)}else m=!0,clearInterval(e.$scope.timer),e.$scope.thisPlay="-1",$(".audio-wrap-margin").find("audio").each(function(){$(this)[0].pause()}),e.$scope.safeApply()},e.$scope.toInput=function(){3!=e.$scope.sondsStuta&&(e.$scope.sondsStuta=1),e.$scope.safeApply()},window.stopRecord=function(o){var t="file://"+o,s="http://gxb-file.cdn.bj.xs3cnc.com/uploads/avatar/link/20e97fc97ec8454b925a17e5f1f0178c.jpg",n={postId:"",topicId:"",userId:"",userAvatar_url:s,userName:e.$scope.topicInfo.name,userType:"",editorId:"",parentId:"",rootParentId:"",message:"语音消息",permalink:"",lft:"",rgt:"",depth:"",viewsCount:"",voteScore:"",postsCount:"",position:"0",status:"",voteLog:null,createdAt:"",updatedAt:"",postTime:"刚刚",voteUpCount:"0",attachmentIsExist:"1",postAttachmentVoList:[{attachmentId:"",postId:"",thirdPartyId:null,url:t,type:"Audio",seconds:Math.ceil(.3*e.$scope.microCount),transcodingStatus:"0",transcodingProgress:""}],children:null};e.$scope.replyList?e.$scope.replyList.unshift(n):(e.$scope.replyList=[],e.$scope.replyList.unshift(n)),e.$scope.safeApply(),e.$scope.tab=1},e.$scope.isLocal=function(){},e.$scope.noSub=function(){e.$uiComponents.$toast.show("请输入内容")},e.$scope.reloadPage=function(){e.$uiComponents.$toast.show("正在请求"),e.$scope.networkStates="",gxb.controllers.learning.topicCtrl(e)}},e.inheritFromCtrl(e.learning.topicCtrl),e.registerDependency("gxb.controllers.learning.topicCtrl",["gxb.services.learning.learnSrv","record","$ionicPopup","$ionicModal","$ionicScrollDelegate"]),e.registerView("gxb.controllers.learning.topicCtrl","topic")}(gxb.controllers),function(e){e.learning.videoCtrl=function(e){var o=e.$stateParams.id,t=(e.$stateParams.url,e.$stateParams.chapterId),s=e.$stateParams.type,n=e.$pluginComponents.$accessToken.get();if(e.$scope.currentChaptet=t,e.$scope.goChapter=function(t){document.getElementsByClassName("video_container")[0].style.display="none",window.removeListener(),$("#videoPlayer").children().remove(),e.$learnSrv.getVideo(o,t,e.$pluginComponents.$accessToken.get()).then(function(t){e.$scope.videoObj=new e.$videoModel(gxb.utils.objectUtils.extend(t.data,{classId:o}));var n="<gxbvideo data='data'></gxbvideo>",i=e.$scope.$new();i.data=new e.$videoModel(gxb.utils.objectUtils.extend(t.data,{classId:o,routerType:s})),$("#videoPlayer").append(e.$compile(n)(i)[0]),e.$scope.safeApply()})},e.$courseSrv.chapters(o,n).then(function(o){var t,s=[];for(t in o.data)if(s[t]=new e.$chapterListModel(o.data[t]),s[t].itemList)for(var n=0;n<s[t].itemList.length;n++)if(s[t].itemList[n].chapterList){var i=[];for(z in s[t].itemList[n].chapterList)"Video"==s[t].itemList[n].chapterList[z].contentType&&i.push(s[t].itemList[n].chapterList[z]);s[t].itemList[n].chapterList=i}e.$scope.units1=s}),e.$scope.closeList=function(){document.getElementsByClassName("video_container")[0].style.display="none"},e.$scope.selectedRow=0,e.$scope.toggle=function(o){e.$scope.selectedRow==o?e.$scope.selectedRow=0:e.$scope.selectedRow=o},0==s)e.$scope.videoHtml="",e.$learnSrv.getVideo(o,t,e.$pluginComponents.$accessToken.get()).then(function(t){400==t.status&&e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}),e.$scope.videoObj=new e.$videoModel(gxb.utils.objectUtils.extend(t.data,{classId:o}));var n="<gxbvideo data='data'></gxbvideo>",i=e.$scope.$new();i.data=new e.$videoModel(gxb.utils.objectUtils.extend(t.data,{classId:o,routerType:s})),$("#videoPlayer").append(e.$compile(n)(i)[0]),e.$scope.safeApply()});else if(1==s){var i=e.$pluginComponents.$objectCache.getObject("videoObj"),c={chapterId:i.chapterId,chapterName:i.chapterName,classId:i.classId,routerType:1,localHost:{hostUrl:"file://"+i.localUrl},video:{file:"file://"+i.localUrl,title:i.chapterName}},a="<gxbvideo data='data'></gxbvideo>",r=e.$scope.$new();r.data=new e.$videoModel(c),$("#videoPlayer").append(e.$compile(a)(r)[0])}},e.inheritFromCtrl(e.learning.videoCtrl),e.registerDependency("gxb.controllers.learning.videoCtrl",["gxb.services.courses.courseSrv","gxb.services.learning.learnSrv","gxb.models.courses.chapterListModel","gxb.models.learning.videoModel","$compile","$ionicModal"]),e.registerView("gxb.controllers.learning.videoCtrl","video")}(gxb.controllers),function(e){e.learning.webcastCtrl=function(e){var o=e.$stateParams.id,t=e.$stateParams.chapterId,s=e.$stateParams.webcastId,n=e.$pluginComponents.$accessToken.get(),i=e.$pluginComponents.$objectCache.getObject("userObject");e.$scope.safeApply(function(){e.$scope.className=e.ClassName.getter()}),e.$scope.stage=1,e.$scope.transform=!1,e.$scope.passwordFocus=function(){e.$scope.safeApply(function(){e.$scope.transform=!e.$scope.transform})},e.$scope.passwordBlur=function(){e.$scope.safeApply(function(){e.$scope.transform=!e.$scope.transform})},e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?(e.$uiComponents.$history.goBack(),e.$rootScope.$emit("$changeState")):(e.$rootScope.$ionicGoBack(),e.$rootScope.$emit("$changeState"))},e.$scope.page={},e.$learnSrv.getWebcastDetail(o,s,n).then(function(o){if(o){e.$scope.liveInfo=o;var t=new Date(gxb.utils.dateUtils.date(new Date)).getTime(),s=new Date(gxb.utils.dateUtils.date(o.startAt)).getTime(),n=new Date(gxb.utils.dateUtils.date(o.endAt)).getTime();t>s&&t<n?e.$scope.stage=1:t<s?e.$scope.stage=0:t>n&&(e.$scope.stage=-1),e.$scope.safeApply()}},function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),e.$uiComponents.$loadding.hide()}),e.$learnSrv.getWebcastDoc(s,n).then(function(o){if(o){for(var t=[],s=0;s<o.length;s++)t[s]=new e.$materialModel(o[s]);e.$scope.materials=t,e.$scope.safeApply()}}),e.$scope.goWebCast=function(c){return e.$scope.liveInfo.password&&e.$scope.liveInfo.password!=e.$scope.liveInfo.stuPassword?void e.$uiComponents.$toast.show("请输入正确的直播间密码"):(e.$learnSrv.webcastStatus(o,t,n).then(function(e){}),void e.$learnSrv.getWebcastToken(o,s,n).then(function(t){for(var s,n=/(?:&|\?)\w{1,20}=[^&]+/g,a=t.url.match(n),r=0;r<a.length;r++)if(a[r].indexOf("token")>-1){var p=a[r].split("=");s=p[1];break}var l={roomId:c.liveId,userId:i.id,classId:o,username:i.name?i.name:i.userName,token:s,role:2,introduce:c.title||c.introduce,teacherName:c.teacherName,password:c.password};e.Lives.live(gxb.utils.jsonUtils.toString(l))}))},e.$scope.showEnclosure=function(t){var s,i=t.materialPath;if("Android"==e.$rootScope.platformType&&(i.indexOf(".pdf")>0||i.indexOf(".ppt")>0||i.indexOf(".pptx")>0))s=i.indexOf("doc.gaoxiaobang.com")>0?i:"https://doc.gaoxiaobang.com/view/url?url="+i,e.PassValue.setter(s),e.$state.go("preview_doc");else if(i.indexOf(".mp4")!=-1){var c={classId:o,className:t.title,promotionalVideo:t.filePath,promotionalVideoSrt:"",access_token:n};e.Play.playWeClass(c)}else i.indexOf(".pdf")>0||i.indexOf(".txt")>0||i.indexOf(".xls")>0||i.indexOf(".xlsx")>0||i.indexOf(".ppt")>0||i.indexOf(".pptx")>0||i.indexOf(".doc")>0||i.indexOf(".docx")>0?(s=i.indexOf("doc.gaoxiaobang.com")>0?i:"https://doc.gaoxiaobang.com/view/url?url="+i,window.open(s,"_blank")):i.indexOf(".jpg")>0||i.indexOf(".png")>0||i.indexOf(".gif")>0||i.indexOf(".bmp")>0||i.indexOf(".jpeg")>0?window.open(i,"_blank"):e.$uiComponents.$toast.show("该文件类型暂不支持预览")}},e.inheritFromCtrl(e.learning.webcastCtrl),e.registerDependency("gxb.controllers.learning.webcastCtrl",["gxb.services.learning.learnSrv","$sce","gxb.models.learning.pageModel","PassValue","Lives","gxb.models.learning.materialModel","ClassName","Play","PassValue"]),e.registerView("gxb.controllers.learning.webcastCtrl","webcast")}(gxb.controllers),function(e){e.courses.courseCreditCtrl=function(e){var o=e.$pluginComponents.$accessToken.get();e.$scope.tenantId=e.$pluginComponents.$tenantId.get(),e.$scope.accessToken=o;var t=!0,s="";e.$scope.networkStates="",e.$scope.searchIcon=!0,e.$scope.search={searchName:""},o&&e.$uiComponents.$loadding.show(),e.$scope.tab=0,e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.scrollHeight=function(){return"Android"==e.$rootScope.platformType?"77%":"75%"},e.$scope.courseIntro=function(o){e.$state.go("course_item",{reload:!0,id:o})};var n=function(){e.$ionicScrollDelegate.$getByHandle("creditScroll").resize()},i=function(){e.$ionicScrollDelegate.$getByHandle("creditScroll").scrollTo(0,0)};e.$scope.getAll=function(){e.$scope.tab=0,e.$scope.currentObj=f,C(),i()},e.$scope.getDoing=function(){e.$scope.tab=1,e.$scope.currentObj=b,C(),i()},e.$scope.getWill=function(){e.$scope.tab=2,e.$scope.currentObj=h,C(),i()},e.$scope.getEnd=function(){e.$scope.tab=3,e.$scope.currentObj=v,C(),i()};var c=function(o){document.addEventListener("deviceready",function(){for(var t in o)window.plugins.ImageCachePlugin.cache(o[t].image,t,function(t){var s=gxb.utils.jsonUtils.toObject(t);o[s.index].cache=s.cache,e.$scope.safeApply()})})},a=function(e,o,t){var s=[];if(10*e>o)for(var n=10*(e-1);n<o;n++)s.push(t[n]);else for(var n=10*(e-1);n<10*e;n++)s.push(t[n]);return s},r=function(e){return e.length},p=function(e){return Math.ceil(e.length/10)},l=function(e){var o;return o=e.length>10?a(1,e.length,e):e},$=function(e){return e.totalPage>=e.curPage?1:0},u=[],d=[],g=[],m=[];e.$scope.courseList=[],e.$scope.willStartList=[],e.$scope.isGoingList=[],e.$scope.hasEndList=[];var f={},h={},b={},v={};e.$scope.currentObj={item:u,curPage:1,totalPage:0,totalItems:0,btnIsShow:0};var C=function(){e.$scope.currentObj.curPage==e.$scope.currentObj.totalPage||0==e.$scope.currentObj.totalPage?e.$scope.currentObj.btnIsShow=0:e.$scope.currentObj.btnIsShow=1,e.$scope.safeApply()};e.$scope.show=!0,e.$scope.loadList=function(o,t,s){e.$courseSrv.loadList(o,t,s).then(function(o){e.$uiComponents.$loadding.hide();var t,s=[];if(o.data.pageList){e.$scope.show=!0;for(t in o.data.pageList){if(s[t]=new e.$cardModel(o.data.pageList[t]),s[t].image)var n=s[t].image.substring(0,s[t].image.lastIndexOf("."))+"_small"+s[t].image.substring(s[t].image.lastIndexOf("."));s[t].image=n,s[t].cache="./images/course_cover_def.png",u.push(s[t]),"1"==s[t].statusFlag?g.push(s[t]):"0"==s[t].statusFlag?m.push(s[t]):"2"==s[t].statusFlag&&d.push(s[t])}}else e.$scope.show=!1;f.item=u,f.curPage=1,f.totalPage=p(f.item),f.totalItems=r(f.item),f.btnIsShow=$(f),h.item=d,h.curPage=1,h.totalPage=p(h.item),h.totalItems=r(h.item),h.btnIsShow=$(h),b.item=g,b.curPage=1,b.totalPage=p(b.item),b.totalItems=r(b.item),b.btnIsShow=$(b),v.item=m,v.curPage=1,v.totalPage=p(v.item),v.totalItems=r(v.item),v.btnIsShow=$(v),e.$scope.currentObj.totalPage=f.totalPage,e.$scope.currentObj.curPage=f.curPage,e.$scope.currentObj.btnIsShow=f.btnIsShow,e.$scope.currentObj.totalItems=f.totalItems,C(),e.$scope.courseList=l(u),e.$scope.willStartList=l(d),e.$scope.isGoingList=l(g),e.$scope.hasEndList=l(m),c(e.$scope.courseList),c(e.$scope.willStartList),c(e.$scope.isGoingList),c(e.$scope.hasEndList),e.$scope.will=0,e.$scope.going=0,e.$scope.end=0,0==e.$scope.willStartList.length?e.$scope.will=1:e.$scope.will=0,0==e.$scope.isGoingList.length?e.$scope.going=1:e.$scope.going=0,0==e.$scope.hasEndList.length?e.$scope.ends=1:e.$scope.ends=0,e.$scope.safeApply()},function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),e.$uiComponents.$loadding.hide()})},0!=e.$scope.tenantId&&void 0!=e.$scope.tenantId&&null!=e.$scope.tenantId&&e.$scope.loadList(e.$scope.tenantId,1,s),e.$scope.loadMoreCourse=function(){if(0!=t&&(e.$scope.currentObj.curPage++,e.$scope.currentObj.curPage==e.$scope.currentObj.totalPage?e.$scope.currentObj.btnIsShow=0:e.$scope.currentObj.btnIsShow=1,e.$scope.currentObj.curPage<=e.$scope.currentObj.totalPage)){var o=a(e.$scope.currentObj.curPage,e.$scope.currentObj.totalItems,e.$scope.currentObj.item);if(e.$scope.currentObj.item==u){for(var s in o)e.$scope.courseList.push(o[s]);c(e.$scope.courseList)}else if(e.$scope.currentObj.item==d){for(var i in o)e.$scope.willStartList.push(o[i]);c(e.$scope.willStartList)}else if(e.$scope.currentObj.item==g){for(var r in o)e.$scope.isGoingList.push(o[r]);c(e.$scope.isGoingList)}else if(e.$scope.currentObj.item==m){for(var p in o)e.$scope.hasEndList.push(o[p]);c(e.$scope.hasEndList)}e.$scope.safeApply(),n(),t=!1}},e.$scope.scrollHandle1=function(){var o=e.$ionicScrollDelegate.$getByHandle("creditScroll"),s=o.getScrollView(),n=s.__maxScrollTop,i=o.getScrollPosition().top;e.$scope.currentObj.curPage<e.$scope.currentObj.totalPage&&i+45>=n&&(e.$scope.loadMoreCourse(),t=!0)},document.onkeydown=function(o){var t=o||window.event;13==t.keyCode&&(e.$scope.search.searchName?(s=e.$scope.search.searchName,u=[],d=[],g=[],m=[],e.$scope.loadList(e.$scope.tenantId,1,s),i(),cordova.plugins.Keyboard.close()):e.$uiComponents.$toast.show("请输入关键字"))},e.$scope.searchChange=function(o){""==o?(e.$scope.safeApply(function(){e.$scope.searchIcon=!0}),s="",e.$scope.loadList(e.$scope.tenantId,1,s)):e.$scope.safeApply(function(){e.$scope.searchIcon=!1})},e.$scope.reLoad=function(){e.$uiComponents.$toast.show("正在请求"),e.$scope.networkStates="",e.$scope.loadList(e.$scope.tenantId,1,s)},e.$scope.reloadPage=function(){e.$uiComponents.$toast.show("正在请求"),e.$scope.networkStates="",gxb.controllers.courses.courseCreditCtrl(e)}},e.inheritFromCtrl(e.courses.courseCreditCtrl),e.registerDependency("gxb.controllers.courses.courseCreditCtrl",["gxb.services.courses.courseSrv","gxb.models.courses.cardModel","$cordovaProgress","$timeout","gxb.models.users.jpushinitModel","gxb.services.users.loginSrv","gxb.services.profiles.profilesSrv","$ionicScrollDelegate"]),e.registerView("gxb.controllers.courses.courseCreditCtrl","course_credit")}(gxb.controllers),function(e){e.courses.courseCtrl=function(e){function o(o){a&&(a=!1,i+=1,e.$courseSrv.courseList(e.$scope.tenantId,i,c).then(function(t){if(t.data.pageList){for(var s=0;s<t.data.pageList.length;s++){var a=new e.$cardModel(t.data.pageList[s]);if(a.image)var p=a.image.substring(0,a.image.lastIndexOf("."))+"_small"+a.image.substring(a.image.lastIndexOf("."));a.image=p,a.cache="./images/course_cover_def.png",e.$scope.courseList.push(a)}r(e.$scope.courseList,(i-1)*c),e.$scope.safeApply(),n.resize(),o()}}))}var t=e.$pluginComponents.$accessToken.get();e.$scope.accessToken=t,e.$scope.annou={},e.$scope.showList=0,e.$scope.courseBanner={},e.$scope.tenantId=e.$pluginComponents.$tenantId.get(),e.$scope.userObj=e.$pluginComponents.$objectCache.getObject("userObject"),e.$scope.tips={},e.$scope.showTip=0;var s,n=e.$ionicScrollDelegate.$getByHandle("tabCourseScroll"),i=1,c=10,a=!1;t?(e.$uiComponents.$loadding.show(),"0"==e.$scope.userObj.bindingStatus||""==e.$scope.userObj.bindingStatus||null==e.$scope.userObj.bindingStatus?(e.$scope.safeApply(function(){e.$scope.showList=2}),e.$uiComponents.$loadding.hide()):e.$scope.safeApply(function(){e.$scope.showList=0})):e.$scope.safeApply(function(){e.$scope.showList=1,e.$uiComponents.$loadding.hide()}),void 0!=e.$rootScope.jPushRegisterId&&void 0!=e.$rootScope.uuids&&e.$loginSrv.jPushRegisterId({registrationId:e.$rootScope.jPushRegisterId,imei:e.$rootScope.uuids},t).then(function(e){}),e.$scope.goLogin=function(){e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})},e.$scope.getHeight=function(){return.44*document.body.clientWidth},e.$scope.bannerWith=document.body.clientWidth+"px",e.$scope.goValidate=function(){e.$state.go("settings_personal_addValidate",{type:3},{reload:!0})},e.$scope.goNotice=function(o){e.$state.go("course_schoolNotice",{reload:!0,noticeId:o})},e.$scope.getMore=function(){e.$state.go("course_credit",{reload:!0})},e.$scope.courseIntro=function(o){e.$state.go("course_item",{reload:!0,id:o.id})};var r=function(o,t){document.addEventListener("deviceready",function(){for(var s=t;s<o.length;s++)window.plugins.ImageCachePlugin.cache(o[s].image,s,function(t){var s=gxb.utils.jsonUtils.toObject(t);o[s.index].cache=s.cache,e.$scope.safeApply()})})};e.$scope.imgStr=["http://www.bz55.com/uploads/allimg/120621/1-1206211G120.jpg","http://www.bz55.com/uploads/allimg/121103/1-121103095423.jpg","http://pic1.win4000.com/wallpaper/0/53b520eceb910.jpg"],e.$scope.getCourseBanner=function(o){e.$courseSrv.getCourseBanner(o).then(function(t){if(400==t.status&&(o?(e.$uiComponents.$toast.show("登录状态已失效，请重新登录！"),e.$scope.goLogin()):e.$scope.showList=1),t.announcementList){var s=t.announcementList;s.push(t.announcementList[0]),e.$scope.announces=s,3==e.$scope.announces.length?e.$scope.safeApply(function(){e.$scope.announceClass="hasTwo"}):4==e.$scope.announces.length?e.$scope.safeApply(function(){e.$scope.announceClass="hasThree"}):e.$scope.safeApply(function(){e.$scope.announceClass=""})}if(t.banner){"none"==e.$scope.networkStates&&(e.$scope.networkStates="");for(var s=[],n=0;n<t.banner.length;n++){if(s[n]=t.banner[n],s[n].sourceImage=s[n].imageUrl,s[n].imageUrl)var i=s[n].imageUrl.substring(0,s[n].imageUrl.lastIndexOf("."))+"_790*350"+s[n].imageUrl.substring(s[n].imageUrl.lastIndexOf("."));s[n].imageUrl=i,s[n].cache="./images/slider_def.png"}e.$scope.courseBanner=s,e.$ionicSlideBoxDelegate.update(),setTimeout(function(){e.$ionicSlideBoxDelegate.$getByHandle("image-viewer").loop(!0)},1e3),e.$scope.safeApply(),document.addEventListener("deviceready",function(){for(var o in e.$scope.courseBanner)window.plugins.ImageCachePlugin.cache(e.$scope.courseBanner[o].imageUrl,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.courseBanner[t.index].cache=t.cache,e.$scope.safeApply()})})}},function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),e.$uiComponents.$loadding.hide()})},e.$scope.slideHasChanged=function(o){e.$ionicSlideBoxDelegate.$getByHandle("image-viewer").slide(o+1)},e.$scope.goLinks=function(o){var t=e.$scope.courseBanner[o].url;return""!=t&&null!=t&&void(t.indexOf("gaoxiaobang.com")>0&&window.open(t,"_blank"))},e.$courseSrv.getLiveInfo(t).then(function(o){"0"==o.status?(e.$scope.liveShow=1,e.$scope.liveInfo=new e.$liveModel(o.data),e.$scope.safeApply()):(e.$scope.liveShow=0,e.$scope.safeApply())}),e.$scope.goLive=function(o){if(1==o.canPlay){gxb.utils.ymStatisticsUtils.ymEvent("livingClick");var s={roomId:o.liveId,userId:e.$scope.userObj.id,classId:"0",username:e.$scope.userObj.name?e.$scope.userObj.name:e.$scope.userObj.userName,token:t,role:2,introduce:o.introduce,teacherName:o.teacherName};e.Lives.live(gxb.utils.jsonUtils.toString(s))}else 2==o.canPlay&&(e.$uiComponents.$toast.show("来早啦！开播时间："+o.startAt),gxb.utils.ymStatisticsUtils.ymEvent("willLiveClick"))},e.$courseSrv.courseList(e.$scope.tenantId,i,c).then(function(o){if(e.$uiComponents.$loadding.hide(),o.data.pageList){var t,n=[];s=o.data.totalPages;for(t in o.data.pageList){if(n[t]=new e.$cardModel(o.data.pageList[t]),n[t].image)var c=n[t].image.substring(0,n[t].image.lastIndexOf("."))+"_small"+n[t].image.substring(n[t].image.lastIndexOf("."));n[t].image=c,n[t].cache="./images/course_cover_def.png"}e.$scope.safeApply(function(){e.$scope.courseList=n,r(e.$scope.courseList,0)}),i<s&&(a=!0)}}),e.$scope.scrollHandle1=function(){var t=e.$ionicScrollDelegate.$getByHandle("tabCourseScroll"),n=t.getScrollView(),c=n.__maxScrollTop,r=t.getScrollPosition().top;r+45>=c&&i<s&&o(function(){a=!0})};var p=function(){e.$courseSrv.getTips().then(function(o){"0"==o.status&&(o.data?(e.$scope.tips=o.data,e.$scope.showTip=1,$.style.display="block",gxb.utils.ymStatisticsUtils.ymEvent("everydayTipShow"),window.localStorage.tipShow=gxb.utils.jsonUtils.toString({show:1,time:(new Date).getTime().toString()}),e.$scope.safeApply()):(e.$scope.showTip=0,e.$scope.safeApply(),$.style.display="none"))})},l=function(){if(window.localStorage.tipShow){var o=gxb.utils.jsonUtils.toObject(window.localStorage.tipShow),t=new Date(gxb.utils.dateUtils.date(new Date)),s=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),c=new Date(s+"/"+n+"/"+i+" 00:00").getTime(),a=new Date(parseInt(o.time)).getMonth()+1,r=new Date(parseInt(o.time)).getDate();1==o.show&&o.time>c&&a==n&&r==i?(e.$scope.showTip=0,e.$scope.safeApply(),$.style.display="none"):p()}else p()};e.$scope.closeTip=function(){e.$scope.showTip=0,$.style.display="none",e.$scope.safeApply()},e.$scope.goScan=function(){window.plugins.QRcodePlugin.scan("")};var $=document.getElementById("tabMask");e.$scope.courseGuide=0,e.$scope.courseAnimation=0,e.$scope.selectCourse=0,e.$courseSrv.getSelectCourseBtn(t).then(function(o){"0"==o.status?window.localStorage.courseGuide&&void 0!=window.localStorage.courseGuide||0!=e.$scope.showList?(e.$scope.safeApply(function(){e.$scope.selectCourse=1}),l()):($.style.display="block",$.style.background="rgba(45,49,56,.8)",window.localStorage.courseGuide="1",e.$scope.safeApply(function(){e.$scope.courseGuide=1,e.$scope.selectTime=o.data,e.$scope.selectTime.startAt=gxb.utils.dateUtils.days(o.data.startAt),e.$scope.selectTime.endAt=gxb.utils.dateUtils.days(o.data.endAt)})):(e.$scope.safeApply(function(){e.$scope.courseGuide=0}),l())}),e.$scope.courseGuideClose=function(){e.$scope.safeApply(function(){$.style.display="none",e.$scope.courseAnimation=1}),setTimeout(function(){e.$scope.safeApply(function(){e.$scope.courseGuide=0,e.$scope.selectCourse=1})},500)},e.$scope.goSelectCourse=function(){e.$state.go("course_select",{reload:!0})},e.$scope.showSelectCourse=function(){e.$state.go("course_select",{reload:!0})},window.scan=function(o){var s={classId:"0",className:o.videoName,promotionalVideo:o.url,promotionalVideoSrt:"",access_token:t};o&&("video"==o.type?e.Play.playWeClass(s):"quiz"==o.type?e.$state.go("course_quiz",{id:o.classId,quizId:o.quizId},{reload:!0}):"invitation"==o.type&&e.$state.go("addClass",{id:o.classId},{reload:!0}))},0!=e.$scope.tenantId&&void 0!=e.$scope.tenantId&&null!=e.$scope.tenantId&&e.$scope.getCourseBanner(t),e.$scope.reLoad=function(){e.$uiComponents.$toast.show("正在请求"),e.$scope.networkStates="",e.$scope.loadList(e.$scope.tenantId,1,0),e.$scope.getCourseBanner(t)},e.$scope.reloadPage=function(){e.$uiComponents.$toast.show("正在请求"),e.$scope.networkStates="",gxb.controllers.courses.courseCtrl(e)}},e.inheritFromCtrl(e.courses.courseCtrl),e.registerDependency("gxb.controllers.courses.courseCtrl",["$ionicPopup","Play","$ionicSlideBoxDelegate","gxb.services.courses.courseSrv","gxb.models.courses.cardModel","$cordovaProgress","$timeout","gxb.models.users.jpushinitModel","gxb.services.users.loginSrv","gxb.services.profiles.profilesSrv","$ionicActionSheet","$ionicScrollDelegate","gxb.models.courses.liveModel","Lives","gxb.services.users.loginSrv"]),e.registerView("gxb.controllers.courses.courseCtrl","tab_course")}(gxb.controllers),function(e){e.courses.courseExcellentCtrl=function(e){var o=e.$pluginComponents.$accessToken.get(),t=function(o){document.addEventListener("deviceready",function(){for(var t in o)window.plugins.ImageCachePlugin.cache(o[t].courseCover,t,function(t){var s=gxb.utils.jsonUtils.toObject(t);o[s.index].cache=s.cache,e.$scope.safeApply()})})};e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.courseIntro=function(o){e.$state.go("course_item",{reload:!0,id:o})},e.$scope.excellentList={},e.$courseSrv.getExcellent(1,o).then(function(o){var s=[];if(o.dataList){for(var n=0;n<o.dataList.length;n++){s[n]=new e.$excellentModel(o.dataList[n]);var i=s[n].courseCover.substring(0,s[n].courseCover.lastIndexOf("."))+"_small"+s[n].courseCover.substring(s[n].courseCover.lastIndexOf("."));s[n].courseCover=i,s[n].cache="./images/course_cover_def.png"}e.$scope.excellentList=s,t(e.$scope.excellentList),e.$scope.safeApply()}})},e.inheritFromCtrl(e.courses.courseExcellentCtrl),e.registerDependency("gxb.controllers.courses.courseExcellentCtrl",["gxb.services.courses.courseSrv","gxb.models.courses.excellentModel"]),e.registerView("gxb.controllers.courses.courseExcellentCtrl","course_excellent")}(gxb.controllers),function(e){e.courses.courseIntroduceCtrl=function(e){e.$uiComponents.$loadding.show(),e.$scope.hideImage=0,e.$scope.showNav=0,e.$scope.tab=0,e.$scope.state=!0;var o,t=e.$stateParams.id,s=e.$pluginComponents.$accessToken.get(),n=40;"Android"==e.$scope.platformType?n=60:"IOS"==e.$scope.platformType&&(n=40);var i=200;"Android"==e.$scope.platformType?i=220:"IOS"==e.$scope.platformType&&(i=200),e.$scope.scrollHandle=function(){var o=e.$ionicScrollDelegate.$getByHandle("scrollLayer").getScrollPosition();o.top>n?e.$scope.safeApply(function(){e.$scope.hideImage=1}):o.top<n&&e.$scope.safeApply(function(){e.$scope.hideImage=0}),o.top>i?e.$scope.safeApply(function(){e.$scope.showNav=1}):o.top<i&&e.$scope.safeApply(function(){e.$scope.showNav=0})},e.$scope.introduceStyle="img-box","Android"==e.$rootScope.platformType?e.$scope.introduceStyle="img-box":e.$scope.introduceStyle="img-boxes";var c=function(){e.$ionicScrollDelegate.$getByHandle("scrollLayer").resize()},a=function(){e.$ionicScrollDelegate.$getByHandle("scrollLayer").scrollTo(0,i)};e.$scope.tab=0,e.$scope.showIntro=function(){1==e.$scope.showNav&&a(),e.$scope.tab=0,c()},e.$scope.showChapter=function(){1==e.$scope.showNav&&a(),e.$scope.tab=2,c()},e.$scope.goBacks=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},1==e.$stateParams.jump&&e.$loginSrv.UpdateMessageId(s,e.$rootScope.messageId).then(function(e){}),e.$courseSrv.courseIntro(t,s).then(function(n){e.$uiComponents.$loadding.hide(),o=n.data.courseId,e.$scope.$courseIntro=new e.$introModel(n.data),document.addEventListener("deviceready",function(){window.plugins.ImageCachePlugin.cache(e.$scope.$courseIntro.classSmallCover,0,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.$courseIntro.cache=t.cache,e.$scope.safeApply(),window.plugins.ImageCachePlugin.cache(e.$scope.$courseIntro.classCover,0,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.$courseIntro.cache=t.cache,e.$scope.safeApply()})})}),e.$scope.showEcharts=function(){1==e.$scope.showNav&&a(),e.$scope.tab=1,c(),e.$scope.echarts_classId="echarts_"+t,e.$courseSrv.assessmentSrv(t,s).then(function(o){if(400==o.status)e.$scope.state=!1;else{e.$scope.assessmentData=o.data;var t=echarts.init(document.getElementById(e.$scope.echarts_classId)),s={color:["#FF6571","#FBBF58","#67C2EF","#BDEA74","#E1E3E6"],tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:["视频","作业","讨论","测验","考试"]},series:[{name:"访问来源",type:"pie",radius:["60%","80%"],avoidLabelOverlap:!1,label:{normal:{show:!1,position:"center"},emphasis:{show:!0,textStyle:{fontSize:"12",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:335,name:"视频"},{value:310,name:"作业"},{value:234,name:"讨论"},{value:135,name:"测验"},{value:1548,name:"考试"}]}]};s.series[0].data[0].value=e.$scope.assessmentData.videoPercent,s.series[0].data[1].value=e.$scope.assessmentData.assignmentPercent,s.series[0].data[2].value=e.$scope.assessmentData.topicPercent,s.series[0].data[3].value=e.$scope.assessmentData.quizPercent,s.series[0].data[4].value=e.$scope.assessmentData.examPercent,t.setOption(s),e.$scope.safeApply()}})},e.$scope.showEcharts(),e.$scope.study=e.$scope.$courseIntro.canStudy,e.$scope.validateType=e.$scope.$courseIntro.validateType;var i=new Date,r=new Date(gxb.utils.dateUtils.date(e.$scope.$courseIntro.startAt)),p=new Date(gxb.utils.dateUtils.date(e.$scope.$courseIntro.concludeAt));r-i>0?e.$scope.learnBtn={text:"未开课","class":"unenable",status:"0"}:i-r>0&&i-p<0?e.$scope.$courseIntro.studyStatus>0?e.$scope.learnBtn={text:"继续学习","class":"learn-btn",status:"1"}:e.$scope.learnBtn={text:"开始学习","class":"learn-btn",status:"1"}:e.$scope.learnBtn={text:"已结课","class":"unenable",status:"0"},e.$scope.safeApply()},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}),e.$courseSrv.chapters(t,s).then(function(o){for(var t=[],s=0;s<o.data.length;s++){var n=new e.$chapterListModel(o.data[s]);t.push(n)}e.$scope.$list=t}),e.$scope.courseInfo=e.$pluginComponents.$objectCache.getObject("userObject"),e.$scope.startLearn=function(o){if(0==e.$scope.state)e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()});else{if("0"==e.$scope.learnBtn.status)return;if(e.$pluginComponents.$accessToken.get()){if(e.$scope.$courseIntro.studyStatus>0)e.$state.go("courses_detail",{id:o});else if("10"==e.$scope.validateType)e.$scope.showBox="block",e.$scope.confirmStudy=function(){e.$scope.learnBtn.text="继续学习",e.$courseSrv.beginLearn(t,s).then(function(e){}),e.$state.go("course_preReading",{
id:o})};else if("20"==e.$scope.validateType)if("1"==e.$scope.courseInfo.bindingStatus)e.$scope.showBox="block",e.$scope.confirmStudy=function(){e.$scope.learnBtn.text="继续学习",e.$courseSrv.beginLearn(t,s).then(function(e){}),e.$state.go("course_preReading",{id:o})};else{e.$ionicPopup.alert({title:"本课程只对已认证的本校授权学生开放，请先前往个人中心认证",buttons:[{text:"取消"},{text:"<b>去认证</b>",type:"button-positive",onTap:function(t){e.$state.go("settings_personal_addValidate_school",{schoolName:e.$pluginComponents.$tenantName.get(),tenantId:e.$pluginComponents.$tenantId.get(),study:e.$scope.$courseIntro.canStudy,id:o,type:1},{reload:!0})}}]})}else if("30"==e.$scope.validateType)if("1"==e.$scope.courseInfo.bindingStatus)if("1"==e.$scope.study)e.$scope.showBox="block",e.$scope.confirmStudy=function(){e.$scope.learnBtn.text="继续学习",e.$courseSrv.beginLearn(t,s).then(function(e){}),e.$state.go("course_preReading",{id:o})};else{e.$ionicPopup.alert({title:"本课程只对已认证的本校授权学生开放，您尚未授权本课，请选择其他精彩课程进行学习",buttons:[{text:"<b>知道了</b>",type:"button-positive",onTap:function(t){e.$state.go("course_item",{id:o})}}]})}else{e.$ionicPopup.alert({title:"本课程只对已认证的本校授权学生开放，请先前往个人中心认证",buttons:[{text:"取消"},{text:"<b>去认证</b>",type:"button-positive",onTap:function(o){e.$state.go("settings_personal_addValidate_school",{schoolName:e.$pluginComponents.$tenantName.get(),tenantId:e.$pluginComponents.$tenantId.get(),study:e.$scope.$courseIntro.canStudy,id:t,type:1},{reload:!0})}}]})}}else e.$state.go("user_login_no",{tenantId:e.$pluginComponents.$tenantId.get()})}},e.$scope.showBox="none",e.$scope.hideBox=function(){e.$scope.showBox="none"}},e.inheritFromCtrl(e.courses.courseIntroduceCtrl),e.registerDependency("gxb.controllers.courses.courseIntroduceCtrl",["gxb.models.courses.cardModel","$ionicPopup","$ionicScrollDelegate","$timeout","gxb.services.courses.courseSrv","gxb.models.courses.introModel","gxb.models.courses.chapterListModel","gxb.models.courses.commentModel","gxb.services.users.loginSrv","gxb.services.profiles.profilesSrv"]),e.registerView("gxb.controllers.courses.courseIntroduceCtrl","course_introduce")}(gxb.controllers),function(e){e.courses.guideCtrl=function(e){e.$scope.currentIndex=1,e.$scope.$on("$ionicSlides.slideChangeEnd",function(e,o){}),e.$scope.slideHasChanged=function(o){e.$scope.currentIndex=o+1},e.$scope.goCourse=function(){window.localStorage.installed="installed",e.$state.go("home.course",{reload:!0})}},e.inheritFromCtrl(e.courses.guideCtrl),e.registerDependency("gxb.controllers.courses.guideCtrl",[]),e.registerView("gxb.controllers.courses.guideCtrl","guide")}(gxb.controllers),function(e){e.courses.outerLinkCtrl=function(e){e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.hrefSrc=e.PassValue.getter(),e.$scope.safeApply(),e.$scope.share=function(){var o={title:"学习资料",url:e.$scope.hrefSrc,text:"高校邦"};window.plugins.SharePlugin.share(o)}},e.inheritFromCtrl(e.courses.outerLinkCtrl),e.registerDependency("gxb.controllers.courses.outerLinkCtrl",["PassValue"]),e.registerView("gxb.controllers.courses.outerLinkCtrl","outer_link")}(gxb.controllers),function(e){e.courses.schoolNoticeCtrl=function(e){var o=e.$pluginComponents.$accessToken.get(),t=e.$stateParams.noticeId;e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.announce={},e.$courseSrv.getCourseBanner(o).then(function(o){if(o.announcementList){for(var s in o.announcementList)o.announcementList[s].id==t&&(e.$scope.announce=new e.$noticeModel(o.announcementList[s]),e.$scope.announce.desc=e.$sce.trustAsHtml(e.$scope.announce.desc),e.$scope.announce.updatedAt=gxb.utils.dateUtils.time(o.announcement.updatedAt));e.$scope.safeApply(),$("a[hrefs]").on("click",function(){var o=$(this).attr("hrefs"),t=o;"Android"==e.$rootScope.platformType&&(o.indexOf(".pdf")>0||o.indexOf(".ppt")>0||o.indexOf(".pptx")>0)?(t=o.indexOf("doc.gaoxiaobang.com")>0?o:"https://doc.gaoxiaobang.com/view/url?url="+o,e.PassValue.setter(t),e.$state.go("preview_doc")):(t=o.indexOf(".pdf")>0||o.indexOf(".txt")>0||o.indexOf(".xls")>0||o.indexOf(".xlsx")>0||o.indexOf(".ppt")>0||o.indexOf(".pptx")>0||o.indexOf(".doc")>0||o.indexOf(".docx")>0?o.indexOf("doc.gaoxiaobang.com")>0?o+"?type=noShare":"https://doc.gaoxiaobang.com/view/url?url="+o+"&type=noShare":o.indexOf("?")>0?o+"&type=noShare":o+"?type=noShare",window.open(t,"_blank"))})}})},e.inheritFromCtrl(e.courses.schoolNoticeCtrl),e.registerDependency("gxb.controllers.courses.schoolNoticeCtrl",["$sce","gxb.services.courses.courseSrv","gxb.models.courses.noticeModel","PassValue"]),e.registerView("gxb.controllers.courses.schoolNoticeCtrl","school_notice")}(gxb.controllers),function(e){e.courses.searchCourseCtrl=function(e){e.$scope.tenantId=e.$pluginComponents.$tenantId.get();var o=[];e.$scope.courseList=[];var t=e.$pluginComponents.$history.get();t?e.$scope.searchList=t.split(","):e.$scope.searchList=[];var s=e.$scope.searchList;e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.blur=0,e.$scope.showBlur=function(){e.$scope.blur=1},e.$scope.goSearchs=function(){e.$scope.blur=0},e.$scope.hideNoCourse=function(){e.$scope.tab=0},e.$scope.tab=0,e.$scope.goSearch=function(t){e.$uiComponents.$loadding.show();var n=t;if(!t)return e.$scope.tab=0,e.$uiComponents.$loadding.hide(),void e.$uiComponents.$toast.show("请输入关键字");for(var i=0;i<s.length;i++)t==s[i]&&s.splice(i,1);s.splice(0,0,t),e.$pluginComponents.$history.set(s),o=[],e.$courseSrv.loadList(e.$scope.tenantId,1,n).then(function(t){e.$uiComponents.$loadding.hide();var s,n=[];if(null==t.data.pageList)e.$scope.tab=1;else if(t.data.pageList.length>0){e.$scope.tab=2;for(s in t.data.pageList){if(n[s]=new e.$cardModel(t.data.pageList[s]),n[s].image)var i=n[s].image.substring(0,n[s].image.lastIndexOf("."))+"_small"+n[s].image.substring(n[s].image.lastIndexOf("."));n[s].image=i,n[s].cache="./images/course_cover_def.png",o.push(n[s])}}e.$scope.courseList=o,e.$scope.safeApply()},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},e.$scope.emptyMessage=function(){e.$scope.searchList=[],s=[],e.$pluginComponents.$history.set(s),e.$scope.tab=3},e.$scope.goIntro=function(o){e.$state.go("course_item",{reload:!0,id:o})}},e.inheritFromCtrl(e.courses.searchCourseCtrl),e.registerDependency("gxb.controllers.courses.searchCourseCtrl",["gxb.services.courses.courseSrv","gxb.models.courses.cardModel"]),e.registerView("gxb.controllers.courses.searchCourseCtrl","search_course")}(gxb.controllers),function(e){e.courses.selectCourseCtrl=function(e){var o=e.$pluginComponents.$accessToken.get();e.$scope.goTome=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$courseSrv.getSelectCourseBtn(o).then(function(o){o.data&&(e.$scope.selectCourse=o.data,e.$scope.selectCourse.startAt=gxb.utils.dateUtils.time(o.data.startAt),e.$scope.selectCourse.endAt=gxb.utils.dateUtils.time(o.data.endAt),e.$scope.safeApply())})},e.inheritFromCtrl(e.courses.selectCourseCtrl),e.registerDependency("gxb.controllers.courses.selectCourseCtrl",["gxb.services.courses.courseSrv"]),e.registerView("gxb.controllers.courses.selectCourseCtrl","course_select")}(gxb.controllers),function(e){e.courses.startUpCtrl=function(e){e.$pluginComponents.$accessToken.get();e.$scope.show=1;var o=new Date,t=(o.getDate(),o.getMonth()+1,o.getFullYear(),function(){e.$ionicHistory.nextViewOptions({disableBack:!0,historyRoot:!0,disableAnimate:!0}),e.$state.go("home.course",{reload:!0})});e.$scope.second=3;var s=e.$interval(function(){e.$scope.second--,1==e.$scope.second&&(e.$interval.cancel(s),t())},1e3,3);e.$scope.jump=function(){e.$interval.cancel(s),t()}},e.inheritFromCtrl(e.courses.startUpCtrl),e.registerDependency("gxb.controllers.courses.startUpCtrl",["$ionicHistory","$interval","gxb.services.courses.courseSrv"]),e.registerView("gxb.controllers.courses.startUpCtrl","startup")}(gxb.controllers),function(e){e.founds.foundCtrl=function(e){e.$uiComponents.$loadding.show(),e.$scope.showCategory=0;var o=e.$pluginComponents.$accessToken.get(),t=e.$pluginComponents.$objectCache.getObject("userObject");gxb.utils.userLogUtils.sendEnterMiniClassEvent($.extend({},e.$scope.mdParams)),e.$scope.getHeight=function(){return.9*document.body.clientWidth*(322/670)};var s=.44*document.body.clientWidth+360;"Android"==e.$scope.platformType?s=.44*document.body.clientWidth+380:"IOS"==e.$scope.platformType&&(s=.44*document.body.clientWidth+360);var n=function(){e.$foundSrv.getMicroClass().then(function(o){if(e.$uiComponents.$loadding.hide(),o.length){e.$scope.applied=o;for(var t=[],s=0;s<o.length;s++)if(o[1].childList){t=[];for(var n=0;n<o[1].childList.length;n++)t[n]=o[1].childList[n],t[n].cache="./images/course_cover_def.png",t[n].sourceImage=t[n].imageUrl}e.$scope.safeApply(function(){e.$scope.feature=t}),window.localStorage.setItem("foundAt",c(new Date)),window.localStorage.setItem("foundAd",gxb.utils.jsonUtils.toString(t)),document.addEventListener("deviceready",function(){for(var o in e.$scope.feature)window.plugins.ImageCachePlugin.cache(e.$scope.feature[o].imageUrl,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.feature[t.index].cache=t.cache,e.$scope.safeApply()})})}},function(){e.$uiComponents.$loadding.hide(),e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},i=function(){e.$foundSrv.discoveryBanner().then(function(o){if(e.$uiComponents.$loadding.hide(),o.banner){for(var t=[],s=0;s<o.banner.length;s++){if(t[s]=o.banner[s],t[s].sourceImage=t[s].imageUrl,t[s].imageUrl)var n=t[s].imageUrl.substring(0,t[s].imageUrl.lastIndexOf("."))+"_790*350"+t[s].imageUrl.substring(t[s].imageUrl.lastIndexOf("."));t[s].imageUrl=n,t[s].cache="./images/slider_def.png"}e.$scope.safeApply(function(){e.$scope.discovery=t,e.$ionicSlideBoxDelegate.$getByHandle("imageviewer").update(),e.$ionicSlideBoxDelegate.$getByHandle("imageviewer").loop(!0)}),window.localStorage.setItem("foundBanner",gxb.utils.jsonUtils.toString(t)),document.addEventListener("deviceready",function(){for(var o in e.$scope.discovery)window.plugins.ImageCachePlugin.cache(e.$scope.discovery[o].imageUrl,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.discovery[t.index].cache=t.cache,e.$scope.safeApply()})})}},function(){e.$uiComponents.$loadding.hide(),e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},c=function(e){var o=e.getFullYear(),t=e.getMonth()+1,s=e.getDate();return o+"-"+t+"-"+s},a=c(new Date);console.log(a);var r=window.localStorage.getItem("foundAt");if(r==a){var p=window.localStorage.getItem("foundBanner")||null,l=window.localStorage.getItem("foundAd")||null;p&&l?(e.$scope.discovery=gxb.utils.jsonUtils.toObject(p),e.$scope.feature=gxb.utils.jsonUtils.toObject(l),e.$scope.safeApply(),e.$uiComponents.$loadding.hide(),document.addEventListener("deviceready",function(){for(var o in e.$scope.discovery)window.plugins.ImageCachePlugin.cache(e.$scope.discovery[o].imageUrl,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.discovery[t.index].cache=t.cache,e.$scope.safeApply()});for(var o in e.$scope.feature)window.plugins.ImageCachePlugin.cache(e.$scope.feature[o].imageUrl,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.feature[t.index].cache=t.cache,e.$scope.safeApply()})})):(n(),i())}else n(),i();e.$scope.goActivity=function(s,n,i){gxb.utils.userLogUtils.sendAdEvent($.extend({adType:2,categoryId:n,categoryUrl:s},e.$scope.mdParams)),gxb.utils.ymStatisticsUtils.ymEventWithParameter("activityClick",{categoryId:n,index:i+1});var c;if(c=s.indexOf("http://")!=-1||s.indexOf("https://")!=-1?s:"http://"+s,o){var a="mobile="+t.mobile+"&email="+t.email+"&name="+t.name+"&token="+o+"&openId="+t.gxbOpenId;c=c.indexOf("?")==-1?c+"?"+a:c+"&"+a}window.open(c,"_blank")},e.$scope.goLink=function(s,n){gxb.utils.userLogUtils.sendMiniClassBannerEvent($.extend({bannerID:n.id,description:n.title},e.$scope.mdParams)),gxb.utils.ymStatisticsUtils.ymEventWithParameter("bannerClick",{bannerId:n.id,index:s+1});var i=e.$scope.discovery[s].url;if(""==i||null==i)return!1;if(i.indexOf("gaoxiaobang.com")==-1){if(o){var c="mobile="+t.mobile+"&email="+t.email+"&name="+t.name+"&token="+o+"&openid="+t.gxbOpenId;i=i.indexOf("?")==-1?i+"?"+c:i+"&"+c}window.open(i,"_blank")}},e.$scope.goTradeTest=function(){24==e.$pluginComponents.$objectCache.getObject("choiceObj").length?e.$state.go("test_result",{reload:!0}):e.$state.go("trade_test",{reload:!0})},e.$scope.reloadPage=function(){e.$uiComponents.$toast.show("正在请求"),e.$scope.networkStates="",gxb.controllers.founds.foundCtrl(e)},gxb.utils.ymStatisticsUtils.ymEvent("TimeOfFoundShow")},e.inheritFromCtrl(e.founds.foundCtrl),e.registerDependency("gxb.controllers.founds.foundCtrl",["$ionicScrollDelegate","$ionicSlideBoxDelegate","gxb.services.founds.foundSrv","gxb.models.founds.foundModel"]),e.registerView("gxb.controllers.founds.foundCtrl","tab_found")}(gxb.controllers),function(e){e.founds.testResultCtrl=function(e){var o=e.$pluginComponents.$objectCache.getObject("choiceObj");e.$scope.userObj=e.$pluginComponents.$objectCache.getObject("userObject");var t=e.$scope.userObj.name;console.log(t),/^1[34578]\d{9}$/.test(t)?e.$scope.userObject={name:t.substring(0,3)+"****"+t.substring(7,11)}:e.$scope.userObject={name:t},e.$scope.a=0,e.$scope.b=0,e.$scope.c=0;var s;e.$scope.goBack=function(){e.$state.go("home.found",{reload:!0})};for(var n=0;n<o.length;n++)"A"==o[n]?e.$scope.a++:"B"==o[n]?e.$scope.b++:"C"==o[n]&&e.$scope.c++;e.$scope.a>e.$scope.b&&e.$scope.a>e.$scope.c&&e.$scope.b!=e.$scope.c?s="1":e.$scope.b>e.$scope.a&&e.$scope.b>e.$scope.c&&e.$scope.a!=e.$scope.c?s="2":e.$scope.c>e.$scope.a&&e.$scope.c>e.$scope.b&&e.$scope.a!=e.$scope.b?s="3":e.$scope.a==e.$scope.b&&e.$scope.b==e.$scope.c?s="4":e.$scope.a==e.$scope.b&&e.$scope.a!=e.$scope.c?s="5":e.$scope.a==e.$scope.c&&e.$scope.a!=e.$scope.c?s="6":e.$scope.b==e.$scope.c&&e.$scope.b!=e.$scope.a&&(s="7"),e.$scope.getAgain=function(){e.$state.go("trade_topic",{reload:!0})},e.$scope.getShare=function(){var o=e.$scope.userObj.name||"TA";/^1[34578]\d{9}$/.test(o)&&(o=o.substring(0,3)+"****"+o.substring(7,11));var t={title:"原来最适合"+o+"的是这个职业！",url:encodeURI("https://resource.gaoxiaobang.com/职业测试分享页/tradeResult.html?name="+o+"&status="+s),text:"快来测测你的结果是什么~",type:"careerTest"};window.plugins.SharePlugin.share(t)},e.$scope.goFound=function(){e.$state.go("home.found",{reload:!0})}},e.inheritFromCtrl(e.founds.testResultCtrl),e.registerDependency("gxb.controllers.founds.testResultCtrl",[]),e.registerView("gxb.controllers.founds.testResultCtrl","test_result")}(gxb.controllers),function(e){e.founds.tradeTestCtrl=function(e){e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.goTest=function(){gxb.utils.ymStatisticsUtils.ymEvent("careerTestClick"),e.$state.go("trade_topic",{reload:!0})}},e.inheritFromCtrl(e.founds.tradeTestCtrl),e.registerDependency("gxb.controllers.founds.tradeTestCtrl",[]),e.registerView("gxb.controllers.founds.tradeTestCtrl","trade_test")}(gxb.controllers),function(e){e.founds.tradeTopicCtrl=function(e){e.$scope.currentIndex=1;var o=["-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1"];e.$scope.stylechoice=["-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1","-1"],e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.processWidth=function(){var o=100/24,t=e.$scope.currentIndex*o+"%";return t},e.$scope.data=[{question:"1、\t一个聚会，有很多人在，这时你能勇敢地表达自己的意见吗？",answer:[{text:"小Cass",type:"A"},{text:"做不到",type:"B"},{text:"这要看情况",type:"C"}]},{question:"2、\t聚会主人邀请你在台上演讲，你会？",answer:[{text:"淡定面对",type:"A"},{text:"惊慌逃离",type:"C"},{text:"看当时的情况而定",type:"B"}]},{question:"3、\t和你一起参加聚会的朋友都很胆大，你认为他会害怕在聚光灯下说唱吗？",answer:[{text:"必须不会，正合他意",type:"B"},{text:"肯定害怕，他只在熟人面前放得开",type:"C"},{text:"不知道，看对方情绪而定",type:"A"}]},{question:"4、\t聚会上将播放小视频，你会选择看下列哪一种呢？",answer:[{text:"有人唱歌的小视频，类似唱歌节目的那种",type:"B"},{text:"有剧情的，类似电视连续剧的那种",type:"C"},{text:"有悬疑色彩的，需要动脑的那种",type:"A"}]},{question:"5、\t身边的人突然问你最喜欢哪类电视剧，你会怎么回答？",answer:[{text:"励志类——《dream high》",type:"C"},{text:"言情类——《微微一笑很倾城》",type:"B"},{text:"宫斗类——《甄嬛传》",type:"A"}]},{question:"6、\t他（她）对小说改编电视剧表示很鄙视，对此你表示？",answer:[{text:"不赞同，改编能让更多的作品被了解",type:"B"},{text:"赞同，原著永远是经典",type:"A"},{text:"凑合吧，没啥感觉",type:"C"}]},{question:"7、\t聚会主人的小女儿和你玩的很开心，说要为你画朵花，你希望是？",answer:[{text:"玫瑰",type:"B"},{text:"牡丹",type:"A"},{text:"荷花",type:"C"}]},{question:"8、\t聚会的主人居然是魔法师，看见自己女儿很喜欢你，于是施魔法，让你变成了一种动物，为期一个月，你希望是？",answer:[{text:"汪星人",type:"c"},{text:"喵星人",type:"B"},{text:"不是很懂你们人类世界的鸟星人",type:"A"}]},{question:"9、 一天，你发现魔法师的一个小盒子，盒子上写了你的名字，并说是你最害怕的爬行动物，盒子里面是？",answer:[{text:"蛇",type:"A"},{text:"蜈蚣",type:"B"},{text:"毛毛虫",type:"C"}]},{question:"10、 终于，你变回了自己，这时魔法师过来和你交谈，面对不顾你意愿将你变成动物的他，你会？",answer:[{text:"淡定的应对，毕竟这段经历很难得",type:"B"},{text:"不理他，谁让他没经过你同意就把你变成动物",type:"A"},{text:"看情况而定，毕竟不可能永远讨厌一个人",type:"C"}]},{question:"11、 变回人类的你，第一时间需要谁来安抚你这段时间的经历？",answer:[{text:"家人",type:"C"},{text:"恋人",type:"B"},{text:"朋友",type:"A"}]},{question:"12、回家路上，有陌生人向你搭讪，你会？",answer:[{text:"低头离开，因为害怕和陌生人交流",type:"B"},{text:"大方交谈，并不排斥和陌生人相识",type:"A"},{text:"视情况而定，毕竟刚刚才被坑过一次",type:"C"}]},{question:"13、没想到陌生人也是魔法师，他是聚会主人的哥哥，为了弥补弟弟的荒诞行为，他给你一次重新选择自己性别的机会，你会选择成为？",answer:[{text:"男子汉",type:"C"},{text:"软妹子",type:"B"},{text:"两者皆可",type:"A"}]},{question:"14、得知你原谅他弟弟的所作所为后，他竟然哭了起来，你认为他懦弱吗？",answer:[{text:"认为，大男人哭什么",type:"C"},{text:"不认为，男人也有情绪",type:"B"},{text:"看情况，毕竟不懂他为毛哭",type:"A"}]},{question:"15、魔法师哥哥离开前，向你道歉，并说他平时不轻易在人前流泪。你认为男人通常会在谁面前流泪呢？",answer:[{text:"爱人——枕边人 哭哭不丢人",type:"B"},{text:"家人——最坚实的靠山，不丢人",type:"C"},{text:"独自一人——不能让别人看到",type:"A"}]},{question:"16、临走时，你发现他的侧脸特别像你喜欢的一个人物，你认为会是？",answer:[{text:"孙中山",type:"B"},{text:"爱因斯坦",type:"A"},{text:"歌德",type:"C"}]},{question:"17、送走魔法师哥哥，你认为像他这种神奇的人随处可见吗？",answer:[{text:"是的，都烂大街了，每个人都很神奇",type:"B"},{text:"不是，怎么可能随随便便遇得到",type:"C"},{text:"不一定，看个人机缘",type:"A"}]},{question:"18、回家的路上你走过海边，看到了停靠在港口的船，你会联想到？",answer:[{text:"海外的旅行",type:"B"},{text:"和他人的分别",type:"C"},{text:"商人的贸易",type:"A"}]},{question:"19、这是一条你回家的必经之路，如果有机会，你会盯着客船一直看吗？",answer:[{text:"会，不要问我为什么",type:"C"},{text:"不会，看一会儿就够了",type:"A"},{text:"偶尔，视心情而定",type:"B"}]},{question:"20、除了海面，你认为湖上会出现船只吗？",answer:[{text:"会，因为要抓水怪",type:"C"},{text:"不会，船没必要去湖里",type:"A"},{text:"看情况，谁知道是什么湖呀",type:"B"}]},{question:"21、这时，你遇到了饭后出来散步的家人，平时饭后你们都会一起散步吗？",answer:[{text:"会的，那是一段美好的回忆",type:"B"},{text:"不会，因为懒得动",type:"A"},{text:"偶尔，看家里人拉不拉得动我",type:"C"}]},{question:"22、看到家人身体健康你就放心了，你认为这该归功于散步吗？",answer:[{text:"该",type:"C"},{text:"不该",type:"B"},{text:"不确定",type:"A"}]},{question:"23、这时一直在找你的朋友也出现了，他说你不在的这一个月，社团都翻天了。你是否参加过很多社团呢？",answer:[{text:"是，很有趣",type:"C"},{text:"否，太麻烦",type:"B"},{text:"只有一两个",type:"A"}]},{question:"24、看到满满的社团项目表，你的反应是？",answer:[{text:"肯定参加，毕竟是喜欢的社团",type:"C"},{text:"不参加，好麻烦的感觉",type:"A"},{text:"偶尔参加，看情况而定",type:"B"}]}],e.$scope.doAnswer=function(t,s){e.$scope.safeApply(function(){o[e.$scope.currentIndex-1]=t,e.$scope.stylechoice[e.$scope.currentIndex-1]=s,setTimeout(function(){e.$ionicSlideBoxDelegate.next()},300)})},e.$scope.slideChange=function(o){e.$scope.currentIndex=o+1},e.$scope.getSubmit=function(){gxb.utils.ymStatisticsUtils.ymEvent("careerTestFinished");for(var t=0,s=0;s<o.length;s++)o[s].indexOf("-1")!=-1&&t++;if(0!=t){e.$ionicPopup.alert({title:"提示",template:'<p style="text-align: center;">完成所有题目才能提交。</p>',buttons:[{text:"<b>我知道了</b>",type:"button-positive"}]});return!1}e.$state.go("test_result",{reload:!0}),e.$pluginComponents.$objectCache.setObject("choiceObj",o)}},e.inheritFromCtrl(e.founds.tradeTopicCtrl),e.registerDependency("gxb.controllers.founds.tradeTopicCtrl",["$ionicSlideBoxDelegate","$ionicPopup"]),e.registerView("gxb.controllers.founds.tradeTopicCtrl","trade_topic")}(gxb.controllers),function(e){e.layout.tabCtrl=function(e){e.$rootScope.unReadMsg=0,e.$pluginComponents.$accessToken.get()?(e.$profilesSrv.unReadMessage(e.$pluginComponents.$accessToken.get()).then(function(o){"0"==o.status?(e.$rootScope.unReadMsg=o.data,0==o.data&&(e.$rootScope.unReadMsg=0)):e.$rootScope.unReadMsg=0},function(){e.$rootScope.unReadMsg=0}),e.$scope.safeApply()):(e.$rootScope.unReadMsg=0,e.$scope.safeApply())},e.inheritFromCtrl(e.layout.tabCtrl),e.registerDependency("gxb.controllers.layout.tabCtrl",["gxb.services.profiles.profilesSrv","gxb.services.schools.schoolSrv"]),e.registerView("gxb.controllers.layout.tabCtrl","tabs")}(gxb.controllers),function(e){e.schools.schoolCtrl=function(e){e.$scope.schoolStyle="school_wrap","Android"==e.$rootScope.platformType?e.$scope.schoolStyle="school_wrap":e.$scope.schoolStyle="school_wraps",e.$scope.goBack=function(){"Android"==e.$rootScope.platformType?e.$uiComponents.$history.goBack():e.$rootScope.$ionicGoBack()},e.$scope.order="name",e.$scope.schoolsList=["a"],e.$scope.type=e.$stateParams.type,e.$scope.searchName="",e.$schoolSrv.listSchools().then(function(o){if("0"==o.status){var t=o.data,s=[];for(var n in t)s[n]=new e.$schoolModel(t[n]);e.$scope.schoolsList=s}else e.$uiComponents.$toast.show(o.message)},function(){e.$uiComponents.$loadding.hide(),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}),e.$scope.goHome=function(o,t,s,n){if(e.$pluginComponents.$tenantCertType.set(o),e.$pluginComponents.$tenantSchoolName.set(s),1==e.$scope.type)e.$rootScope.$emit("$choice",s,n),e.$rootScope.$ionicGoBack();else{e.$pluginComponents.$tenantId.set(n),e.$pluginComponents.$tenantName.set(s);var i=Object();switch(i.type=o,i.schoolId=t,i.schoolName=s,i.tenantId=n,e.$pluginComponents.$objectCache.setObject("tenantObject",i),o){case"login":e.$state.go("account_signin",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0});break;case"all":2==e.$scope.type?e.$state.go("account_signin",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):3==e.$scope.type?e.$state.go("user_bind_studentno",{type:"new",tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0}):e.$state.go("home.course",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0});break;case"tenant":e.$state.go("account_signin",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0});break;default:e.$state.go("account_signin",{tenantId:e.$pluginComponents.$tenantId.get()},{reload:!0})}}}},e.inheritFromCtrl(e.schools.schoolCtrl),e.registerDependency("gxb.controllers.schools.schoolCtrl",["gxb.services.schools.schoolSrv","gxb.models.schools.schoolModel","Preferences","$ionicScrollDelegate"]),e.registerView("gxb.controllers.schools.schoolCtrl","school")}(gxb.controllers),function(e){e.charging.chargingCtrl=function(e){e.$uiComponents.$loadding.show();var o=e.$pluginComponents.$accessToken.get(),t=e.$pluginComponents.$objectCache.getObject("userObject"),s=!0,n=e.$ionicScrollDelegate.$getByHandle("chargingView");e.$scope.getHeight=function(){return.9*document.body.clientWidth*(322/670)},e.$scope.getTop=function(){return"Android"==e.$rootScope.platformType?e.$scope.getHeight()+44:e.$scope.getHeight()+44+20},e.$scope.lists=[],e.$scope.slideIndex=0,e.$scope.activeSlide=function(o,t){e.$scope.slideIndex=o,e.$scope.lists=[],e.$scope.curCategoryId=t,s=!0,a(t,1,10)};var i=function(){e.$foundSrv.discoveryBanner().then(function(o){if(e.$uiComponents.$loadding.hide(),o.banner){for(var t=[],s=0;s<o.banner.length;s++){if(t[s]=o.banner[s],t[s].sourceImage=t[s].imageUrl,t[s].imageUrl)var n=t[s].imageUrl.substring(0,t[s].imageUrl.lastIndexOf("."))+"_790*350"+t[s].imageUrl.substring(t[s].imageUrl.lastIndexOf("."));t[s].imageUrl=n,t[s].cache="./images/slider_def.png"}e.$scope.safeApply(function(){e.$scope.discovery=t,e.$ionicSlideBoxDelegate.$getByHandle("imageviewer").update(),e.$ionicSlideBoxDelegate.$getByHandle("imageviewer").loop(!0)}),window.sessionStorage.setItem("chargingAt",gxb.utils.jsonUtils.toString(r(new Date))),window.sessionStorage.setItem("foundBanner",gxb.utils.jsonUtils.toString(t)),document.addEventListener("deviceready",function(){for(var o in e.$scope.discovery)window.plugins.ImageCachePlugin.cache(e.$scope.discovery[o].imageUrl,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.discovery[t.index].cache=t.cache,e.$scope.safeApply()})})}},function(){e.$uiComponents.$loadding.hide(),e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")})},c=function(){e.$chargingSrv.getCategory().then(function(o){if(o){e.$scope.tabNames=o.data,e.$scope.curCategoryId=o.data[0].categoryId,window.sessionStorage.setItem("chargingTabs",gxb.utils.jsonUtils.toString(e.$scope.tabNames)),e.$scope.safeApply(),s=!0;var t=[];e.$chargingSrv.getArticleList(e.$scope.curCategoryId,1,10).then(function(o){if(o.data.dataList){e.$scope.curPage=1,e.$scope.totalPage=o.data.paging.totalPage;for(var s=0;s<o.data.dataList.length;s++){var n=new e.$chargingArticleModel(o.data.dataList[s]);t.push(n)}e.$scope.lists=t,window.sessionStorage.setItem("chargingList",gxb.utils.jsonUtils.toString(t)),e.$scope.safeApply()}})}})},a=function(o,t,i){0!=s&&e.$chargingSrv.getArticleList(o,t,i).then(function(o){if(o.data.dataList){e.$scope.curPage=t,e.$scope.totalPage=o.data.paging.totalPage;for(var i=0;i<o.data.dataList.length;i++){var c=new e.$chargingArticleModel(o.data.dataList[i]);e.$scope.lists.push(c)}s=!1,e.$scope.safeApply(),n.resize()}})};e.$scope.getMoreList=function(){var o=n.getScrollView(),t=o.__maxScrollTop,i=n.getScrollPosition().top;i+45>=t&&e.$scope.curPage<e.$scope.totalPage&&(s=!0,e.$scope.curPage+=1,a(e.$scope.curCategoryId,e.$scope.curPage,10))},e.$scope.goDetail=function(t){e.Article.getDetail({articleId:t,accessToken:o})};var r=function(e){var o=e.getFullYear(),t=e.getMonth()+1,s=e.getDate(),n=e.getHours(),i={year:o,month:t,day:s,hours:n};return i},p=window.sessionStorage.getItem("chargingAt");if(p){var l=gxb.utils.jsonUtils.toObject(p),u=l.year,d=l.month,g=l.day,m=l.hours,f=r(new Date),h=f.year,b=f.hours,v=f.month,C=f.day;if(u==h&&d==v)if(g==C&&(m>12||m<12&&b<12)||g+1==C&&m>12&&b<12){var w=window.sessionStorage.getItem("chargingList")||null,y=window.sessionStorage.getItem("foundBanner")||null,S=window.sessionStorage.getItem("chargingTabs")||null;w&&y&&S?(e.$scope.discovery=gxb.utils.jsonUtils.toObject(y),e.$scope.lists=gxb.utils.jsonUtils.toObject(w),e.$scope.tabNames=gxb.utils.jsonUtils.toObject(S),e.$scope.safeApply(),e.$uiComponents.$loadding.hide(),document.addEventListener("deviceready",function(){for(var o in e.$scope.discovery)window.plugins.ImageCachePlugin.cache(e.$scope.discovery[o].imageUrl,o,function(o){var t=gxb.utils.jsonUtils.toObject(o);e.$scope.discovery[t.index].cache=t.cache,e.$scope.safeApply()})})):(i(),c())}else i(),c();else i(),c()}else i(),c();e.$scope.goLink=function(s,n){gxb.utils.userLogUtils.sendMiniClassBannerEvent($.extend({bannerID:n.id,description:n.title},e.$scope.mdParams)),gxb.utils.ymStatisticsUtils.ymEventWithParameter("bannerClick",{bannerId:n.id,index:s+1});var i=e.$scope.discovery[s].url;if(""==i||null==i)return!1;if(i.indexOf("gaoxiaobang.com")>0){if(o){var c="mobile="+t.mobile+"&email="+t.email+"&name="+t.name+"&token="+o+"&openid="+t.gxbOpenId;i=i.indexOf("?")==-1?i+"?"+c:i+"&"+c}window.open(i,"_blank")}},e.$scope.doRefresh=function(){e.$scope.slideIndex=0,i(),c(),n.resize(),e.$scope.$broadcast("scroll.refreshComplete")},gxb.utils.ymStatisticsUtils.ymEvent("TimeOfFoundShow")},e.inheritFromCtrl(e.charging.chargingCtrl),e.registerDependency("gxb.controllers.charging.chargingCtrl",["$ionicScrollDelegate","$ionicSlideBoxDelegate","gxb.services.founds.foundSrv","gxb.models.founds.foundModel","Article","gxb.services.charging.chargingSrv","gxb.models.charging.chargingArticleModel"]),e.registerView("gxb.controllers.charging.chargingCtrl","tab_charging")}(gxb.controllers),function(e){e.community.communityCtrl=function(e){var o="0",t=10,s=gxb.settings.server.remoteBgServer,n=e.$pluginComponents.$accessToken.get();e.$pluginComponents.$objectCache.getObject("userObject");e.$scope.wifi=e.networkState.state(),e.$scope.showLoadMore=1,e.$scope.curPage=1,e.$scope.loading=1,e.$scope.tab=0,e.$scope.getData=0;var i=document.getElementById("audio");i.loop=!1;var c=!0,a=e.$ionicScrollDelegate.$getByHandle("squareScroll"),r=e.$pluginComponents.$accessToken.get(),p=function(){e.$ionicScrollDelegate.$getByHandle("squareScroll").resize()};e.$scope.getHeight=function(){return.44*document.body.clientWidth},e.$scope.getHeight=function(){return.44*document.body.clientWidth},e.$scope.showChats=function(){e.$scope.tab=1,gxb.utils.ymStatisticsUtils.ymEvent("bangShow"),i.pause(),i.src="",e.$scope.thisPlay="-1",1!=e.$scope.getData&&(d(),g(1)),e.$scope.getData=1,e.$ionicScrollDelegate.$getByHandle("communityScroll").resize()},e.$scope.showClcok=function(){e.$scope.tab=0,p()},dwr.engine.setRpcType(dwr.engine.ScriptTag),identityService._path=s+"/dwr";var l=function(){identityService.findBanners({callback:function(o){if(o.length>0){for(var t=[],n=0;n<o.length;n++)t[n]=o[n],t[n].link=s+"/networks/banner/"+o[n].link;e.$scope.communityBanners=t,setTimeout(function(){e.$ionicSlideBoxDelegate.update(),e.$ionicSlideBoxDelegate.$getByHandle("mainhanddle").update()},500),e.$scope.safeApply()}},exceptionHandler:function(){}})};e.$scope.bannerLinks=function(o,t){i.pause(),i.src="",e.$scope.thisPlay="-1",gxb.utils.ymStatisticsUtils.ymEventWithParameter("communityBannerClick",{index:t+1}),window.plugins.MBrowserPlugin.browser(o+"?source="+e.$rootScope.platformType+"&token="+r,function(){},function(){})},l(n,1);var $=function(o){identityService.findAllLive({start:o*t,offset:t},{callback:function(o){for(var t=[],n=0;n<o.length;n++)t[n]=o[n],t[n].avatar=o[n].avatar.indexOf("gxbfile-gs")!=-1?o[n].avatar:s+"/networks/avatars/"+o[n].avatar;e.$scope.communityDataList=t,e.$scope.safeApply(),p()},exceptionHandler:function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),p()}})};$(0),e.$scope.communitySearch=function(o){i.pause(),i.src="",e.$scope.thisPlay="-1",window.plugins.MBrowserPlugin.browser(s+"/search.htm?source="+e.$rootScope.platformType+"&token="+r,function(){},function(){})};var u=function(o){0!=c&&identityService.findAllLive({start:o*t,offset:t},{callback:function(o){if(o.length==t){for(var n=0;n<o.length;n++){var i=o[n];i.avatar=o[n].avatar.indexOf("gxbfile-gs")!=-1?o[n].avatar:s+"/networks/avatars/"+o[n].avatar,e.$scope.communityDataList.push(i)}e.$scope.curPage++}else e.$scope.showLoadMore=0;p(),e.$scope.loading=1,e.$scope.safeApply()},exceptionHandler:function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~"),p()}})};e.$scope.scrollHandle=function(){var o=a.getScrollView(),t=o.__maxScrollTop,s=a.getScrollPosition().top;s+45>=t&&0!=e.$scope.showLoadMore&&e.$scope.loading&&(e.$scope.loading=0,u(e.$scope.curPage),c=!0)},e.$scope.communityDetails=function(o){i.pause(),i.src="",e.$scope.thisPlay="-1",gxb.utils.ymStatisticsUtils.ymEventWithParameter("QuestionShowInComminity",{id:o}),window.plugins.MBrowserPlugin.browser(s+"/questiondetails/"+o+".htm?source="+e.$rootScope.platformType+"&token="+r,function(){},function(){})};var d=function(){identityService.findHotUsers({callback:function(o){if(o.length>0){for(var t=[],n=0,i=o.length;n<i;n++)o[n].avatar.indexOf("gxbfile-gs")>=0?o[n].comefrom=1:(o[n].comefrom=0,o[n].avatar=""==o[n].avatar?s+"/networks/avatars/80x80avatar.jpg":s+"/networks/avatars/"+o[n].avatar);for(var c=0,a=o.length;c<a;c+=8)t.push(o.slice(c,c+8));e.$scope.communityRecommendData=t,e.$scope.safeApply()}},exceptionHandler:function(){e.$scope.safeApply(function(){e.$scope.networkStates="none"}),e.$uiComponents.$toast.show("网络连接失败，请检查后重试~")}})};gxb.utils.ymStatisticsUtils.ymEvent("communityShow"),
e.$scope.recommendLink=function(o){gxb.utils.ymStatisticsUtils.ymEventWithParameter("AnswersShowInCominity",{uid:o}),window.plugins.MBrowserPlugin.browser(s+"/mobilemypost/"+o+".htm?source="+e.$rootScope.platformType+"&token="+r,function(){},function(){})};var g=function(o){identityService.findClassifications({callback:function(o){e.$scope.communityClassifyData=o,e.$scope.safeApply()},exceptionHandler:function(){}})};e.$scope.classifyLink=function(o){window.plugins.MBrowserPlugin.browser(s+"/classifyItems/"+o+".htm?source="+e.$rootScope.platformType+"&token="+r,function(){},function(){})};var m=!0;e.$scope.showPlay1=function(t,n,c){if(t!=o&&(m=!0),o=t,m){m=!1,clearInterval(e.$scope.timer),n.indexOf("sound/")!=-1?i.src="https://gxbfile-gs.gaoxiaobang.com/"+n:i.src=s+"/networks/uploadsound/"+n,i.play();var a=["images/voice_1.png","images/voice_2.png","images/voice_3.png"];e.$scope.thisPlay=t,e.$scope.timer=null,e.$scope.num=-1,e.$scope.timer=setInterval(function(){e.$scope.num++,3==e.$scope.num&&(e.$scope.num=0),e.$scope.arrImgSrc=a[e.$scope.num],e.$scope.safeApply()},500)}else m=!0,clearInterval(e.$scope.timer),e.$scope.thisPlay="-1",i.pause(),i.src="",e.$scope.safeApply()},i.addEventListener("ended",function(){i.pause(),i.src="",e.$scope.thisPlay="-1"},!1),e.$rootScope.$on("$stateChangeStart",function(){i.pause(),i.src="",clearInterval(e.$scope.timer),e.$scope.thisPlay="-1"}),document.addEventListener("pause",function(){i.pause()},!1),document.addEventListener("resume",function(){i.play()},!1),e.$scope.reloadPage=function(){e.$uiComponents.$toast.show("正在请求"),e.$scope.networkStates="",gxb.controllers.community.communityCtrl(e)}},e.inheritFromCtrl(e.community.communityCtrl),e.registerDependency("gxb.controllers.community.communityCtrl",["$ionicSlideBoxDelegate","gxb.services.community.communitySrv","networkState","gxb.models.community.chatModel","$ionicScrollDelegate"]),e.registerView("gxb.controllers.community.communityCtrl","tab_community")}(gxb.controllers),function(e){var o=e.controllers,t="gxb.controllers",s="",n=[],i=function(t,s){e.utils.objectUtils.isObjectOnly(t)||(t=n.pop()),n.length&&e.utils.objectUtils.getKeys(t,function(t,c){var a=s+"."+c;e.utils.objectUtils.isObjectOnly(t)?(n.push(t),i(t,a)):e.utils.langUtils.isFunction(t)&&o.registerController(a,o.getDependency(a))})};e.utils.objectUtils.getKeys(o,function(o,c){e.utils.objectUtils.isObjectOnly(o)&&(s=t+"."+c,n.push(o),i(o,s))})}(gxb);